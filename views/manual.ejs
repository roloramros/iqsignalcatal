<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Backtesting</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    .candle-strip {
      display: flex;
      justify-content: center;
      padding: 15px;
      background: #f4f4f4;
      gap: 13px;
      flex-wrap: wrap;
    }

    .candle {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6), rgba(0, 0, 0, 0.2));
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
      border: 2px solid #000;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: bold;
      color: #fff;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .candle:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
    }

    .left-panel {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      width: 75%;
      overflow-y: auto;
    }

    .right-panel {
      width: 25%;
    }

    .patron {
      width: 100%;
    }

    .patron h3 {
      margin: 5px 0;
      text-align: left;
      font-size: 17px;
      font-weight: bold;
    }

    .main-container {
      display: flex;
      flex: 1;
    }

    .cuadros {
      display: grid;
      grid-template-columns: repeat(9, 35px);
      gap: 3px;
    }

    .cuadro {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 35px;
      height: 25px;
      border: 2px solid black;
      background-color: white;
      font-weight: bold;
      color: white;
    }

    #popup-señal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #222;
      color: #fff;
      padding: 20px 30px;
      border-radius: 10px;
      box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
      z-index: 9999;
      min-width: 300px;
      max-width: 90%;
      display: none;
    }

    .popup-content {
      position: relative;
    }

    .cerrar-popup {
      position: absolute;
      top: 5px;
      right: 8px;
      background: transparent;
      color: #fff;
      border: none;
      font-size: 18px;
      cursor: pointer;
    }

    #popup-texto {
      font-size: 18px;
      text-align: center;
      padding-top: 10px;
    }

    #popup-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .popup-alert {
      background: #222;
      color: #fff;
      padding: 15px 20px;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      min-width: 250px;
      max-width: 300px;
      position: relative;
      animation: slideIn 0.3s ease-out;
    }

    .popup-texto {
      font-size: 14px;
      text-align: left;
    }
  </style>
</head>

<body>
  <h2 class="mb-3">Catalogacion Manual para Otros Broker</h2>
  <form id="formVelas" action="/cargar-velas" method="POST" class="d-flex flex-wrap align-items-end gap-2">
    <div>
      <label for="fechaInicio" class="form-label mb-1">Inicio de la Catalogación</label>
      <input type="time" id="horaInicio" name="horaInicio" class="form-control form-control-sm" required>

    </div>
    <div class="d-flex flex-column">
      <div class="d-flex gap-1">
        <button class="btn btn-danger btn-sm" type="button" id="btnBajista">
          <i class="bi bi-arrow-down"></i> Vela Bajista
        </button>

        <button class="btn btn-secondary btn-sm" type="button" id="btnDoji">
          <i class="bi bi-slash-circle"></i> Vela Doji
        </button>

        <button class="btn btn-success btn-sm" type="button" id="btnAlcista">
          <i class="bi bi-arrow-up"></i> Vela Alcista
        </button>
        <div class="mb-3">
          <select class="form-select form-select-sm" id="selectSenales">
            <option value="mg2">2 Martin Galas</option>
            <option value="mg1">1 Martin Gala</option>
            <option value="sinMG">Sin Martin Gala</option>
          </select>
        </div>
      </div>
    </div>
  </form>

  <div id="indicadorHoraActual" style="font-size: 20px; font-weight: bold; margin-bottom: 10px; text-align: center;">
    <span >Vela en Formación: </span>
    <span id="horaAnalizada">--:--</span>
  </div>

  <div class="candle-strip mt-4" id="candle-strip">
    <% for(let i=0; i < 15; i++) { %>
      <div class="candle"></div>
      <% } %>
  </div>

  <div class="main-container">
    <!-- PANEL DE PATRONES -->
    <div class="left-panel mt-4"
      style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
      <!-- Los patrones se insertarán dinámicamente aquí con JS -->
    </div>

    <!-- PANEL DERECHO: GUÍA DE INTERPRETACIÓN -->
    <div class="right-panel">
      <table id="tablaPatrones" class="table table-hover table-striped table-bordered">

        <thead>
          <tr>
            <th>Patrón</th>
            <th colspan="3">Vela verde</th>
            <th colspan="3">Vela roja</th>
          </tr>
          <tr>
            <th></th>
            <th>Dir</th>
            <th>G1</th>
            <th>G2</th>
            <th>Dir</th>
            <th>G1</th>
            <th>G2</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>MHI Minoría</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>

          <tr>
            <td>MHI 2 Minoría</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>MHI 3 Minoría</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>Millón Minoría</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>MHI Mayoría</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>MHI 2 Mayoría</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>MHI 3 Mayoría</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>Millón Mayoría</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>Torres Gemelas</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>Mejor de 3</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>Tres Mosqueteros</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>Patrón Impar</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>Tres Vecinos</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>Patron 3x1</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
          <tr>
            <td>Patrón 23</td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
            <td> </td>
          </tr>
        </tbody>
      </table>
      <div id="estadisticas-globales"
        style="padding: 10px; background-color: #f0f0f0; border-top: 2px solid #ccc; font-size: 14px; line-height: 1.6;">
        <!-- Las estadísticas aparecerán aquí -->
      </div>


    </div>
  </div>

  <div id="popup-container"></div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/dist/umd/supabase.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>



  <script>
    let infoVelas = []
    let TipoVela = null;
    let velasCargadas = [];   // Las velas ya descargadas
    let indiceActual = 14;    // Se mostrarán las primeras 15 (0 a 14)
    let coloresDigitos = new Array(10).fill(null); // Inicialmente vacío
    let historicoMHI = [], historicoMHI2 = [], historicoMHI3 = [], historicoMILLONMIN = [];
    let historicoMHIMAY = [], historicoMHI2MAY = [], historicoMHI3MAY = [], historicoMILLONMAY = [];
    let historicoTORRESGEMELAS = [], historicoMEJOR3 = [], historicoMOSQUETEROS = [], historicoPATRONIMPAR = []
    let historicoTRESVECINOS = [], historicoPATRON3X1 = [], historicoPADRON23 = []
    let condicionCoincidencia = null; let velaBuscadaCoincidencia = null;
    let estadoAnteriorPatrones = {};
    let twoLoss = {};
    let threeloss = {};
    let alcanza100 = {};
    let pierde100 = {};
    let dosPerdidasSeguidas = {};
    let tresPerdidasSeguidas = {};
    let cuadranteConDoji = {};
    let alertasExportar = [];

    let confluenciaActiva = false;
    let condicionConfluencia = null;
    let direccionObjetivoConfluencia = null;
    let firstLoss = 0;
    let ultimoMinutoProcesado = null; // Variable global para rastrear el último minuto procesado
    let ultimaVelaProcesada = null; // Almacenará el ID o timestamp de la última vela procesada
    let ultimaVela = null;
  </script>





  <script>
    const supabaseUrl = "https://lmhyfgagksvojfkbnygx.supabase.co";
    const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtaHlmZ2Fna3N2b2pma2JueWd4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA0MjA4MzksImV4cCI6MjA2NTk5NjgzOX0.bD-j6tXajDumkB7cuck_9aNMGkrAdnAJLzQACoRYaJo";
    const clientesupabase = supabase.createClient(supabaseUrl, supabaseKey)

    const inputHora = document.getElementById("horaInicio");
    const spanHora = document.getElementById("horaAnalizada");
    const btnAlcista = document.getElementById("btnAlcista");
    const btnBajista = document.getElementById("btnBajista");
    const btnDoji = document.getElementById("btnDoji");

    btnAlcista.addEventListener("click", funcionVelaAlcista);
    btnBajista.addEventListener("click", funcionVelaBajista);
    btnDoji.addEventListener("click", funcionVelaDoji);

    // ✅ Cuando selecciono la hora en el input
    inputHora.addEventListener("change", () => {
      if (inputHora.value) {
        // Descomponemos la hora seleccionada
        let [hora, minuto] = inputHora.value.split(":").map(Number);
        let fecha = new Date();
        fecha.setHours(hora, minuto, 0, 0);
        // Formato HH:MM
        const nuevaHora = fecha.toTimeString().slice(0, 5);
        // Mostrar en el span
        spanHora.textContent = nuevaHora;
      }
    });

    function funcionVelaAlcista(e) {
      if (!inputHora.value) {
        e.preventDefault();
        Swal.fire({
          title: "⚠️ Selecciona la hora de inicio Primeramente",
          icon: "warning",
          confirmButtonText: "Entendido",
          confirmButtonColor: "#3085d6"
        });
        return false;
      }
      TipoVela = "green";
      agregarVela();
    }

    function funcionVelaBajista(e) {
      if (!inputHora.value) {
        e.preventDefault();
        Swal.fire({
          title: "⚠️ Selecciona la hora de inicio Primeramente",
          icon: "warning",
          confirmButtonText: "Entendido",
          confirmButtonColor: "#3085d6"
        });
        return false;
      }
      TipoVela = "red";
      agregarVela();
    }

    function funcionVelaDoji(e) {
      if (!inputHora.value) {
        e.preventDefault();
        Swal.fire({
          title: "⚠️ Selecciona la hora de inicio Primeramente",
          icon: "warning",
          confirmButtonText: "Entendido",
          confirmButtonColor: "#3085d6"
        });
        return false;
      }
      TipoVela = "doji";
      agregarVela();
    }

    function agregarVela() {
      const span = document.getElementById("horaAnalizada");
      const horaSpan = span.textContent;
      if (horaSpan === "--:--") {
        Swal.fire({
          title: "⚠️ No se ha seleccionado hora",
          text: "Debes elegir una hora de inicio primero.",
          icon: "warning",
          confirmButtonText: "Entendido",
          confirmButtonColor: "#3085d6"
        });
        return;
      }
      // Convertimos la hora del span a objeto Date
      const [hora, minuto] = horaSpan.split(":").map(Number);
      const fecha = new Date();
      fecha.setHours(hora, minuto, 0, 0);
      const start_time = fecha.toTimeString().slice(0, 8); // HH:MM:SS
      // end_time = +1 minuto
      fecha.setMinutes(fecha.getMinutes() + 1);
      const end_time = fecha.toTimeString().slice(0, 8);
      // Crear objeto vela
      const nuevaVela = {
        candle_color: TipoVela,
        start_time: start_time,
        end_time: end_time
      };
      // Guardar en el arreglo
      velasCargadas.push(nuevaVela);
      // ✅ Actualizar el span a la nueva hora (end_time → HH:MM)
      const nuevaHora = end_time.slice(0, 5);
      span.textContent = nuevaHora;
      inputHora.value = nuevaHora; // sincronizar también el input
      mostrarVelas();
      analizarVelaPorDigito(nuevaVela);
      verificaAlertas();
    }

    function mostrarVelas() {
      const container = document.getElementById("candle-strip");
      container.innerHTML = ""; // limpiar los círculos

      // Tomamos las últimas 15 velas
      const ultimasVelas = velasCargadas.slice(-15);

      ultimasVelas.forEach(vela => {
        const div = document.createElement("div");
        div.classList.add("candle");

        // Asignar color según tipo de vela
        if (vela.candle_color === "green") {
          div.style.backgroundColor = "green";
        } else if (vela.candle_color === "red") {
          div.style.backgroundColor = "red";
        } else {
          div.style.backgroundColor = "gray"; // doji
        }

        // Texto = minuto del start_time
        const minuto = vela.start_time.split(":")[1];
        div.textContent = minuto;
        container.appendChild(div);
      });
    }

    function analizarVelaPorDigito(vela) {
      const horaStr = vela.start_time.toString();
      minutoCuadrante = horaStr.split(":").slice(0, 2).join(":");
      const minuto = parseInt(horaStr.split(':')[1] || '0');
      const digito = minuto % 10;
      const funciones = [
        digito0, digito1, digito2, digito3, digito4,
        digito5, digito6, digito7, digito8, digito9
      ];
      const color = vela.candle_color?.toLowerCase().trim() || 'gray';
      coloresDigitos[digito] = color;
      const funcion = funciones[digito];
      if (velasCargadas.length > 9) {
        if (funcion) funcion(vela);
      }
    }

    function getCelda(patron, columnaIndex) {
      const tabla = document.getElementById('tablaPatrones');
      for (let i = 1; i < tabla.rows.length; i++) { // saltamos encabezado
        const fila = tabla.rows[i];
        if (fila.cells[0].innerText.trim() === patron.trim()) {
          return fila.cells[columnaIndex];
        }
      }
      return null; // No encontrada
    }

    function colorMenosRepetido(indices) {
      let contador = { green: 0, red: 0 };
      for (let i of indices) {
        const color = coloresDigitos[i];
        if (color === 'green') contador.green++;
        else if (color === 'red') contador.red++;
      }
      const total = contador.green + contador.red;
      if (total === 0) return null;
      if (contador.green === indices.length) return 'red';
      if (contador.red === indices.length) return 'green';
      if (contador.green === contador.red) return 'empate';
      return contador.green < contador.red ? 'green' : 'red';
    }

    function colorMasRepetido(indices) {
      let contador = { green: 0, red: 0 };

      for (let i of indices) {
        const color = coloresDigitos[i];
        if (color === 'green') contador.green++;
        else if (color === 'red') contador.red++;
      }

      const total = contador.green + contador.red;
      if (total === 0) return null;

      if (contador.green === contador.red) return 'empate';

      // Devolver el más repetido
      return contador.green > contador.red ? 'green' : 'red';
    }

    function agregarResultadoConTiempo(historicoArray, resultado, patronId) {
      const timestamp = obtenerTimestampActual();
      const objetoResultado = {
        resultado: resultado,
        tiempo: minutoCuadrante,
        timestamp_completo: new Date().toISOString() // Para ordenamiento si es necesario
      };

      // Agregar nuevo resultado
      historicoArray.push(objetoResultado);

      // Mantener máximo 24 elementos
      if (historicoArray.length > 24) {
        historicoArray.shift();
      }

      // Actualizar historial visual
      actualizarHistoricoConTooltips(patronId, historicoArray);
    }

    function obtenerTimestampActual() {
      const ahora = new Date();
      return ahora.getHours().toString().padStart(2, '0') + ':' +
        ahora.getMinutes().toString().padStart(2, '0');
    }

    function actualizarHistoricoConTooltips(patronId, historicoPatron) {
      const cuadrosContainer = document.getElementById(patronId);
      if (!cuadrosContainer) {
        console.error(`No se encontró el patrón con ID: ${patronId}`);
        return;
      }

      if (historicoPatron.length === 0) {
        console.warn('No hay datos en historicoPatron para aplicar al patrón');
        return;
      }

      // Aplicar cada valor del histórico a su cuadro correspondiente
      historicoPatron.forEach((objetoResultado, index) => {
        const cuadroEspecifico = cuadrosContainer.querySelector(`.cuadro[data-index="${index}"]`);
        if (cuadroEspecifico) {
          const valor = objetoResultado.resultado;
          const tiempo = objetoResultado.tiempo;

          // Aplicar estilo según el valor
          switch (valor) {
            case 'D':
              cuadroEspecifico.style.backgroundColor = "green";
              cuadroEspecifico.textContent = "";
              break;
            case 'G1':
              cuadroEspecifico.style.backgroundColor = "green";
              cuadroEspecifico.textContent = "G1";
              break;
            case 'G2':
              cuadroEspecifico.style.backgroundColor = "green";
              cuadroEspecifico.textContent = "G2";
              break;
            case 'L':
              cuadroEspecifico.style.backgroundColor = "red";
              cuadroEspecifico.textContent = "";
              break;
            case 'E':
              cuadroEspecifico.style.backgroundColor = "gray";
              cuadroEspecifico.textContent = "";
              break;
            default:
              console.warn(`Valor desconocido en historicoPatron: ${valor}`);
          }

          // Agregar tooltip con el tiempo
          cuadroEspecifico.setAttribute('title', `Hora: ${tiempo}\nResultado: ${valor}`);
          cuadroEspecifico.setAttribute('data-tiempo', tiempo);
        }
      });
    }

    document.addEventListener("DOMContentLoaded", async () => {
      userId = "<%= user.id %>";
      try {
        // Leer valor inicial de mg_config
        const { data, error } = await clientesupabase
          .from("user_config")
          .select("mg_config")
          .eq("user_id", userId)
          .single();

        const mapSelect = {
          "2 gales": "mg2",
          "1 gale": "mg1",
          "nogale": "sinMG"
        };

        const mapReverse = {
          "sinMG": "nogale",
          "mg1": "1 gale",
          "mg2": "2 gales"
        };
        if (data && data.mg_config && mapSelect[data.mg_config]) {
          valorSelect = mapSelect[data.mg_config];
        }

        const select = document.getElementById("selectSenales");
        if (select) {
          select.value = valorSelect;

          // Evento al cambiar el select
          select.addEventListener("change", async () => {
            const nuevoValor = mapReverse[select.value];
            try {
              const { error: updateError } = await clientesupabase
                .from("user_config")
                .update({ mg_config: nuevoValor })
                .eq("user_id", userId);

              if (updateError) {
                console.error("Error actualizando mg_config:", updateError);
              } else {
                location.reload();
              }
            } catch (err) {
              console.error("Excepción al actualizar mg_config:", err);
            }
          });
        }
      } catch (err) {
        console.error("Excepción al cargar mg_config:", err);
      }
    });

  </script>



  <script>
    function digito0(vela) {
      ultimaVela = coloresDigitos[0];
      ['MHI Minoría', 'MHI Mayoría', 'Millón Minoría', 'Millón Mayoría'].forEach(patron => {
        getCelda(patron, 2).style.backgroundColor = '';
        getCelda(patron, 5).style.backgroundColor = '';
      });
      if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
        const minoritario = colorMenosRepetido([7, 8, 9]);
        if (minoritario === coloresDigitos[0]) {
          // Gana MHI Minoría, pierde MHI Mayoría
          if (minoritario === 'green') {
            getCelda('MHI Mayoría', 3).style.backgroundColor = 'red';
          } else if (minoritario === 'red') {
            getCelda('MHI Mayoría', 6).style.backgroundColor = 'green';
          }
        } else {
          // Gana MHI Mayoría, pierde MHI Minoría
          if (minoritario === 'green') {
            getCelda('MHI Minoría', 6).style.backgroundColor = 'green';
          } else if (minoritario === 'red') {
            getCelda('MHI Minoría', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analisis Millon Minoria y Millon Minoria
      if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {    //Para si hay un doji no hacer nada
        const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
        if (minoritario === coloresDigitos[0]) {   //Se gana mill minoria y se pierde mill mayoria
          if (minoritario === 'green') {
            getCelda('Millón Mayoría', 3).style.backgroundColor = 'red';
          }
          if (minoritario === 'red') {
            getCelda('Millón Mayoría', 6).style.backgroundColor = 'green';
          }
        } else {
          if (minoritario === 'green') {
            getCelda('Millón Minoría', 6).style.backgroundColor = 'green';
          }
          if (minoritario === 'red') {
            getCelda('Millón Minoría', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
      getCelda('MHI 2 Minoría', 1).style.backgroundColor = '';
      getCelda('MHI 2 Minoría', 4).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 1).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 4).style.backgroundColor = '';
      if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
        const minoritario = colorMenosRepetido([7, 8, 9]);
        if (minoritario === 'green') {
          getCelda('MHI 2 Minoría', 5).style.backgroundColor = 'green';
          getCelda('MHI 2 Mayoría', 2).style.backgroundColor = 'red';
        } else {
          getCelda('MHI 2 Minoría', 2).style.backgroundColor = 'red';
          getCelda('MHI 2 Mayoría', 5).style.backgroundColor = 'green';

        }
      }
      //Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
      if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
        const minoritario = colorMenosRepetido([7, 8, 9]);
        if (minoritario === 'red') {
          getCelda('MHI 3 Minoría', 1).style.backgroundColor = 'red';
          getCelda('MHI 3 Minoría', 4).style.backgroundColor = 'red';
          getCelda('MHI 3 Mayoría', 1).style.backgroundColor = 'green';
          getCelda('MHI 3 Mayoría', 4).style.backgroundColor = 'green';
        } else if (minoritario === 'green') {
          getCelda('MHI 3 Minoría', 1).style.backgroundColor = 'green';
          getCelda('MHI 3 Minoría', 4).style.backgroundColor = 'green';
          getCelda('MHI 3 Mayoría', 1).style.backgroundColor = 'red';
          getCelda('MHI 3 Mayoría', 4).style.backgroundColor = 'red';

        }
      }
      //Analasis para Torres Gemelas
      getCelda('Torres Gemelas', 3).style.backgroundColor = '';
      getCelda('Torres Gemelas', 6).style.backgroundColor = '';
      //Analisis correspondiente a TRES VECINOS
      getCelda('Tres Vecinos', 3).style.backgroundColor = '';
      getCelda('Tres Vecinos', 6).style.backgroundColor = '';
      //Analisis correspondiente a PATRON 23
      getCelda('Patrón 23', 1).style.backgroundColor = '';
      getCelda('Patrón 23', 4).style.backgroundColor = '';
      if (coloresDigitos[0] !== 'doji') {
        if (coloresDigitos[0] === 'green') {
          getCelda('Patrón 23', 5).style.backgroundColor = 'green';
        } else {
          getCelda('Patrón 23', 2).style.backgroundColor = 'red';
        }
      }
      //Analasis para MEJOR DE TRES
      if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
        const minoritario = colorMenosRepetido([6, 7, 8]);
        if (minoritario === 'green') {
          getCelda('Mejor de 3', 1).style.backgroundColor = 'red';
          getCelda('Mejor de 3', 4).style.backgroundColor = 'red';
        } else {
          getCelda('Mejor de 3', 1).style.backgroundColor = 'green';
          getCelda('Mejor de 3', 4).style.backgroundColor = 'green';
        }
      }
      //Analisis Patron 3x1
      getCelda('Patron 3x1', 3).style.backgroundColor = '';
      getCelda('Patron 3x1', 6).style.backgroundColor = '';
      // Analisis Patron Impar
      if (coloresDigitos[7] !== 'doji') {
        if (coloresDigitos[7] !== coloresDigitos[0]) {
          if (coloresDigitos[7] === 'green') {
            getCelda('Patrón Impar', 2).style.backgroundColor = 'green';
            getCelda('Patrón Impar', 5).style.backgroundColor = 'green';
          } else {
            getCelda('Patrón Impar', 2).style.backgroundColor = 'red';
            getCelda('Patrón Impar', 5).style.backgroundColor = 'red';
          }
        }
      }

      //Analisis de las que pueden ganar en este digito:
      //MHI mayoria y minoria
      if (coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {
        agregarResultadoConTiempo(historicoMHI, "E", "MHI_Minoría");
        agregarResultadoConTiempo(historicoMHIMAY, "E", "MHI_Mayoría");
      } else {
        const minoritario = colorMenosRepetido([7, 8, 9]);
        if (minoritario === coloresDigitos[0]) {
          agregarResultadoConTiempo(historicoMHI, "D", "MHI_Minoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minoría");
          }
        }

        const mayoritario = colorMasRepetido([7, 8, 9]);
        if (mayoritario === coloresDigitos[0]) {
          agregarResultadoConTiempo(historicoMHIMAY, "D", "MHI_Mayoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayoría");
          }
        }

      }

      //MILLON mayoria y minoria
      if (coloresDigitos[5] === 'doji' || coloresDigitos[6] === 'doji' || coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {
        agregarResultadoConTiempo(historicoMILLONMIN, "E", "Millón_Minoría");
        agregarResultadoConTiempo(historicoMILLONMAY, "E", "Millón_Mayoría");
      } else {
        const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
        if (minoritario === coloresDigitos[0]) {
          agregarResultadoConTiempo(historicoMILLONMIN, "D", "Millón_Minoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMILLONMIN, "L", "Millón_Minoría");
          }
        }

        const mayoritario = colorMasRepetido([5, 6, 7, 8, 9]);

        if (mayoritario === coloresDigitos[0]) {
          agregarResultadoConTiempo(historicoMILLONMAY, "D", "Millón_Mayoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMILLONMAY, "L", "Millón_Mayoría");
          }
        }

      }

      //Torres Gemelas
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[5] !== 'doji') {
          if (coloresDigitos[5] !== coloresDigitos[9] && coloresDigitos[5] === coloresDigitos[0]) {
            agregarResultadoConTiempo(historicoTORRESGEMELAS, "G1", "Torres_Gemelas");
          }
          if (valorSelect === "mg1") {
            if (coloresDigitos[5] !== coloresDigitos[9] && coloresDigitos[5] !== coloresDigitos[0]) {
              agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
            }
          }
        }
      }


      //Tres Mosqueteros
      if (valorSelect === "mg2") {
        if (coloresDigitos[7] !== 'doji') {
          if (coloresDigitos[7] !== coloresDigitos[8] && coloresDigitos[7] !== coloresDigitos[9] && coloresDigitos[7] === coloresDigitos[0]) {
            agregarResultadoConTiempo(historicoMOSQUETEROS, "G2", "Tres_Mosqueteros");
          } else if (coloresDigitos[7] !== coloresDigitos[8] && coloresDigitos[7] !== coloresDigitos[9] && coloresDigitos[7] !== coloresDigitos[0]) {
            agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
          }
        }
      }
      //Patron Impar
      if (coloresDigitos[7] === 'doji') {
        agregarResultadoConTiempo(historicoPATRONIMPAR, "E", "Patrón_Impar");
      } else {
        if (coloresDigitos[7] === coloresDigitos[0]) {
          agregarResultadoConTiempo(historicoPATRONIMPAR, "D", "Patrón_Impar");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patrón_Impar");
          }
        }

      }
      //Tres Vecinos
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[8] !== 'doji') {
          if (coloresDigitos[8] !== coloresDigitos[9] && coloresDigitos[8] === coloresDigitos[0]) {
            agregarResultadoConTiempo(historicoTRESVECINOS, "G1", "Tres_Vecinos");
          }
          if (valorSelect === "mg1") {
            if (coloresDigitos[8] !== coloresDigitos[9] && coloresDigitos[8] !== coloresDigitos[0]) {
              agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
            }
          }
        }
      }
      //Patron 3x1
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {
          const minoritario = colorMenosRepetido([5, 6, 7]);
          if (minoritario !== coloresDigitos[9] && minoritario === coloresDigitos[0]) {
            agregarResultadoConTiempo(historicoPATRON3X1, "G1", "Patron_3x1");
          }
          if (valorSelect === "mg1") {
            if (minoritario !== coloresDigitos[9] && minoritario !== coloresDigitos[0]) {
              agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
            }
          }
        }
      }
    }

    function digito1(vela) {
      ultimaVela = coloresDigitos[1];
      ['MHI Minoría', 'MHI Mayoría', 'Millón Minoría', 'Millón Mayoría'].forEach(patron => {
        getCelda(patron, 3).style.backgroundColor = '';
        getCelda(patron, 6).style.backgroundColor = '';
      });
      //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
      getCelda('MHI 2 Minoría', 2).style.backgroundColor = '';
      getCelda('MHI 2 Minoría', 5).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 2).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 5).style.backgroundColor = '';
      if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
        const minoritario = colorMenosRepetido([7, 8, 9]);
        if (minoritario === coloresDigitos[1]) {
          if (minoritario === 'green') {
            getCelda('MHI 2 Mayoría', 3).style.backgroundColor = 'red';
          }
          else {
            getCelda('MHI 2 Mayoría', 6).style.backgroundColor = 'green';
          }
        } else {
          if (minoritario === 'green') {
            getCelda('MHI 2 Minoría', 6).style.backgroundColor = 'green';
          }
          else {
            getCelda('MHI 2 Minoría', 3).style.backgroundColor = 'red';
          }
        }
      }//Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
      getCelda('MHI 3 Minoría', 1).style.backgroundColor = '';
      getCelda('MHI 3 Minoría', 4).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 1).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 4).style.backgroundColor = '';
      if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
        const minoritario = colorMenosRepetido([7, 8, 9]);
        if (minoritario === 'green') {
          getCelda('MHI 3 Minoría', 5).style.backgroundColor = 'green';
          getCelda('MHI 3 Mayoría', 2).style.backgroundColor = 'red';
        } else {
          getCelda('MHI 3 Minoría', 2).style.backgroundColor = 'red';
          getCelda('MHI 3 Mayoría', 5).style.backgroundColor = 'green';
        }
      }
      //Analisis correspondiente a TRES MOSQUETEROS
      getCelda('Tres Mosqueteros', 1).style.backgroundColor = 'green';
      getCelda('Tres Mosqueteros', 4).style.backgroundColor = 'red';
      //Analisis correspondiente a PATRON 23
      getCelda('Patrón 23', 2).style.backgroundColor = '';
      getCelda('Patrón 23', 5).style.backgroundColor = '';
      if (coloresDigitos[0] !== 'doji') {
        if (coloresDigitos[0] !== coloresDigitos[1]) {
          if (coloresDigitos[0] === 'green') {
            getCelda('Patrón 23', 6).style.backgroundColor = 'green';
          } else {
            getCelda('Patrón 23', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analasis para MEJOR DE TRES
      getCelda('Mejor de 3', 1).style.backgroundColor = '';
      getCelda('Mejor de 3', 4).style.backgroundColor = '';
      if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
        const minoritario = colorMenosRepetido([6, 7, 8]);
        if (minoritario === "green") {
          getCelda('Mejor de 3', 2).style.backgroundColor = 'red';
        } else {
          getCelda('Mejor de 3', 5).style.backgroundColor = 'green';
        }
      }
      // Analisis Patron Impar
      getCelda('Patrón Impar', 2).style.backgroundColor = '';
      getCelda('Patrón Impar', 5).style.backgroundColor = '';

      //Analisis de las que pueden ganar en este digito:
      //MHI mayoria y minoria
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
          const minoritario = colorMenosRepetido([7, 8, 9]);
          const mayoritario = colorMasRepetido([7, 8, 9]);
          if (minoritario !== coloresDigitos[0] && minoritario === coloresDigitos[1]) {
            agregarResultadoConTiempo(historicoMHI, "G1", "MHI_Minoría");
          }
          if (valorSelect === "mg1") {
            if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1]) {
              agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minoría");
            }
          }
          if (mayoritario !== coloresDigitos[0] && mayoritario === coloresDigitos[1]) {
            agregarResultadoConTiempo(historicoMHIMAY, "G1", "MHI_Mayoría");
          }
          if (valorSelect === "mg1") {
            if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1]) {
              agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayoría");
            }
          }
        }
      }





      //MHI2 mayoria y minoria2
      if (coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {
        agregarResultadoConTiempo(historicoMHI2, "E", "MHI_2_Minoría");
        agregarResultadoConTiempo(historicoMHI2MAY, "E", "MHI_2_Mayoría");
      } else {
        const minoritario = colorMenosRepetido([7, 8, 9]);
        if (minoritario === coloresDigitos[1]) {
          agregarResultadoConTiempo(historicoMHI2, "D", "MHI_2_Minoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minoría");
          }
        }

        const mayoritario = colorMasRepetido([7, 8, 9]);
        if (mayoritario === coloresDigitos[1]) {
          agregarResultadoConTiempo(historicoMHI2MAY, "D", "MHI_2_Mayoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayoría");
          }
        }

      }
      //MHI mayoria y minoria
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
          const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
          const mayoritario = colorMasRepetido([5, 6, 7, 8, 9]);

          if (minoritario !== coloresDigitos[0] && minoritario === coloresDigitos[1]) {
            agregarResultadoConTiempo(historicoMILLONMIN, "G1", "Millón_Minoría");
          }
          if (valorSelect === "mg1") {
            if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1]) {
              agregarResultadoConTiempo(historicoMILLONMIN, "L", "Millón_Minoría");
            }
          }

          if (mayoritario !== coloresDigitos[0] && mayoritario === coloresDigitos[1]) {
            agregarResultadoConTiempo(historicoMILLONMAY, "G1", "Millón_Mayoría");
          }
          if (valorSelect === "mg1") {
            if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1]) {
              agregarResultadoConTiempo(historicoMILLONMAY, "L", "Millón_Mayoría");
            }
          }

        }
      }
      //Torres Gemelas
      if (valorSelect === "mg2") {
        if (coloresDigitos[5] !== 'doji') {
          if (coloresDigitos[5] !== coloresDigitos[9] && coloresDigitos[5] !== coloresDigitos[0] && coloresDigitos[5] === coloresDigitos[1]) {
            agregarResultadoConTiempo(historicoTORRESGEMELAS, "G2", "Torres_Gemelas");
          } else if (coloresDigitos[5] !== coloresDigitos[9] && coloresDigitos[5] !== coloresDigitos[0] && coloresDigitos[5] !== coloresDigitos[1]) {
            agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
          }
        }
      }
      //Tres Vecinos
      if (valorSelect === "mg2") {
        if (coloresDigitos[8] !== 'doji') {
          if (coloresDigitos[8] !== coloresDigitos[9] && coloresDigitos[8] !== coloresDigitos[0] && coloresDigitos[8] === coloresDigitos[1]) {
            agregarResultadoConTiempo(historicoTRESVECINOS, "G2", "Tres_Vecinos");
          } else if (coloresDigitos[8] !== coloresDigitos[9] && coloresDigitos[8] !== coloresDigitos[0] && coloresDigitos[8] !== coloresDigitos[1]) {

            agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
          }
        }
      }
      //Patron 3x1
      if (valorSelect === "mg2") {
        if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {
          const minoritario = colorMenosRepetido([5, 6, 7]);
          if (minoritario !== coloresDigitos[9] && minoritario !== coloresDigitos[0] && minoritario === coloresDigitos[1]) {
            agregarResultadoConTiempo(historicoPATRON3X1, "G2", "Patron_3x1");
          } else if (minoritario !== coloresDigitos[9] && minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1]) {

            agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
          }
        }
      }
      //Patron 23
      if (coloresDigitos[0] === 'doji') {
        agregarResultadoConTiempo(historicoPADRON23, "E", "Patrón_23");

      } else {
        if (coloresDigitos[0] === coloresDigitos[1]) {
          agregarResultadoConTiempo(historicoPADRON23, "D", "Patrón_23");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoPADRON23, "L", "Patrón_23");
          }
        }

      }
    }

    function digito2(vela) {
      ultimaVela = coloresDigitos[2];
      //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
      getCelda('MHI 2 Minoría', 3).style.backgroundColor = '';
      getCelda('MHI 2 Minoría', 6).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 3).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 6).style.backgroundColor = '';
      getCelda('MHI 3 Minoría', 2).style.backgroundColor = '';
      getCelda('MHI 3 Minoría', 5).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 2).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 5).style.backgroundColor = '';
      if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
        const minoritario = colorMenosRepetido([7, 8, 9]);
        if (minoritario === coloresDigitos[2]) {
          if (minoritario === 'green') {
            getCelda('MHI 3 Mayoría', 3).style.backgroundColor = 'red';
          } else {
            getCelda('MHI 3 Mayoría', 6).style.backgroundColor = 'green';
          }
        } else {
          if (minoritario === 'green') {
            getCelda('MHI 3 Minoría', 6).style.backgroundColor = 'green';
          } else {
            getCelda('MHI 3 Minoría', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analasis para Torres Gemelas
      if (coloresDigitos[0] !== 'doji') {
        getCelda('Torres Gemelas', 1).style.backgroundColor = coloresDigitos[0];
        getCelda('Torres Gemelas', 4).style.backgroundColor = coloresDigitos[0];
      }
      //Analisis correspondiente a TRES MOSQUETEROS
      getCelda('Tres Mosqueteros', 1).style.backgroundColor = '';
      getCelda('Tres Mosqueteros', 4).style.backgroundColor = '';
      if (coloresDigitos[2] !== 'doji') {
        if (coloresDigitos[2] === 'green') {
          getCelda('Tres Mosqueteros', 5).style.backgroundColor = 'green';
        } else {
          getCelda('Tres Mosqueteros', 2).style.backgroundColor = 'red';
        }
      }
      //Analisis correspondiente a TRES VECINOS
      getCelda('Tres Vecinos', 1).style.backgroundColor = 'green';
      getCelda('Tres Vecinos', 4).style.backgroundColor = 'red';
      //Analisis correspondiente a PATRON 23
      getCelda('Patrón 23', 3).style.backgroundColor = '';
      getCelda('Patrón 23', 6).style.backgroundColor = '';
      //Analasis para MEJOR DE TRES
      getCelda('Mejor de 3', 2).style.backgroundColor = '';
      getCelda('Mejor de 3', 5).style.backgroundColor = '';
      if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
        const minoritario = colorMenosRepetido([5, 7, 8]);
        if (minoritario === coloresDigitos[2]) {
          if (minoritario === "green") {
            getCelda('Mejor de 3', 3).style.backgroundColor = 'red';
          } else {
            getCelda('Mejor de 3', 6).style.backgroundColor = 'green';
          }
        }
      }
      //Analisis Patron 3x1
      if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {    //Para si hay un doji no hacer nada
        const minoritario = colorMenosRepetido([0, 1, 2]);
        getCelda('Patron 3x1', 1).style.backgroundColor = minoritario;
        getCelda('Patron 3x1', 4).style.backgroundColor = minoritario;

      }
      // Analisis Patron Impar
      if (coloresDigitos[7] !== 'doji') {
        if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] !== coloresDigitos[2]) {
          if (coloresDigitos[7] === 'green') {
            getCelda('Patrón Impar', 3).style.backgroundColor = 'green';
            getCelda('Patrón Impar', 6).style.backgroundColor = 'green';
          } else {
            getCelda('Patrón Impar', 3).style.backgroundColor = 'red';
            getCelda('Patrón Impar', 6).style.backgroundColor = 'red';
          }
        }
      }

      //Analisis de las que pueden ganar en este digito:
      //MHI mayoria y minoria
      if (valorSelect === "mg2") {
        if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
          const minoritario = colorMenosRepetido([7, 8, 9]);
          if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario === coloresDigitos[2]) {
            agregarResultadoConTiempo(historicoMHI, "G2", "MHI_Minoría");
          } else if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2]) {

            agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minoría");
          }
        }
        const mayoritario = colorMasRepetido([7, 8, 9]);
        if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario === coloresDigitos[2]) {
          agregarResultadoConTiempo(historicoMHIMAY, "G2", "MHI_Mayoría");
        } else if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2]) {

          agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayoría");

        }
      }
      //MHI mayoria2 y minoria2
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
          const minoritario = colorMenosRepetido([7, 8, 9]);
          const mayoritario = colorMasRepetido([7, 8, 9]);
          if (minoritario !== coloresDigitos[1] && minoritario === coloresDigitos[2]) {
            agregarResultadoConTiempo(historicoMHI2, "G1", "MHI_2_Minoría");
          }
          if (valorSelect === "mg1") {
            if (minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2]) {
              agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minoría");
            }
          }
          if (mayoritario !== coloresDigitos[1] && mayoritario === coloresDigitos[2]) {
            agregarResultadoConTiempo(historicoMHI2MAY, "G1", "MHI_2_Mayoría");
          }
          if (valorSelect === "mg1") {
            if (mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2]) {
              agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayoría");
            }
          }
        }
      }
      //MHI3 mayoria y minoria3
      if (coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {
        agregarResultadoConTiempo(historicoMHI3, "E", "MHI_3_Minoría");
        agregarResultadoConTiempo(historicoMHI3MAY, "E", "MHI_3_Mayoría");

      } else {
        const minoritario = colorMenosRepetido([7, 8, 9]);
        if (minoritario === coloresDigitos[2]) {
          agregarResultadoConTiempo(historicoMHI3, "D", "MHI_3_Minoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minoría");
          }
        }

        const mayoritario = colorMasRepetido([7, 8, 9]);
        if (mayoritario === coloresDigitos[2]) {
          agregarResultadoConTiempo(historicoMHI3MAY, "D", "MHI_3_Mayoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayoría");
          }
        }

      }
      if (valorSelect === "mg2") {
        if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
          const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
          const mayoritario = colorMasRepetido([5, 6, 7, 8, 9]);
          if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario === coloresDigitos[2]) {
            agregarResultadoConTiempo(historicoMILLONMIN, "G2", "Millón_Minoría");
          } else if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2]) {
            agregarResultadoConTiempo(historicoMILLONMIN, "L", "Millón_Minoría");
          }
          if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario === coloresDigitos[2]) {
            agregarResultadoConTiempo(historicoMILLONMAY, "G2", "Millón_Mayoría");
          } else if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2]) {
            agregarResultadoConTiempo(historicoMILLONMAY, "L", "Millón_Mayoría");
          }

        }



      }
      //Mejor de 3
      if (coloresDigitos[6] === 'doji' || coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji') {
        agregarResultadoConTiempo(historicoMEJOR3, "E", "Mejor_de_3");
      } else {
        const mayoritario = colorMasRepetido([6, 7, 8]);
        if (mayoritario === coloresDigitos[2]) {
          agregarResultadoConTiempo(historicoMEJOR3, "D", "Mejor_de_3");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");
          }
        }

      }
      //Patron Impar
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[7] !== 'doji') {
          if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] === coloresDigitos[2]) {
            agregarResultadoConTiempo(historicoPATRONIMPAR, "G1", "Patrón_Impar");
          }
          if (valorSelect === "mg1") {
            if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] !== coloresDigitos[2]) {
              agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patrón_Impar");
            }
          }
        }
      }
      //Patron 23
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[0] !== 'doji') {
          if (coloresDigitos[0] !== coloresDigitos[1] && coloresDigitos[0] === coloresDigitos[2]) {
            agregarResultadoConTiempo(historicoPADRON23, "G1", "Patrón_23");
          }
          if (valorSelect === "mg1") {
            if (coloresDigitos[0] !== coloresDigitos[1] && coloresDigitos[0] !== coloresDigitos[2]) {
              agregarResultadoConTiempo(historicoPADRON23, "L", "Patrón_23");
            }
          }
        }
      }
    }

    function digito3(vela) {
      ultimaVela = coloresDigitos[3];
      //MHI Minoria y MHI Mayoria
      if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
        if (coloresDigitos[2] === coloresDigitos[3]) {
          const opuesto = coloresDigitos[2] === 'red' ? 'green' : 'red';
          getCelda('MHI Minoría', 1).style.backgroundColor = opuesto;
          getCelda('MHI Minoría', 4).style.backgroundColor = opuesto;
          getCelda('MHI Mayoría', 1).style.backgroundColor = coloresDigitos[2];
          getCelda('MHI Mayoría', 4).style.backgroundColor = coloresDigitos[2];
        } else {
          getCelda('MHI Minoría', 1).style.backgroundColor = 'red';
          getCelda('MHI Minoría', 4).style.backgroundColor = 'green';
          getCelda('MHI Mayoría', 1).style.backgroundColor = 'green';
          getCelda('MHI Mayoría', 4).style.backgroundColor = 'red';
        }
      }
      //Millon Minoria y Millon Mayoria
      if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
        const minoritario = colorMenosRepetido([0, 1, 2, 3]);
        if (minoritario === 'empate') {
          getCelda('Millón Minoría', 1).style.backgroundColor = 'red';
          getCelda('Millón Minoría', 4).style.backgroundColor = 'green';
          getCelda('Millón Mayoría', 1).style.backgroundColor = 'green';
          getCelda('Millón Mayoría', 4).style.backgroundColor = 'red';
        }
        else if (minoritario === 'red') {
          getCelda('Millón Minoría', 1).style.backgroundColor = 'red';
          getCelda('Millón Minoría', 4).style.backgroundColor = 'red';
          getCelda('Millón Mayoría', 1).style.backgroundColor = 'green';
          getCelda('Millón Mayoría', 4).style.backgroundColor = 'green';
        }
        else {
          getCelda('Millón Minoría', 1).style.backgroundColor = 'green';
          getCelda('Millón Minoría', 4).style.backgroundColor = 'green';
          getCelda('Millón Mayoría', 1).style.backgroundColor = 'red';
          getCelda('Millón Mayoría', 4).style.backgroundColor = 'red';
        }
      }
      getCelda('MHI 3 Minoría', 3).style.backgroundColor = '';
      getCelda('MHI 3 Minoría', 6).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 3).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 6).style.backgroundColor = '';
      //Analasis para Torres Gemelas
      getCelda('Torres Gemelas', 1).style.backgroundColor = '';
      getCelda('Torres Gemelas', 4).style.backgroundColor = '';
      if (coloresDigitos[0] !== 'doji') {
        if (coloresDigitos[0] === 'green') {
          getCelda('Torres Gemelas', 5).style.backgroundColor = coloresDigitos[0];
        } else {
          getCelda('Torres Gemelas', 2).style.backgroundColor = coloresDigitos[0];
        }
      }
      //Analisis correspondiente a TRES MOSQUETEROS
      getCelda('Tres Mosqueteros', 2).style.backgroundColor = '';
      getCelda('Tres Mosqueteros', 5).style.backgroundColor = '';
      if (coloresDigitos[2] !== 'doji') {
        if (coloresDigitos[2] !== coloresDigitos[3]) {
          if (coloresDigitos[2] === 'green') {
            getCelda('Tres Mosqueteros', 6).style.backgroundColor = 'green';
          } else {
            getCelda('Tres Mosqueteros', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analisis correspondiente a TRES VECINOS
      getCelda('Tres Vecinos', 1).style.backgroundColor = '';
      getCelda('Tres Vecinos', 4).style.backgroundColor = '';
      if (coloresDigitos[3] !== 'doji') {
        if (coloresDigitos[3] === 'green') {
          getCelda('Tres Vecinos', 5).style.backgroundColor = 'green';
        } else {
          getCelda('Tres Vecinos', 2).style.backgroundColor = 'red';
        }
      }
      //Analasis para MEJOR DE TRES
      getCelda('Mejor de 3', 3).style.backgroundColor = '';
      getCelda('Mejor de 3', 6).style.backgroundColor = '';
      //Analisis Patron 3x1
      getCelda('Patron 3x1', 1).style.backgroundColor = '';
      getCelda('Patron 3x1', 4).style.backgroundColor = '';
      if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {    //Para si hay un doji no hacer nada
        const minoritario = colorMenosRepetido([0, 1, 2]);
        if (minoritario === 'green') {
          getCelda('Patron 3x1', 5).style.backgroundColor = 'green';
        } else {
          getCelda('Patron 3x1', 2).style.backgroundColor = 'red';
        }
      }
      // Analisis Patron Impar
      getCelda('Patrón Impar', 3).style.backgroundColor = '';
      getCelda('Patrón Impar', 6).style.backgroundColor = '';
      if (coloresDigitos[2] !== 'doji') {
        getCelda('Patrón Impar', 1).style.backgroundColor = coloresDigitos[2];
        getCelda('Patrón Impar', 4).style.backgroundColor = coloresDigitos[2];
      }

      //Analisis de las que pueden ganar en este digito:
      //MHI mayoria2 y minoria2
      if (valorSelect === "mg2") {
        if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
          const minoritario = colorMenosRepetido([7, 8, 9]);
          if (minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2] && minoritario === coloresDigitos[3]) {
            agregarResultadoConTiempo(historicoMHI2, "G2", "MHI_2_Minoría");
          } else if (minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2] && minoritario !== coloresDigitos[3]) {
            agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minoría");
          }
          const mayoritario = colorMasRepetido([7, 8, 9]);

          if (mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2] && mayoritario === coloresDigitos[3]) {
            agregarResultadoConTiempo(historicoMHI2MAY, "G2", "MHI_2_Mayoría");
          } else if (mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3]) {
            agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayoría");
          }
        }

      }
      //MHI mayoria3 y minoria3
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
          const minoritario = colorMenosRepetido([7, 8, 9]);
          const mayoritario = colorMasRepetido([7, 8, 9]);

          if (minoritario !== coloresDigitos[2] && minoritario === coloresDigitos[3]) {
            agregarResultadoConTiempo(historicoMHI3, "G1", "MHI_3_Minoría");
          }
          if (valorSelect === "mg1") {
            if (minoritario !== coloresDigitos[2] && minoritario !== coloresDigitos[3]) {
              agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minoría");
            }
          }

          if (mayoritario !== coloresDigitos[2] && mayoritario === coloresDigitos[3]) {
            agregarResultadoConTiempo(historicoMHI3MAY, "G1", "MHI_3_Mayoría");
          }
          if (valorSelect === "mg1") {
            if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3]) {
              agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayoría");
            }
          }
        }
      }







      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
          const mayoritario = colorMasRepetido([6, 7, 8]);
          if (mayoritario !== coloresDigitos[2] && mayoritario === coloresDigitos[3]) {
            agregarResultadoConTiempo(historicoMEJOR3, "G1", "Mejor_de_3");
          }
          if (valorSelect === "mg1") {
            if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3]) {
              agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");
            }
          }
        }
      }


      //Tres Mosqueteros
      if (coloresDigitos[2] === 'doji') {
        agregarResultadoConTiempo(historicoMOSQUETEROS, "E", "Tres_Mosqueteros");
      } else {
        if (coloresDigitos[2] === coloresDigitos[3]) {
          agregarResultadoConTiempo(historicoMOSQUETEROS, "D", "Tres_Mosqueteros");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
          }
        }

      }
      //Patron 23
      if (valorSelect === "mg2") {
        if (coloresDigitos[0] !== 'doji') {
          if (coloresDigitos[0] !== coloresDigitos[1] && coloresDigitos[0] !== coloresDigitos[2] && coloresDigitos[0] === coloresDigitos[3]) {
            agregarResultadoConTiempo(historicoPADRON23, "G2", "Patrón_23");
          } else if (coloresDigitos[0] !== coloresDigitos[1] && coloresDigitos[0] !== coloresDigitos[2] && coloresDigitos[0] !== coloresDigitos[3]) {

            agregarResultadoConTiempo(historicoPADRON23, "L", "Patrón_23");
          }
        }
      }
    }

    function digito4(vela) {
      ultimaVela = coloresDigitos[4];
      //Analisis Correspondiente a MHMI Minoria MHI Mayoria
      ['MHI Minoría', 'MHI Mayoría', 'Millón Minoría', 'Millón Mayoría'].forEach(patron => {
        getCelda(patron, 1).style.backgroundColor = '';
        getCelda(patron, 4).style.backgroundColor = '';
      });
      if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
        const minoritario = colorMenosRepetido([2, 3, 4]);
        if (minoritario === 'red') {
          getCelda('MHI Minoría', 2).style.backgroundColor = 'red';
          getCelda('MHI Mayoría', 5).style.backgroundColor = 'green';
        } else if (minoritario === 'green') {
          getCelda('MHI Minoría', 5).style.backgroundColor = 'green';
          getCelda('MHI Mayoría', 2).style.backgroundColor = 'red';
        }
      }
      //Analisis Correspondiente a Millón Minoria Millón Mayoria
      if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {    //Para si hay un doji no hacer nada
        const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
        if (minoritario === 'red') {
          getCelda('Millón Minoría', 2).style.backgroundColor = 'red';
          getCelda('Millón Mayoría', 5).style.backgroundColor = 'green';
        } else {
          getCelda('Millón Minoría', 5).style.backgroundColor = 'green';
          getCelda('Millón Mayoría', 2).style.backgroundColor = 'red';
        }
      }

      //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
      if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
        const minoritario = colorMenosRepetido([2, 3, 4]);
        if (minoritario === 'red') {
          getCelda('MHI 2 Minoría', 1).style.backgroundColor = 'red';
          getCelda('MHI 2 Minoría', 4).style.backgroundColor = 'red';
          getCelda('MHI 2 Mayoría', 1).style.backgroundColor = 'green';
          getCelda('MHI 2 Mayoría', 4).style.backgroundColor = 'green';
        } else if (minoritario === 'green') {
          getCelda('MHI 2 Minoría', 1).style.backgroundColor = 'green';
          getCelda('MHI 2 Minoría', 4).style.backgroundColor = 'green';
          getCelda('MHI 2 Mayoría', 1).style.backgroundColor = 'red';
          getCelda('MHI 2 Mayoría', 4).style.backgroundColor = 'red';

        }
      }
      //Analasis para Torres Gemelas
      getCelda('Torres Gemelas', 2).style.backgroundColor = '';
      getCelda('Torres Gemelas', 5).style.backgroundColor = '';
      if (coloresDigitos[0] !== 'doji') {
        if (coloresDigitos[0] !== coloresDigitos[4]) {
          if (coloresDigitos[0] === 'green') {
            getCelda('Torres Gemelas', 6).style.backgroundColor = coloresDigitos[0];
          } else {
            getCelda('Torres Gemelas', 3).style.backgroundColor = coloresDigitos[0];
          }
        }
      }
      //Analisis correspondiente a TRES MOSQUETEROS
      getCelda('Tres Mosqueteros', 3).style.backgroundColor = '';
      getCelda('Tres Mosqueteros', 6).style.backgroundColor = '';
      //Analisis correspondiente a TRES VECINOS
      getCelda('Tres Vecinos', 2).style.backgroundColor = '';
      getCelda('Tres Vecinos', 5).style.backgroundColor = '';
      if (coloresDigitos[3] !== 'doji') {
        if (coloresDigitos[3] !== coloresDigitos[4]) {
          if (coloresDigitos[3] === 'green') {
            getCelda('Tres Vecinos', 6).style.backgroundColor = 'green';
          } else {
            getCelda('Tres Vecinos', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analisis correspondiente a PATRON 23
      getCelda('Patrón 23', 1).style.backgroundColor = 'green';
      getCelda('Patrón 23', 4).style.backgroundColor = 'red';
      //Analisis Patron 3x1
      getCelda('Patron 3x1', 2).style.backgroundColor = '';
      getCelda('Patron 3x1', 5).style.backgroundColor = '';
      if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {    //Para si hay un doji no hacer nada
        const minoritario = colorMenosRepetido([0, 1, 2]);
        if (minoritario !== coloresDigitos[4]) {
          if (minoritario === 'green') {
            getCelda('Patron 3x1', 6).style.backgroundColor = 'green';
          } else {
            getCelda('Patron 3x1', 3).style.backgroundColor = 'red';
          }
        }
      }
      // Analisis Patron Impar
      getCelda('Patrón Impar', 1).style.backgroundColor = '';
      getCelda('Patrón Impar', 4).style.backgroundColor = '';

      //MHI mayoria3 y minoria3
      if (valorSelect === "mg2") {
        if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
          const minoritario = colorMenosRepetido([7, 8, 9]);
          const mayoritario = colorMasRepetido([7, 8, 9]);
          if (minoritario !== coloresDigitos[2] && minoritario !== coloresDigitos[3] && minoritario === coloresDigitos[4]) {
            agregarResultadoConTiempo(historicoMHI3, "G2", "MHI_3_Minoría");
          } else if (minoritario !== coloresDigitos[2] && minoritario !== coloresDigitos[3] && minoritario !== coloresDigitos[4]) {
            agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minoría");
          }
          if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario === coloresDigitos[4]) {
            agregarResultadoConTiempo(historicoMHI3MAY, "G2", "MHI_3_Mayoría");
          } else if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario !== coloresDigitos[4]) {
            agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayoría");
          }
        }

      }
      //Torres Gemelas
      if (coloresDigitos[0] === 'doji') {
        agregarResultadoConTiempo(historicoTORRESGEMELAS, "E", "Torres_Gemelas");
      } else {
        if (coloresDigitos[0] === coloresDigitos[4]) {
          agregarResultadoConTiempo(historicoTORRESGEMELAS, "D", "Torres_Gemelas");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
          }
        }

      }

      if (valorSelect === "mg2") {
        if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
          const mayoritario = colorMasRepetido([6, 7, 8]);
          if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario === coloresDigitos[4]) {
            agregarResultadoConTiempo(historicoMEJOR3, "G2", "Mejor_de_3");
          } else if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario !== coloresDigitos[4]) {

            agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");

          }
        }
      }

      //Tres mosqueteros
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[2] !== 'doji') {
          if (coloresDigitos[2] !== coloresDigitos[3] && coloresDigitos[2] === coloresDigitos[4]) {
            agregarResultadoConTiempo(historicoMOSQUETEROS, "G1", "Tres_Mosqueteros");
          }
          if (valorSelect === "mg1") {
            if (coloresDigitos[2] !== coloresDigitos[3] && coloresDigitos[2] !== coloresDigitos[4]) {
              agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
            }
          }
        }
      }
      //Patron Impar
      if (valorSelect === "mg2") {
        if (coloresDigitos[7] !== 'doji') {
          if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] !== coloresDigitos[2] && coloresDigitos[7] === coloresDigitos[4]) {
            agregarResultadoConTiempo(historicoPATRONIMPAR, "G2", "Patrón_Impar");
          } else if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] !== coloresDigitos[2] && coloresDigitos[7] !== coloresDigitos[4]) {

            agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patrón_Impar");
          }
        }
      }
      //Tres Vecinos
      if (coloresDigitos[3] === 'doji') {
        agregarResultadoConTiempo(historicoTRESVECINOS, "E", "Tres_Vecinos");
      } else {
        if (coloresDigitos[3] === coloresDigitos[4]) {
          agregarResultadoConTiempo(historicoTRESVECINOS, "D", "Tres_Vecinos");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
          }
        }

      }
      //Patron 3x1
      if (coloresDigitos[0] === 'doji' || coloresDigitos[1] === 'doji' || coloresDigitos[2] === 'doji') {
        agregarResultadoConTiempo(historicoPATRON3X1, "E", "Patron_3x1");
      } else {
        const minoritario = colorMenosRepetido([0, 1, 2]);
        if (minoritario === coloresDigitos[4]) {
          agregarResultadoConTiempo(historicoPATRON3X1, "D", "Patron_3x1");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
          }
        }

      }
    }

    function digito5(vela) {
      ultimaVela = coloresDigitos[5];
      ['MHI Minoría', 'MHI Mayoría', 'Millón Minoría', 'Millón Mayoría'].forEach(patron => {
        getCelda(patron, 2).style.backgroundColor = '';
        getCelda(patron, 5).style.backgroundColor = '';
      });
      //Analisis Correspondiente a NHI Minoria MHI Mayoria
      if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
        const minoritario = colorMenosRepetido([2, 3, 4]);
        if (minoritario === coloresDigitos[5]) {
          // Gana MHI Minoría, pierde MHI Mayoría
          if (minoritario === 'green') {
            getCelda('MHI Mayoría', 3).style.backgroundColor = 'red';
          } else if (minoritario === 'red') {
            getCelda('MHI Mayoría', 6).style.backgroundColor = 'green';
          }
        } else {
          // Gana MHI Mayoría, pierde MHI Minoría
          if (minoritario === 'green') {
            getCelda('MHI Minoría', 6).style.backgroundColor = 'green';
          } else if (minoritario === 'red') {
            getCelda('MHI Minoría', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analisis Correspondiente a Millón Minoria Millón Mayoria
      if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {    //Para si hay un doji no hacer nada
        const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
        if (minoritario === coloresDigitos[5]) {   //Se gana mill minoria y se pierde mill mayoria
          if (minoritario === 'green') {
            getCelda('Millón Mayoría', 3).style.backgroundColor = 'red';
          }
          if (minoritario === 'red') {
            getCelda('Millón Mayoría', 6).style.backgroundColor = 'green';
          }
        } else {
          if (minoritario === 'green') {
            getCelda('Millón Minoría', 6).style.backgroundColor = 'green';
          }
          if (minoritario === 'red') {
            getCelda('Millón Minoría', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
      getCelda('MHI 2 Minoría', 1).style.backgroundColor = '';
      getCelda('MHI 2 Minoría', 4).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 1).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 4).style.backgroundColor = '';
      if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
        const minoritario = colorMenosRepetido([2, 3, 4]);
        if (minoritario === 'green') {
          getCelda('MHI 2 Minoría', 5).style.backgroundColor = 'green';
          getCelda('MHI 2 Mayoría', 2).style.backgroundColor = 'red';
        } else {
          getCelda('MHI 2 Minoría', 2).style.backgroundColor = 'red';
          getCelda('MHI 2 Mayoría', 5).style.backgroundColor = 'green';
        }
      }
      //Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
      if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
        const minoritario = colorMenosRepetido([2, 3, 4]);
        if (minoritario === 'red') {
          getCelda('MHI 3 Minoría', 1).style.backgroundColor = 'red';
          getCelda('MHI 3 Minoría', 4).style.backgroundColor = 'red';
          getCelda('MHI 3 Mayoría', 1).style.backgroundColor = 'green';
          getCelda('MHI 3 Mayoría', 4).style.backgroundColor = 'green';
        } else if (minoritario === 'green') {
          getCelda('MHI 3 Minoría', 1).style.backgroundColor = 'green';
          getCelda('MHI 3 Minoría', 4).style.backgroundColor = 'green';
          getCelda('MHI 3 Mayoría', 1).style.backgroundColor = 'red';
          getCelda('MHI 3 Mayoría', 4).style.backgroundColor = 'red';
        }
      }
      //Analasis para Torres Gemelas
      getCelda('Torres Gemelas', 3).style.backgroundColor = '';
      getCelda('Torres Gemelas', 6).style.backgroundColor = '';
      //Analisis correspondiente a TRES VECINOS
      getCelda('Tres Vecinos', 3).style.backgroundColor = '';
      getCelda('Tres Vecinos', 6).style.backgroundColor = '';
      //Analisis correspondiente a PATRON 23
      getCelda('Patrón 23', 1).style.backgroundColor = '';
      getCelda('Patrón 23', 4).style.backgroundColor = '';
      if (coloresDigitos[5] !== 'doji') {
        if (coloresDigitos[5] === 'green') {
          getCelda('Patrón 23', 5).style.backgroundColor = 'green';
        } else {
          getCelda('Patrón 23', 2).style.backgroundColor = 'red';
        }
      }
      //Analasis para MEJOR DE TRES
      if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
        const minoritario = colorMenosRepetido([1, 2, 3]);
        if (minoritario === 'green') {
          getCelda('Mejor de 3', 1).style.backgroundColor = 'red';
          getCelda('Mejor de 3', 4).style.backgroundColor = 'red';
        } else {
          getCelda('Mejor de 3', 1).style.backgroundColor = 'green';
          getCelda('Mejor de 3', 4).style.backgroundColor = 'green';
        }
      }
      //Analisis Patron 3x1
      getCelda('Patron 3x1', 3).style.backgroundColor = '';
      getCelda('Patron 3x1', 6).style.backgroundColor = '';
      // Analisis Patron Impar
      if (coloresDigitos[2] !== 'doji') {
        if (coloresDigitos[2] !== coloresDigitos[5]) {
          if (coloresDigitos[2] === 'green') {
            getCelda('Patrón Impar', 2).style.backgroundColor = 'green';
            getCelda('Patrón Impar', 5).style.backgroundColor = 'green';
          } else {
            getCelda('Patrón Impar', 2).style.backgroundColor = 'red';
            getCelda('Patrón Impar', 5).style.backgroundColor = 'red';
          }
        }
      }
      //Analisis de las que pueden ganar en este digito:
      //MHI mayoria y minoria
      if (coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
        agregarResultadoConTiempo(historicoMHI, "E", "MHI_Minoría");
        agregarResultadoConTiempo(historicoMHIMAY, "E", "MHI_Mayoría");
      } else {
        const minoritario = colorMenosRepetido([2, 3, 4]);
        if (minoritario === coloresDigitos[5]) {
          agregarResultadoConTiempo(historicoMHI, "D", "MHI_Minoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minoría");
          }
        }

        const mayoritario = colorMasRepetido([2, 3, 4]);
        if (mayoritario === coloresDigitos[5]) {
          agregarResultadoConTiempo(historicoMHIMAY, "D", "MHI_Mayoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayoría");
          }
        }

      }
      //MHI mayoria y minoria
      if (coloresDigitos[0] === 'doji' || coloresDigitos[1] === 'doji' || coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
        agregarResultadoConTiempo(historicoMILLONMIN, "E", "Millón_Minoría");
        agregarResultadoConTiempo(historicoMILLONMAY, "E", "Millón_Mayoría");
      } else {
        const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
        if (minoritario === coloresDigitos[5]) {
          agregarResultadoConTiempo(historicoMILLONMIN, "D", "Millón_Minoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMILLONMIN, "L", "Millón_Minoría");
          }
        }

        const mayoritario = colorMasRepetido([0, 1, 2, 3, 4]);
        if (mayoritario === coloresDigitos[5]) {
          agregarResultadoConTiempo(historicoMILLONMAY, "D", "Millón_Mayoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMILLONMAY, "L", "Millón_Mayoría");
          }
        }

      }
      //Torres Gemelas
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[0] !== 'doji') {
          if (coloresDigitos[0] !== coloresDigitos[4] && coloresDigitos[0] === coloresDigitos[5]) {
            agregarResultadoConTiempo(historicoTORRESGEMELAS, "G1", "Torres_Gemelas");
          }
          if (valorSelect === "mg1") {
            if (coloresDigitos[0] !== coloresDigitos[4] && coloresDigitos[0] !== coloresDigitos[5]) {
              agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
            }
          }
        }
      }
      //Tres Mosqueteros
      if (valorSelect === "mg2") {
        if (coloresDigitos[2] !== 'doji') {
          if (coloresDigitos[2] !== coloresDigitos[3] && coloresDigitos[2] !== coloresDigitos[4] && coloresDigitos[2] === coloresDigitos[5]) {
            agregarResultadoConTiempo(historicoMOSQUETEROS, "G2", "Tres_Mosqueteros");
          } else if (coloresDigitos[2] !== coloresDigitos[3] && coloresDigitos[2] !== coloresDigitos[4] && coloresDigitos[2] !== coloresDigitos[5]) {

            agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
          }
        }
      }
      //Patron Impar
      if (coloresDigitos[2] === 'doji') {
        agregarResultadoConTiempo(historicoPATRONIMPAR, "E", "Patrón_Impar");
      } else {
        if (coloresDigitos[2] === coloresDigitos[5]) {
          agregarResultadoConTiempo(historicoPATRONIMPAR, "D", "Patrón_Impar");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patrón_Impar");
          }
        }

      }
      //Tres Vecinos
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[3] !== 'doji') {
          if (coloresDigitos[3] !== coloresDigitos[4] && coloresDigitos[3] === coloresDigitos[5]) {
            agregarResultadoConTiempo(historicoTRESVECINOS, "G1", "Tres_Vecinos");
          }
          if (valorSelect === "mg1") {
            if (coloresDigitos[3] !== coloresDigitos[4] && coloresDigitos[3] !== coloresDigitos[5]) {
              agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
            }
          }
        }
      }
      //Patron 3x1
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {
          const minoritario = colorMenosRepetido([0, 1, 2]);
          if (minoritario !== coloresDigitos[4] && minoritario === coloresDigitos[5]) {
            agregarResultadoConTiempo(historicoPATRON3X1, "G1", "Patron_3x1");
          }
          if (valorSelect === "mg1") {
            if (minoritario !== coloresDigitos[4] && minoritario !== coloresDigitos[5]) {
              agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
            }
          }
        }
      }



    }

    function digito6(vela) {
      ultimaVela = coloresDigitos[6];
      ['MHI Minoría', 'MHI Mayoría', 'Millón Minoría', 'Millón Mayoría'].forEach(patron => {
        getCelda(patron, 3).style.backgroundColor = '';
        getCelda(patron, 6).style.backgroundColor = '';
      });
      //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
      getCelda('MHI 2 Minoría', 2).style.backgroundColor = '';
      getCelda('MHI 2 Minoría', 5).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 2).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 5).style.backgroundColor = '';
      if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
        const minoritario = colorMenosRepetido([2, 3, 4]);
        if (minoritario === coloresDigitos[6]) {
          if (minoritario === 'green') {
            getCelda('MHI 2 Mayoría', 3).style.backgroundColor = 'red';
          }
          else {
            getCelda('MHI 2 Mayoría', 6).style.backgroundColor = 'green';
          }
        } else {
          if (minoritario === 'green') {
            getCelda('MHI 2 Minoría', 6).style.backgroundColor = 'green';
          }
          else {
            getCelda('MHI 2 Minoría', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
      getCelda('MHI 3 Minoría', 1).style.backgroundColor = '';
      getCelda('MHI 3 Minoría', 4).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 1).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 4).style.backgroundColor = '';
      if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
        const minoritario = colorMenosRepetido([2, 3, 4]);
        if (minoritario === 'green') {
          getCelda('MHI 3 Minoría', 5).style.backgroundColor = 'green';
          getCelda('MHI 3 Mayoría', 2).style.backgroundColor = 'red';
        } else {
          getCelda('MHI 3 Minoría', 2).style.backgroundColor = 'red';
          getCelda('MHI 3 Mayoría', 5).style.backgroundColor = 'green';
        }
      }
      //Analisis correspondiente a TRES MOSQUETEROS
      getCelda('Tres Mosqueteros', 1).style.backgroundColor = 'green';
      getCelda('Tres Mosqueteros', 4).style.backgroundColor = 'red';
      //Analisis correspondiente a PATRON 23
      getCelda('Patrón 23', 2).style.backgroundColor = '';
      getCelda('Patrón 23', 5).style.backgroundColor = '';
      if (coloresDigitos[5] !== 'doji') {
        if (coloresDigitos[5] !== coloresDigitos[6]) {
          if (coloresDigitos[5] === 'green') {
            getCelda('Patrón 23', 6).style.backgroundColor = 'green';
          } else {
            getCelda('Patrón 23', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analasis para MEJOR DE TRES
      getCelda('Mejor de 3', 1).style.backgroundColor = '';
      getCelda('Mejor de 3', 4).style.backgroundColor = '';
      if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
        const minoritario = colorMenosRepetido([1, 2, 3]);
        if (minoritario === "green") {
          getCelda('Mejor de 3', 2).style.backgroundColor = 'red';
        } else {
          getCelda('Mejor de 3', 5).style.backgroundColor = 'green';
        }
      }
      // Analisis Patron Impar
      getCelda('Patrón Impar', 2).style.backgroundColor = '';
      getCelda('Patrón Impar', 5).style.backgroundColor = '';

      //Analisis de las que pueden ganar en este digito:
      //MHI mayoria y minoria
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
          const minoritario = colorMenosRepetido([2, 3, 4]);
          const mayoritario = colorMasRepetido([2, 3, 4]);

          if (minoritario !== coloresDigitos[5] && minoritario === coloresDigitos[6]) {
            agregarResultadoConTiempo(historicoMHI, "G1", "MHI_Minoría");
          }
          if (valorSelect === "mg1") {
            if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6]) {
              agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minoría");
            }
          }
          if (mayoritario !== coloresDigitos[5] && mayoritario === coloresDigitos[6]) {
            agregarResultadoConTiempo(historicoMHIMAY, "G1", "MHI_Mayoría");
          }
          if (valorSelect === "mg1") {
            if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6]) {
              agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayoría");
            }
          }
        }
      }




      //MHI mayoria2 y minoria2
      if (coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
        agregarResultadoConTiempo(historicoMHI2, "E", "MHI_2_Minoría");
        agregarResultadoConTiempo(historicoMHI2MAY, "E", "MHI_2_Mayoría");
      } else {
        const minoritario = colorMenosRepetido([2, 3, 4]);
        if (minoritario === coloresDigitos[6]) {
          agregarResultadoConTiempo(historicoMHI2, "D", "MHI_2_Minoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minoría");
          }
        }

        const mayoritario = colorMasRepetido([2, 3, 4]);
        if (mayoritario === coloresDigitos[6]) {
          agregarResultadoConTiempo(historicoMHI2MAY, "D", "MHI_2_Mayoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayoría");
          }
        }

      }

      //MHI mayoria y minoria
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
          const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
          const mayoritario = colorMasRepetido([0, 1, 2, 3, 4]);

          if (minoritario !== coloresDigitos[5] && minoritario === coloresDigitos[6]) {
            agregarResultadoConTiempo(historicoMILLONMIN, "G1", "Millón_Minoría");
          }
          if (valorSelect === "mg1") {
            if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6]) {
              agregarResultadoConTiempo(historicoMILLONMIN, "L", "Millón_Minoría");
            }
          }

          if (mayoritario !== coloresDigitos[5] && mayoritario === coloresDigitos[6]) {
            agregarResultadoConTiempo(historicoMILLONMAY, "G1", "Millón_Mayoría");
          }
          if (valorSelect === "mg1") {
            if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6]) {
              agregarResultadoConTiempo(historicoMILLONMAY, "L", "Millón_Mayoría");
            }
          }

        }
      }





      //Torres Gemelas
      if (valorSelect === "mg2") {
        if (coloresDigitos[0] !== 'doji') {
          if (coloresDigitos[0] !== coloresDigitos[4] && coloresDigitos[0] !== coloresDigitos[5] && coloresDigitos[0] === coloresDigitos[6]) {
            agregarResultadoConTiempo(historicoTORRESGEMELAS, "G2", "Torres_Gemelas");
          } else if (coloresDigitos[0] !== coloresDigitos[4] && coloresDigitos[0] !== coloresDigitos[5] && coloresDigitos[0] !== coloresDigitos[6]) {

            agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
          }
        }
      }
      //Tres Vecinos
      if (valorSelect === "mg2") {
        if (coloresDigitos[3] !== 'doji') {
          if (coloresDigitos[3] !== coloresDigitos[4] && coloresDigitos[3] !== coloresDigitos[5] && coloresDigitos[3] === coloresDigitos[6]) {
            agregarResultadoConTiempo(historicoTRESVECINOS, "G2", "Tres_Vecinos");
          } else if (coloresDigitos[3] !== coloresDigitos[4] && coloresDigitos[3] !== coloresDigitos[5] && coloresDigitos[3] !== coloresDigitos[6]) {

            agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
          }
        }
      }
      //Patron 3x1
      if (valorSelect === "mg2") {
        if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {
          const minoritario = colorMenosRepetido([0, 1, 2]);
          if (minoritario !== coloresDigitos[4] && minoritario !== coloresDigitos[5] && minoritario === coloresDigitos[6]) {
            agregarResultadoConTiempo(historicoPATRON3X1, "G2", "Patron_3x1");
          } else if (minoritario !== coloresDigitos[4] && minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6]) {

            agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
          }
        }
      }
      //Patron 23
      if (coloresDigitos[5] === 'doji') {
        agregarResultadoConTiempo(historicoPADRON23, "E", "Patrón_23");
      } else {
        if (coloresDigitos[5] === coloresDigitos[6]) {
          agregarResultadoConTiempo(historicoPADRON23, "D", "Patrón_23");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoPADRON23, "L", "Patrón_23");
          }
        }

      }

    }

    function digito7(vela) {
      ultimaVela = coloresDigitos[7];
      //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
      getCelda('MHI 2 Minoría', 3).style.backgroundColor = '';
      getCelda('MHI 2 Minoría', 6).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 3).style.backgroundColor = '';
      getCelda('MHI 2 Mayoría', 6).style.backgroundColor = '';
      getCelda('MHI 3 Minoría', 2).style.backgroundColor = '';
      getCelda('MHI 3 Minoría', 5).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 2).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 5).style.backgroundColor = '';
      if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
        const minoritario = colorMenosRepetido([2, 3, 4]);
        if (minoritario === coloresDigitos[7]) {
          if (minoritario === 'green') {
            getCelda('MHI 3 Mayoría', 3).style.backgroundColor = 'red';
          } else {
            getCelda('MHI 3 Mayoría', 6).style.backgroundColor = 'green';
          }
        } else {
          if (minoritario === 'green') {
            getCelda('MHI 3 Minoría', 6).style.backgroundColor = 'green';
          } else {
            getCelda('MHI 3 Minoría', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analasis para Torres Gemelas
      if (coloresDigitos[5] !== 'doji') {
        getCelda('Torres Gemelas', 1).style.backgroundColor = coloresDigitos[5];
        getCelda('Torres Gemelas', 4).style.backgroundColor = coloresDigitos[5];
      }
      //Analisis correspondiente a TRES MOSQUETEROS
      getCelda('Tres Mosqueteros', 1).style.backgroundColor = '';
      getCelda('Tres Mosqueteros', 4).style.backgroundColor = '';
      if (coloresDigitos[7] !== 'doji') {
        if (coloresDigitos[7] === 'green') {
          getCelda('Tres Mosqueteros', 5).style.backgroundColor = 'green';
        } else {
          getCelda('Tres Mosqueteros', 2).style.backgroundColor = 'red';
        }
      }
      //Analisis correspondiente a TRES VECINOS
      getCelda('Tres Vecinos', 1).style.backgroundColor = 'green';
      getCelda('Tres Vecinos', 4).style.backgroundColor = 'red';
      //Analisis correspondiente a PATRON 23
      getCelda('Patrón 23', 3).style.backgroundColor = '';
      getCelda('Patrón 23', 6).style.backgroundColor = '';
      //Analasis para MEJOR DE TRES
      getCelda('Mejor de 3', 2).style.backgroundColor = '';
      getCelda('Mejor de 3', 5).style.backgroundColor = '';
      if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
        const minoritario = colorMenosRepetido([1, 2, 3]);
        if (minoritario === coloresDigitos[7]) {
          if (minoritario === "green") {
            getCelda('Mejor de 3', 3).style.backgroundColor = 'red';
          } else {
            getCelda('Mejor de 3', 6).style.backgroundColor = 'green';
          }
        }
      }
      //Analasis para MEJOR DE TRES
      getCelda('Mejor de 3', 3).style.backgroundColor = '';
      getCelda('Mejor de 3', 6).style.backgroundColor = '';
      //Analisis Patron 3x1
      if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {    //Para si hay un doji no hacer nada
        const minoritario = colorMenosRepetido([5, 6, 7]);
        getCelda('Patron 3x1', 1).style.backgroundColor = minoritario;
        getCelda('Patron 3x1', 4).style.backgroundColor = minoritario;

      }
      // Analisis Patron Impar
      if (coloresDigitos[2] !== 'doji') {
        if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] !== coloresDigitos[2]) {
          if (coloresDigitos[2] === 'green') {
            getCelda('Patrón Impar', 3).style.backgroundColor = 'green';
            getCelda('Patrón Impar', 6).style.backgroundColor = 'green';
          } else {
            getCelda('Patrón Impar', 3).style.backgroundColor = 'red';
            getCelda('Patrón Impar', 6).style.backgroundColor = 'red';
          }
        }
      }

      //Analisis de las que pueden ganar en este digito:
      //MHI mayoria y minoria
      if (valorSelect === "mg2") {
        if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
          const minoritario = colorMenosRepetido([2, 3, 4]);
          if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario === coloresDigitos[7]) {
            agregarResultadoConTiempo(historicoMHI, "G2", "MHI_Minoría");
          } else if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7]) {

            agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minoría");
          }
        }
        const mayoritario = colorMasRepetido([2, 3, 4]);
        if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario === coloresDigitos[7]) {
          agregarResultadoConTiempo(historicoMHIMAY, "G2", "MHI_Mayoría");
        } else if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7]) {

          agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayoría");

        }
      }
      //MHI mayoria2 y minoria2
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
          const minoritario = colorMenosRepetido([2, 3, 4]);
          const mayoritario = colorMasRepetido([2, 3, 4]);
          if (minoritario !== coloresDigitos[6] && minoritario === coloresDigitos[7]) {
            agregarResultadoConTiempo(historicoMHI2, "G1", "MHI_2_Minoría");
          }
          if (valorSelect === "mg1") {
            if (minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7]) {
              agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minoría");
            }
          }
          if (mayoritario !== coloresDigitos[6] && mayoritario === coloresDigitos[7]) {
            agregarResultadoConTiempo(historicoMHI2MAY, "G1", "MHI_2_Mayoría");
          }
          if (valorSelect === "mg1") {
            if (mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7]) {
              agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayoría");
            }
          }
        }
      }
      //MHI mayoria3 y minoria3
      if (coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
        agregarResultadoConTiempo(historicoMHI3, "E", "MHI_3_Minoría");
        agregarResultadoConTiempo(historicoMHI3MAY, "E", "MHI_3_Mayoría");
      } else {
        const minoritario = colorMenosRepetido([2, 3, 4]);
        if (minoritario === coloresDigitos[7]) {
          agregarResultadoConTiempo(historicoMHI3, "D", "MHI_3_Minoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minoría");
          }
        }

        const mayoritario = colorMasRepetido([2, 3, 4]);
        if (mayoritario === coloresDigitos[7]) {
          agregarResultadoConTiempo(historicoMHI3MAY, "D", "MHI_3_Mayoría");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayoría");
          }
        }

      }
      //MHI mayoria y minoria
      if (valorSelect === "mg2") {
        if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
          const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
          const mayoritario = colorMasRepetido([0, 1, 2, 3, 4]);
          if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario === coloresDigitos[7]) {
            agregarResultadoConTiempo(historicoMILLONMIN, "G2", "Millón_Minoría");
          } else if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7]) {

            agregarResultadoConTiempo(historicoMILLONMIN, "L", "Millón_Minoría");
          }
          if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario === coloresDigitos[7]) {
            agregarResultadoConTiempo(historicoMILLONMAY, "G2", "Millón_Mayoría");
          } else if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7]) {
            agregarResultadoConTiempo(historicoMILLONMAY, "L", "Millón_Mayoría");
          }


        }

      }
      //Mejor de 3
      if (coloresDigitos[1] === 'doji' || coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji') {
        agregarResultadoConTiempo(historicoMEJOR3, "E", "Mejor_de_3");
      } else {
        const mayoritario = colorMasRepetido([1, 2, 3]);
        if (mayoritario === coloresDigitos[7]) {
          agregarResultadoConTiempo(historicoMEJOR3, "D", "Mejor_de_3");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");
          }
        }

      }
      // Analisis Patron Impar
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[2] !== 'doji') {
          if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] === coloresDigitos[7]) {
            agregarResultadoConTiempo(historicoPATRONIMPAR, "G1", "Patrón_Impar");
          }
          if (valorSelect === "mg1") {
            if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] !== coloresDigitos[7]) {
              agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patrón_Impar");
            }
          }
        }
      }
      //Patron 23
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[5] !== 'doji') {
          if (coloresDigitos[5] !== coloresDigitos[6] && coloresDigitos[5] === coloresDigitos[7]) {
            agregarResultadoConTiempo(historicoPADRON23, "G1", "Patrón_23");
          }
          if (valorSelect === "mg1") {
            if (coloresDigitos[5] !== coloresDigitos[6] && coloresDigitos[5] !== coloresDigitos[7]) {
              agregarResultadoConTiempo(historicoPADRON23, "L", "Patrón_23");
            }
          }
        }
      }

    }

    function digito8(vela) {
      ultimaVela = coloresDigitos[8];
      //MHI Minoria y MHI Mayoria
      if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
        if (coloresDigitos[7] === coloresDigitos[8]) {
          const opuesto = coloresDigitos[7] === 'red' ? 'green' : 'red';
          getCelda('MHI Minoría', 1).style.backgroundColor = opuesto;
          getCelda('MHI Minoría', 4).style.backgroundColor = opuesto;
          getCelda('MHI Mayoría', 1).style.backgroundColor = coloresDigitos[7];
          getCelda('MHI Mayoría', 4).style.backgroundColor = coloresDigitos[7];
        } else {
          getCelda('MHI Minoría', 1).style.backgroundColor = 'red';
          getCelda('MHI Minoría', 4).style.backgroundColor = 'green';
          getCelda('MHI Mayoría', 1).style.backgroundColor = 'green';
          getCelda('MHI Mayoría', 4).style.backgroundColor = 'red';
        }
      }
      //Millon Minoria y Millon Mayoria
      if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
        const minoritario = colorMenosRepetido([5, 6, 7, 8]);
        if (minoritario === 'empate') {
          getCelda('Millón Minoría', 1).style.backgroundColor = 'red';
          getCelda('Millón Minoría', 4).style.backgroundColor = 'green';
          getCelda('Millón Mayoría', 1).style.backgroundColor = 'green';
          getCelda('Millón Mayoría', 4).style.backgroundColor = 'red';
        }
        else if (minoritario === 'red') {
          getCelda('Millón Minoría', 1).style.backgroundColor = 'red';
          getCelda('Millón Minoría', 4).style.backgroundColor = 'red';
          getCelda('Millón Mayoría', 1).style.backgroundColor = 'green';
          getCelda('Millón Mayoría', 4).style.backgroundColor = 'green';
        }
        else {
          getCelda('Millón Minoría', 1).style.backgroundColor = 'green';
          getCelda('Millón Minoría', 4).style.backgroundColor = 'green';
          getCelda('Millón Mayoría', 1).style.backgroundColor = 'red';
          getCelda('Millón Mayoría', 4).style.backgroundColor = 'red';
        }
      }
      getCelda('MHI 3 Minoría', 3).style.backgroundColor = '';
      getCelda('MHI 3 Minoría', 6).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 3).style.backgroundColor = '';
      getCelda('MHI 3 Mayoría', 6).style.backgroundColor = '';
      //Analasis para Torres Gemelas
      getCelda('Torres Gemelas', 1).style.backgroundColor = '';
      getCelda('Torres Gemelas', 4).style.backgroundColor = '';
      if (coloresDigitos[5] !== 'doji') {
        if (coloresDigitos[5] === 'green') {
          getCelda('Torres Gemelas', 5).style.backgroundColor = coloresDigitos[5];
        } else {
          getCelda('Torres Gemelas', 2).style.backgroundColor = coloresDigitos[5];
        }
      }
      //Analisis correspondiente a TRES MOSQUETEROS
      getCelda('Tres Mosqueteros', 2).style.backgroundColor = '';
      getCelda('Tres Mosqueteros', 5).style.backgroundColor = '';
      if (coloresDigitos[7] !== 'doji') {
        if (coloresDigitos[7] !== coloresDigitos[8]) {
          if (coloresDigitos[7] === 'green') {
            getCelda('Tres Mosqueteros', 6).style.backgroundColor = 'green';
          } else {
            getCelda('Tres Mosqueteros', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analisis correspondiente a TRES VECINOS
      getCelda('Tres Vecinos', 1).style.backgroundColor = '';
      getCelda('Tres Vecinos', 4).style.backgroundColor = '';
      if (coloresDigitos[8] !== 'doji') {
        if (coloresDigitos[8] === 'green') {
          getCelda('Tres Vecinos', 5).style.backgroundColor = 'green';
        } else {
          getCelda('Tres Vecinos', 2).style.backgroundColor = 'red';
        }
      }
      //Analisis Patron 3x1
      getCelda('Patron 3x1', 1).style.backgroundColor = '';
      getCelda('Patron 3x1', 4).style.backgroundColor = '';
      if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {    //Para si hay un doji no hacer nada
        const minoritario = colorMenosRepetido([5, 6, 7]);
        if (minoritario === 'green') {
          getCelda('Patron 3x1', 5).style.backgroundColor = 'green';
        } else {
          getCelda('Patron 3x1', 2).style.backgroundColor = 'red';
        }
      }
      // Analisis Patron Impar
      getCelda('Patrón Impar', 3).style.backgroundColor = '';
      getCelda('Patrón Impar', 6).style.backgroundColor = '';
      if (coloresDigitos[7] !== 'doji') {
        getCelda('Patrón Impar', 1).style.backgroundColor = coloresDigitos[7];
        getCelda('Patrón Impar', 4).style.backgroundColor = coloresDigitos[7];
      }
      //Analisis de las que pueden ganar en este digito:
      //MHI2 mayoria y minoria2
      if (valorSelect === "mg2") {
        if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
          const minoritario = colorMenosRepetido([2, 3, 4]);
          if (minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7] && minoritario === coloresDigitos[8]) {
            agregarResultadoConTiempo(historicoMHI2, "G2", "MHI_2_Minoría");
          } else if (minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7] && minoritario !== coloresDigitos[8]) {

            agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minoría");
          }
          const mayoritario = colorMasRepetido([2, 3, 4]);

          if (mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7] && mayoritario === coloresDigitos[8]) {
            agregarResultadoConTiempo(historicoMHI2MAY, "G2", "MHI_2_Mayoría");
          } else if (mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8]) {
            agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayoría");
          }
        }

      }
      //MHI mayoria3 y minoria3
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
          const minoritario = colorMenosRepetido([2, 3, 4]);
          const mayoritario = colorMasRepetido([2, 3, 4]);
          if (minoritario !== coloresDigitos[7] && minoritario === coloresDigitos[8]) {
            agregarResultadoConTiempo(historicoMHI3, "G1", "MHI_3_Minoría");
          }
          if (valorSelect === "mg1") {
            if (minoritario !== coloresDigitos[7] && minoritario !== coloresDigitos[8]) {
              agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minoría");
            }
          }

          if (mayoritario !== coloresDigitos[7] && mayoritario === coloresDigitos[8]) {
            agregarResultadoConTiempo(historicoMHI3MAY, "G1", "MHI_3_Mayoría");
          }
          if (valorSelect === "mg1") {
            if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8]) {
              agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayoría");
            }
          }
        }
      }


      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
          const mayoritario = colorMasRepetido([1, 2, 3]);
          if (mayoritario !== coloresDigitos[7] && mayoritario === coloresDigitos[8]) {
            agregarResultadoConTiempo(historicoMEJOR3, "G1", "Mejor_de_3");
          }
          if (valorSelect === "mg1") {
            if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8]) {
              agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");
            }
          }
        }
      }

      //Tres Mosqueteros
      if (coloresDigitos[7] === 'doji') {
        agregarResultadoConTiempo(historicoMOSQUETEROS, "E", "Tres_Mosqueteros");
      } else {
        if (coloresDigitos[7] === coloresDigitos[8]) {
          agregarResultadoConTiempo(historicoMOSQUETEROS, "D", "Tres_Mosqueteros");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
          }
        }

      }
      //Patron 23
      if (valorSelect === "mg2") {
        if (coloresDigitos[5] !== 'doji') {
          if (coloresDigitos[5] !== coloresDigitos[6] && coloresDigitos[5] !== coloresDigitos[7] && coloresDigitos[5] === coloresDigitos[8]) {
            agregarResultadoConTiempo(historicoPADRON23, "G2", "Patrón_23");
          } else if (coloresDigitos[5] !== coloresDigitos[6] && coloresDigitos[5] !== coloresDigitos[7] && coloresDigitos[5] !== coloresDigitos[8]) {

            agregarResultadoConTiempo(historicoPADRON23, "L", "Patrón_23");
          }
        }
      }

    }

    function digito9(vela) {
      ultimaVela = coloresDigitos[9];
      //Analisis Correspondiente a MHMI Minoria MHI Mayoria
      ['MHI Minoría', 'MHI Mayoría', 'Millón Minoría', 'Millón Mayoría'].forEach(patron => {
        getCelda(patron, 1).style.backgroundColor = '';
        getCelda(patron, 4).style.backgroundColor = '';
      });
      if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
        const minoritario = colorMenosRepetido([7, 8, 9]);
        if (minoritario === 'red') {
          getCelda('MHI Minoría', 2).style.backgroundColor = 'red';
          getCelda('MHI Mayoría', 5).style.backgroundColor = 'green';
        } else if (minoritario === 'green') {
          getCelda('MHI Minoría', 5).style.backgroundColor = 'green';
          getCelda('MHI Mayoría', 2).style.backgroundColor = 'red';
        }
      }
      //Analisis Correspondiente a MHMillónMI Minoria
      if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {    //Para si hay un doji no hacer nada
        const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
        if (minoritario === 'red') {
          getCelda('Millón Minoría', 2).style.backgroundColor = 'red';
          getCelda('Millón Mayoría', 5).style.backgroundColor = 'green';
        } else {
          getCelda('Millón Minoría', 5).style.backgroundColor = 'green';
          getCelda('Millón Mayoría', 2).style.backgroundColor = 'red';
        }
      }
      //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
      if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
        const minoritario = colorMenosRepetido([7, 8, 9]);
        if (minoritario === 'red') {
          getCelda('MHI 2 Minoría', 1).style.backgroundColor = 'red';
          getCelda('MHI 2 Minoría', 4).style.backgroundColor = 'red';
          getCelda('MHI 2 Mayoría', 1).style.backgroundColor = 'green';
          getCelda('MHI 2 Mayoría', 4).style.backgroundColor = 'green';
        } else if (minoritario === 'green') {
          getCelda('MHI 2 Minoría', 1).style.backgroundColor = 'green';
          getCelda('MHI 2 Minoría', 4).style.backgroundColor = 'green';
          getCelda('MHI 2 Mayoría', 1).style.backgroundColor = 'red';
          getCelda('MHI 2 Mayoría', 4).style.backgroundColor = 'red';
        }
      }
      //Analasis para Torres Gemelas
      getCelda('Torres Gemelas', 2).style.backgroundColor = '';
      getCelda('Torres Gemelas', 5).style.backgroundColor = '';
      if (coloresDigitos[5] !== 'doji') {
        if (coloresDigitos[5] !== coloresDigitos[9]) {
          if (coloresDigitos[5] === 'green') {
            getCelda('Torres Gemelas', 6).style.backgroundColor = coloresDigitos[0];
          } else {
            getCelda('Torres Gemelas', 3).style.backgroundColor = coloresDigitos[0];
          }
        }
      }
      //Analisis correspondiente a TRES MOSQUETEROS
      getCelda('Tres Mosqueteros', 3).style.backgroundColor = '';
      getCelda('Tres Mosqueteros', 6).style.backgroundColor = '';
      //Analisis correspondiente a TRES VECINOS
      getCelda('Tres Vecinos', 2).style.backgroundColor = '';
      getCelda('Tres Vecinos', 5).style.backgroundColor = '';
      if (coloresDigitos[8] !== 'doji') {
        if (coloresDigitos[8] !== coloresDigitos[9]) {
          if (coloresDigitos[8] === 'green') {
            getCelda('Tres Vecinos', 6).style.backgroundColor = 'green';
          } else {
            getCelda('Tres Vecinos', 3).style.backgroundColor = 'red';
          }
        }
      }
      //Analisis correspondiente a PATRON 23
      getCelda('Patrón 23', 1).style.backgroundColor = 'green';
      getCelda('Patrón 23', 4).style.backgroundColor = 'red';
      //Analisis Patron 3x1
      getCelda('Patron 3x1', 2).style.backgroundColor = '';
      getCelda('Patron 3x1', 5).style.backgroundColor = '';
      if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {    //Para si hay un doji no hacer nada
        const minoritario = colorMenosRepetido([5, 6, 7]);
        if (minoritario !== coloresDigitos[4]) {
          if (minoritario === 'green') {
            getCelda('Patron 3x1', 6).style.backgroundColor = 'green';
          } else {
            getCelda('Patron 3x1', 3).style.backgroundColor = 'red';
          }
        }
      }
      // Analisis Patron Impar
      getCelda('Patrón Impar', 1).style.backgroundColor = '';
      getCelda('Patrón Impar', 4).style.backgroundColor = '';

      //MHI2 mayoria y minoria2
      if (valorSelect === "mg2") {
        if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
          const minoritario = colorMenosRepetido([2, 3, 4]);
          const mayoritario = colorMasRepetido([2, 3, 4]);
          if (minoritario !== coloresDigitos[7] && minoritario !== coloresDigitos[8] && minoritario === coloresDigitos[9]) {
            agregarResultadoConTiempo(historicoMHI3, "G2", "MHI_3_Minoría");
          } else if (minoritario !== coloresDigitos[7] && minoritario !== coloresDigitos[8] && minoritario !== coloresDigitos[9]) {
            agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minoría");
          }
          if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario === coloresDigitos[9]) {
            agregarResultadoConTiempo(historicoMHI3MAY, "G2", "MHI_3_Mayoría");
          } else if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario !== coloresDigitos[9]) {
            agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayoría");
          }
        }

      }
      //Torres Gemelas
      if (coloresDigitos[5] === 'doji') {
        agregarResultadoConTiempo(historicoTORRESGEMELAS, "E", "Torres_Gemelas");
      } else {
        if (coloresDigitos[5] === coloresDigitos[9]) {
          agregarResultadoConTiempo(historicoTORRESGEMELAS, "D", "Torres_Gemelas");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
          }
        }

      }
      //Mejor de 3
      if (valorSelect === "mg2") {
        if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
          const mayoritario = colorMasRepetido([1, 2, 3]);
          if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario === coloresDigitos[9]) {
            agregarResultadoConTiempo(historicoMEJOR3, "G2", "Mejor_de_3");
          } else if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario !== coloresDigitos[9]) {

            agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");
          }
        }
      }
      //Tres mosqueteros
      if (valorSelect === "mg1" || valorSelect === "mg2") {
        if (coloresDigitos[7] !== 'doji') {
          if (coloresDigitos[7] !== coloresDigitos[8] && coloresDigitos[7] === coloresDigitos[9]) {
            agregarResultadoConTiempo(historicoMOSQUETEROS, "G1", "Tres_Mosqueteros");
          }
          if (valorSelect === "mg1") {
            if (coloresDigitos[7] !== coloresDigitos[8] && coloresDigitos[7] !== coloresDigitos[9]) {
              agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
            }
          }
        }
      }
      //Patron Impar
      if (valorSelect === "mg2") {
        if (coloresDigitos[2] !== 'doji') {
          if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] !== coloresDigitos[7] && coloresDigitos[2] === coloresDigitos[9]) {
            agregarResultadoConTiempo(historicoPATRONIMPAR, "G2", "Patrón_Impar");
          } else if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] !== coloresDigitos[7] && coloresDigitos[2] !== coloresDigitos[9]) {

            agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patrón_Impar");
          }
        }
      }
      //Tres Vecinos
      if (coloresDigitos[8] === 'doji') {
        agregarResultadoConTiempo(historicoTRESVECINOS, "E", "Tres_Vecinos");
      } else {
        if (coloresDigitos[8] === coloresDigitos[9]) {
          agregarResultadoConTiempo(historicoTRESVECINOS, "D", "Tres_Vecinos");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
          }
        }

      }
      //Patron 3x1
      if (coloresDigitos[5] === 'doji' || coloresDigitos[6] === 'doji' || coloresDigitos[7] === 'doji') {
        agregarResultadoConTiempo(historicoPATRON3X1, "E", "Patron_3x1");
      } else {
        const minoritario = colorMenosRepetido([5, 6, 7]);
        if (minoritario === coloresDigitos[9]) {
          agregarResultadoConTiempo(historicoPATRON3X1, "D", "Patron_3x1");
        } else {
          if (valorSelect === "sinMG") {
            agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
          }
        }
      }
    }

  </script>

  <script>
    async function verificaAlertas() {
      const ahora = new Date();
      const hora_final = ahora.getHours().toString().padStart(2, '0') + ':' +
        ahora.getMinutes().toString().padStart(2, '0');


      //Primero Confirmo si el usuario tiene las notificaciones activadas
      if (signalConfig.notificacion !== "none") {
        //Leer configuracion martingala
        let gale = "No usar Martin Gala";
        let condicion = "";
        let operacion = "";
        let cantGale = 0;
        if (signalConfig.martin_gala === "gale2") {
          gale = "Usar 2 Martin Gala";
          cantGale = 2
        } else if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale1trasperdida") {
          gale = "Usar 1 Martin Gala";
          cantGale = 1
        }


        if (signalConfig.confluencia) {  //Notificacion para la confluencia de patrones
          if (condicionConfluencia === ultimaVela) {
            confluenciaActiva = true;
          } else if (condicionConfluencia !== ultimaVela) {     //else if (condicionConfluencia !== null && condicionConfluencia !== ultimaVela) {
            confluenciaActiva = false;
            condicionConfluencia = null;
            direccionObjetivoConfluencia = null;
            firstLoss = 0;
          }

          if (confluenciaActiva) {

            if (signalConfig.martin_gala === "gale1trasperdida") {
              if (direccionObjetivoConfluencia === 'green') {
                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                  mostrarPopup("Confluencia de Patrones", "Bajista", "CALL", gale);
                }
              }
              if (direccionObjetivoConfluencia === 'red') {
                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                  mostrarPopup("Confluencia de Patrones", "Alcista", "PUT", gale);
                }
              }
              confluenciaActiva = false;
              condicionConfluencia = null;
              direccionObjetivoConfluencia = null;
              firstLoss = 0;
            }

            if (signalConfig.martin_gala === "nogale") {
              if (firstLoss === 0) {
              }
              if (firstLoss === 1) {
                if (direccionObjetivoConfluencia === 'green') {
                  if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                    mostrarPopup("Confluencia de Patrones", "Bajista", "CALL", gale);
                  }
                }
                if (direccionObjetivoConfluencia === 'red') {
                  if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                    mostrarPopup("Confluencia de Patrones", "Alcista", "PUT", gale);
                  }
                }
                confluenciaActiva = false;
                condicionConfluencia = null;
                direccionObjetivoConfluencia = null;
                firstLoss = 0;
              }
              if (firstLoss === 0 && direccionObjetivoConfluencia !== ultimaVela) {
                firstLoss++;
              }
            }
          }

          const conteo = contarCeldasColoreadas();
          if (conteo.verde.verde === 6) {
            if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
              if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                mostrarPopup("Confluencia de Patrones", "Alcista", "CALL", gale);
              }
            } else {
              condicionConfluencia = 'green'
              direccionObjetivoConfluencia = 'green'
            }
          }
          if (conteo.verde.rojo === 6) {
            if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
              if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                mostrarPopup("Confluencia de Patrones", "Alcista", "PUT", gale);
              }
            } else {
              condicionConfluencia = 'green'
              direccionObjetivoConfluencia = 'red'
            }
          }
          if (conteo.rojo.verde === 6) {
            if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
              if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                mostrarPopup("Confluencia de Patrones", "Bajista", "CALL", gale);
              }
            } else {
              condicionConfluencia = 'red'
              direccionObjetivoConfluencia = 'green'
            }
          }
          if (conteo.rojo.rojo === 6) {
            if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
              if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                mostrarPopup("Confluencia de Patrones", "Bajista", "PUT", gale);
              }
            } else {
              condicionConfluencia = 'red'
              direccionObjetivoConfluencia = 'red'
            }
          }
        }
        if (signalConfig.alcanza_100) { // Notificación para cuando alcanza el 100%
          for (let patron in alcanza100) {
            if (alcanza100[patron]) {
              const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                fila => fila.cells[0]?.textContent.trim() === patron.trim()
              );
              if (filaTabla) {
                let columnas = [];
                if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                  columnas = [1, 4];
                } else if (signalConfig.martin_gala === "gale1trasperdida") {
                  columnas = [2, 5];
                } else if (signalConfig.martin_gala === "nogale") {
                  columnas = [3, 6];
                }
                let infoColores = [];
                for (let col of columnas) {
                  const cell = filaTabla.cells[col];
                  const bg = cell?.style.backgroundColor.toLowerCase();
                  if (bg === "green" || bg === "red") {
                    const condicion = (col <= 3) ? "Alcista" : "Bajista";
                    const operacion = (bg === "green") ? "CALL" : "PUT";
                    infoColores.push({ condicion, operacion });
                  }
                }
                if (infoColores.length > 0) {
                  // Evitamos duplicadas si las dos columnas tienen mismo color y condición
                  const operaciones = infoColores.map(i => i.operacion);
                  const operacionesUnicas = [...new Set(operaciones)];
                  if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                    // Las dos son iguales → una sola alerta
                    const operacion = operacionesUnicas[0];
                    const condicion = infoColores[0].condicion; // Tomamos cualquiera

                    if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                      mostrarPopup(`${patron} alcanza 100%`, "Alc/Baj", operacion, gale);
                    }
                  } else {
                    // Hay dos diferentes → mostramos ambas
                    for (let info of infoColores) {
                      if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                        mostrarPopup(`${patron} alcanza 100%`, info.condicion, info.operacion, gale);
                      }
                    }
                  }
                  alcanza100[patron] = false;
                }
              }
            }
          }
        }

        if (signalConfig.pierde_100) { //Notificacion para cuando pierde el 100%
          for (let patron in pierde100) {
            if (pierde100[patron]) {
              const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                fila => fila.cells[0]?.textContent.trim() === patron.trim()
              );
              if (filaTabla) {
                let columnas = [];
                if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                  columnas = [1, 4];
                } else if (signalConfig.martin_gala === "gale1trasperdida") {
                  columnas = [2, 5];
                } else if (signalConfig.martin_gala === "nogale") {
                  columnas = [3, 6];
                }
                let infoColores = [];
                for (let col of columnas) {
                  const cell = filaTabla.cells[col];
                  const bg = cell?.style.backgroundColor.toLowerCase();
                  if (bg === "green" || bg === "red") {
                    const condicion = (col <= 3) ? "Alcista" : "Bajista";
                    const operacion = (bg === "green") ? "CALL" : "PUT";
                    infoColores.push({ condicion, operacion });
                  }
                }
                if (infoColores.length > 0) {
                  // Evitamos duplicadas si las dos columnas tienen mismo color y condición
                  const operaciones = infoColores.map(i => i.operacion);
                  const operacionesUnicas = [...new Set(operaciones)];

                  if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                    // Las dos son iguales → una sola alerta
                    const operacion = operacionesUnicas[0];
                    const condicion = infoColores[0].condicion; // Tomamos cualquiera
                    if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                      mostrarPopup(`${patron} pierde 100%`, "Alc/Baj", operacion, gale);
                    }
                  } else {
                    // Hay dos diferentes → mostramos ambas
                    for (let info of infoColores) {
                      if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                        mostrarPopup(`${patron} pierde 100%`, info.condicion, info.operacion, gale);
                      }
                    }
                  }
                  pierde100[patron] = false;
                }
              }
            }
          }
        }

        if (signalConfig.perdidas_2) { // Notificación para dos pérdidas consecutivas
          detectarDosPerdidasSeguidas();
          for (let patron in dosPerdidasSeguidas) {
            if (dosPerdidasSeguidas[patron]) {
              const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                fila => fila.cells[0]?.textContent.trim() === patron.trim()
              );
              if (filaTabla) {
                let columnas = [];
                if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                  columnas = [1, 4];
                } else if (signalConfig.martin_gala === "gale1trasperdida") {
                  columnas = [2, 5];
                } else if (signalConfig.martin_gala === "nogale") {
                  columnas = [3, 6];
                }

                let infoColores = [];
                for (let col of columnas) {
                  const cell = filaTabla.cells[col];
                  const bg = cell?.style.backgroundColor.toLowerCase();
                  if (bg === "green" || bg === "red") {
                    const condicion = (col <= 3) ? "Alcista" : "Bajista";
                    const operacion = (bg === "green") ? "CALL" : "PUT";
                    infoColores.push({ condicion, operacion });
                  }
                }

                if (infoColores.length > 0) {
                  const operaciones = infoColores.map(i => i.operacion);
                  const operacionesUnicas = [...new Set(operaciones)];

                  if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                    const operacion = operacionesUnicas[0];
                    const condicion = infoColores[0].condicion;

                    if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                      mostrarPopup(`${patron} con 2 pérdidas seguidas`, "Alc/Baj", operacion, gale);
                    }

                  } else {
                    for (let info of infoColores) {
                      if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                        mostrarPopup(`${patron} con 2 pérdidas seguidas`, info.condicion, info.operacion, gale);
                      }
                    }
                  }

                  dosPerdidasSeguidas[patron] = false; // Reseteamos
                }
              }
            }
          }
        }

        if (signalConfig.perdidas_3) { // Notificación para dos pérdidas consecutivas
          detectarTresPerdidasSeguidas();
          for (let patron in tresPerdidasSeguidas) {
            if (tresPerdidasSeguidas[patron]) {
              const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                fila => fila.cells[0]?.textContent.trim() === patron.trim()
              );
              if (filaTabla) {
                let columnas = [];
                if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                  columnas = [1, 4];
                } else if (signalConfig.martin_gala === "gale1trasperdida") {
                  columnas = [2, 5];
                } else if (signalConfig.martin_gala === "nogale") {
                  columnas = [3, 6];
                }

                let infoColores = [];
                for (let col of columnas) {
                  const cell = filaTabla.cells[col];
                  const bg = cell?.style.backgroundColor.toLowerCase();
                  if (bg === "green" || bg === "red") {
                    const condicion = (col <= 3) ? "Alcista" : "Bajista";
                    const operacion = (bg === "green") ? "CALL" : "PUT";
                    infoColores.push({ condicion, operacion });
                  }
                }

                if (infoColores.length > 0) {
                  const operaciones = infoColores.map(i => i.operacion);
                  const operacionesUnicas = [...new Set(operaciones)];

                  if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                    const operacion = operacionesUnicas[0];
                    const condicion = infoColores[0].condicion;

                    if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                      mostrarPopup(`${patron} con 3 pérdidas seguidas`, "Alc/Baj", operacion, gale);
                    }

                  } else {
                    for (let info of infoColores) {
                      if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                        mostrarPopup(`${patron} con 3 pérdidas seguidas`, info.condicion, info.operacion, gale);
                      }
                    }
                  }

                  tresPerdidasSeguidas[patron] = false; // Reseteamos
                }
              }
            }
          }
        }

        if (signalConfig.cuadrante_doji) {
          detectarCaudranteConDoji();
          for (let patron in cuadranteConDoji) {
            if (cuadranteConDoji[patron]) {
              const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                fila => fila.cells[0]?.textContent.trim() === patron.trim()
              );
              if (filaTabla) {
                let columnas = [];
                if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                  columnas = [1, 4];
                } else if (signalConfig.martin_gala === "gale1trasperdida") {
                  columnas = [2, 5];
                } else if (signalConfig.martin_gala === "nogale") {
                  columnas = [3, 6];
                }

                let infoColores = [];
                for (let col of columnas) {
                  const cell = filaTabla.cells[col];
                  const bg = cell?.style.backgroundColor.toLowerCase();
                  if (bg === "green" || bg === "red") {
                    const condicion = (col <= 3) ? "Alcista" : "Bajista";
                    const operacion = (bg === "green") ? "CALL" : "PUT";
                    infoColores.push({ condicion, operacion });
                  }
                }

                if (infoColores.length > 0) {
                  const operaciones = infoColores.map(i => i.operacion);
                  const operacionesUnicas = [...new Set(operaciones)];

                  if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                    const operacion = operacionesUnicas[0];
                    const condicion = infoColores[0].condicion;

                    if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                      mostrarPopup(`${patron} con con un cuadrante con Doji`, "Alc/Baj", operacion, gale);
                    }

                  } else {
                    for (let info of infoColores) {
                      if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                        mostrarPopup(`${patron} con con un cuadrante con Doji`, info.condicion, info.operacion, gale);
                      }
                    }
                  }
                  cuadranteConDoji[patron] = false; // Reseteamos
                }
              }
            }
          }

        }





      }

    }




    async function mostrarPopup(signal, condicion, operacion, mg) {
      let colorOperacion = "green";
      if (operacion === "CALL") {
        colorOperacion = "green";
      } else {
        colorOperacion = "red";
      }
      //const porciento = await calcularPorcentajeSignal(colorOperacion);
      const ahora = new Date();
      const hora_final = ahora.getHours().toString().padStart(2, '0') + ':' +
        ahora.getMinutes().toString().padStart(2, '0');
      const texto = `
                ${signal}<br>
                Condición: Vela ${hora_final} ${condicion}<br>
                Próxima Vela: ${operacion}<br>
                ${mg}
                `;
      const container = document.getElementById("popup-container");

      const popup = document.createElement("div");
      popup.className = "popup-alert";
      popup.innerHTML = `
                <div class="popup-content">
                    <button class="cerrar-popup" onclick="this.parentElement.parentElement.remove()">✖</button>
                    <div class="popup-texto">${texto}</div>
                </div>
            `;
      container.appendChild(popup);
    }

    

    function calcularCantidadDeVelas() {
      const ahora = new Date();
      const ahoraTimestamp = ahora.getTime();// Hora actual
      const haceDosHoras = new Date(ahora);// Restar 2 horas
      haceDosHoras.setHours(haceDosHoras.getHours() - 2);
      const minutos = haceDosHoras.getMinutes();// Redondear los minutos hacia atrás al múltiplo de 10
      const minutosRedondeados = Math.floor(minutos / 10) * 10;
      haceDosHoras.setMinutes(minutosRedondeados, 0, 0); // también pone segundos y ms en 0

      const inicioTimestamp = haceDosHoras.getTime();
      // ✅ Mostrar hora legible


      const diferenciaMinutos = Math.floor((ahoraTimestamp - inicioTimestamp) / 60000);// Calcular diferencia en minutos
      return diferenciaMinutos;
    }

    function contarCeldasColoreadas() {
      const tabla = document.getElementById('tablaPatrones');
      const resultados = {
        verde: { verde: 0, rojo: 0 }, // Para las columnas de vela verde (1-3)
        rojo: { verde: 0, rojo: 0 }   // Para las columnas de vela roja (4-6)
      };

      // Recorrer todas las filas excepto los encabezados
      for (let i = 2; i < tabla.rows.length; i++) {
        const fila = tabla.rows[i];

        // Contar para columnas de vela verde (columnas 1-3)
        for (let j = 1; j <= 3; j++) {
          const celda = fila.cells[j];
          const bgColor = celda.style.backgroundColor.toLowerCase();

          if (bgColor === 'green') {
            resultados.verde.verde++;
          } else if (bgColor === 'red') {
            resultados.verde.rojo++;
          }
        }

        // Contar para columnas de vela roja (columnas 4-6)
        for (let j = 4; j <= 6; j++) {
          const celda = fila.cells[j];
          const bgColor = celda.style.backgroundColor.toLowerCase();

          if (bgColor === 'green') {
            resultados.rojo.verde++;
          } else if (bgColor === 'red') {
            resultados.rojo.rojo++;
          }
        }
      }
      return resultados;
    }

    function cerrarPopup() {
      document.getElementById("popup-señal").style.display = "none";
    }

    async function calcularPorcentaje() {
      const cuadros = document.querySelectorAll('.cuadro');
      estadisticasTotales = {
        rojo: 0,
        gris: 0,
        verde: 0,
        verde_G1: 0,
        verde_G2: 0
      };

      cuadros.forEach(cuadro => {
        const bg = cuadro.style.backgroundColor.toLowerCase();
        const txt = cuadro.textContent.trim().toUpperCase();

        if (bg === 'red' && txt === '') {
          estadisticasTotales.rojo++;
        } else if (bg === 'gray' && txt === '') {
          estadisticasTotales.gris++;
        } else if (bg === 'green' && txt === '') {
          estadisticasTotales.verde++;
        } else if (bg === 'green' && txt === 'G1') {
          estadisticasTotales.verde_G1++;
        } else if (bg === 'green' && txt === 'G2') {
          estadisticasTotales.verde_G2++;
        }
      });

      const total = Object.values(estadisticasTotales).reduce((a, b) => a + b, 0);

      estadisticasPorcentual = {};
      for (let tipo in estadisticasTotales) {
        const cantidad = estadisticasTotales[tipo];
        const porcentaje = total > 0 ? ((cantidad / total) * 100).toFixed(2) : 0;
        estadisticasPorcentual[tipo] = porcentaje;
      }

      const divEstadisticas = document.getElementById("estadisticas-globales");
      if (divEstadisticas) {
        const total = Object.values(estadisticasTotales).reduce((a, b) => a + b, 0);
        const texto = `
                    <strong>Efectividad General de todos los patrones:</strong><br>
                    Cantidad de Win Directos: ${estadisticasTotales.verde} (${estadisticasPorcentual.verde}%)<br>
                    Cantidad en Gale 1: ${estadisticasTotales.verde_G1} (${estadisticasPorcentual.verde_G1}%)<br>
                    Cantidad en Gale 2: ${estadisticasTotales.verde_G2} (${estadisticasPorcentual.verde_G2}%)<br>
                    Cantidad de Pass: ${estadisticasTotales.gris} (${estadisticasPorcentual.gris}%)<br>
                    Cantidad de Pérdidas: ${estadisticasTotales.rojo} (${estadisticasPorcentual.rojo}%)<br>
                `;
        divEstadisticas.innerHTML = texto;
      }



      return { estadisticasTotales, estadisticasPorcentual };
    }

    async function calcularPorcentajeNoPerdidasPorPatron() {
      const patrones = document.querySelectorAll('.patron');

      patrones.forEach(patron => {
        const h3 = patron.querySelector('h3');
        const nombreOriginal = h3.innerText.split(' (')[0]; // Quita porcentaje anterior
        const cuadros = patron.querySelectorAll('.cuadro');
        let perdidas = 0;
        let empate = 0;
        cuadros.forEach(cuadro => {
          if (cuadro.style.backgroundColor.toLowerCase() === 'red') {
            perdidas++;
          }
          if (cuadro.style.backgroundColor.toLowerCase() === 'gray') {
            empate++;
          }
        });
        const total = 24 - empate;
        const noPerdidas = total - perdidas;
        const porcentaje = ((noPerdidas / total) * 100).toFixed(0);
        h3.innerText = `${nombreOriginal} (${porcentaje}%)`;
        h3.style.color = porcentaje === "100" ? "green" : "";
        // Verificar cambio de estado
        const estabaEn100 = estadoAnteriorPatrones[nombreOriginal] === true;
        const estaEn100 = porcentaje === "100";
        // Guardar nuevo estado
        estadoAnteriorPatrones[nombreOriginal] = estaEn100;
        if (!estabaEn100 && estaEn100) {
          alcanza100[nombreOriginal] = true;
        } else if (estabaEn100 && !estaEn100) {
          pierde100[nombreOriginal] = true;
        }
      });

    }

    function detectarDosPerdidasSeguidas() {
      const patrones = document.querySelectorAll('.patron');
      patrones.forEach(patron => {
        const h3 = patron.querySelector('h3');
        const nombre = h3.innerText.split(' (')[0].trim();
        const cuadros = Array.from(patron.querySelectorAll('.cuadro'));
        const total = cuadros.length;

        // Si hay al menos 3 cuadros (por seguridad)
        if (total >= 24) {
          const antepenultimo = cuadros[total - 3];
          const penultimo = cuadros[total - 2];
          const ultimo = cuadros[total - 1];

          const colorPenultimo = penultimo.style.backgroundColor.toLowerCase();
          const colorUltimo = ultimo.style.backgroundColor.toLowerCase();
          const colorAntepenultimo = antepenultimo.style.backgroundColor.toLowerCase();

          // Condición: dos rojos seguidos y el tercero NO rojo
          if (colorPenultimo === 'red' && colorUltimo === 'red' && colorAntepenultimo !== 'red') {
            dosPerdidasSeguidas[nombre] = true;
          } else {
            dosPerdidasSeguidas[nombre] = false;
          }
        } else {
          dosPerdidasSeguidas[nombre] = false;
        }
      });
    }

    function detectarTresPerdidasSeguidas() {
      const patrones = document.querySelectorAll('.patron');
      patrones.forEach(patron => {
        const h3 = patron.querySelector('h3');
        const nombre = h3.innerText.split(' (')[0].trim();
        const cuadros = Array.from(patron.querySelectorAll('.cuadro'));
        const total = cuadros.length;
        // Si hay al menos 3 cuadros (por seguridad)
        if (total >= 24) {
          const anteantepenultimo = cuadros[total - 4];
          const antepenultimo = cuadros[total - 3];
          const penultimo = cuadros[total - 2];
          const ultimo = cuadros[total - 1];

          const colorPenultimo = penultimo.style.backgroundColor.toLowerCase();
          const colorUltimo = ultimo.style.backgroundColor.toLowerCase();
          const colorAntepenultimo = antepenultimo.style.backgroundColor.toLowerCase();
          const colorAnteAntepenultimo = anteantepenultimo.style.backgroundColor.toLowerCase();

          // Condición: dos rojos seguidos y el tercero NO rojo
          if (colorPenultimo === 'red' && colorUltimo === 'red' && colorAntepenultimo === 'red' && colorAnteAntepenultimo !== 'red') {
            tresPerdidasSeguidas[nombre] = true;
          } else {
            tresPerdidasSeguidas[nombre] = false;
          }
        } else {
          tresPerdidasSeguidas[nombre] = false;
        }
      });
    }

    function detectarCaudranteConDoji() {
      const patrones = document.querySelectorAll('.patron');
      patrones.forEach(patron => {
        const h3 = patron.querySelector('h3');
        const nombre = h3.innerText.split(' (')[0].trim();
        const cuadros = Array.from(patron.querySelectorAll('.cuadro'));
        const total = cuadros.length;
        // Si hay al menos 3 cuadros (por seguridad)
        if (total >= 24) {
          const penultimo = cuadros[total - 2];
          const ultimo = cuadros[total - 1];
          const colorPenultimo = penultimo.style.backgroundColor.toLowerCase();
          const colorUltimo = ultimo.style.backgroundColor.toLowerCase();

          // Condición: dos rojos seguidos y el tercero NO rojo
          if (colorPenultimo !== 'gray' && colorUltimo === 'gray') {
            cuadranteConDoji[nombre] = true;
          } else {
            cuadranteConDoji[nombre] = false;
          }
        } else {
          cuadranteConDoji[nombre] = false;
        }
      });
    }

    async function calcularPorcentajeSignal(colorBuscado) {
      try {
        const { data, error } = await clientesupabase
          .from(tablaPar)
          .select('candle_color')
          .order('id', { ascending: false }) // trae las últimas primero
          .limit(120);                       // últimas 120 velas
        if (error) {
          console.error("⚠️ Error leyendo velas:", error);
          return null;
        }
        if (!data || data.length === 0) {
          console.warn("⚠️ No se encontraron velas en la base de datos.");
          return null;
        }
        // Normalizamos el color buscado
        const colorObjetivo = colorBuscado.toLowerCase().trim();
        // Contar cuántas velas son del color buscado
        let conteo = 0;
        data.forEach(vela => {
          const color = vela.candle_color?.toLowerCase().trim();
          if (color === colorObjetivo) conteo++;
        });
        const total = data.length;
        const porcentaje = ((conteo / total) * 100).toFixed(2);
        return porcentaje;
      } catch (e) {
        console.error("⚠️ Error en calcularPorcentaje:", e);
        return null;
      }
    }
  </script>







  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const patrones = [
        'MHI Minoría', 'MHI 2 Minoría', 'MHI 3 Minoría',
        'MHI Mayoría', 'MHI 2 Mayoría', 'MHI 3 Mayoría',
        'Millón Minoría', 'Millón Mayoría', 'Torres Gemelas',
        'Mejor de 3', 'Tres Mosqueteros', 'Patrón Impar',
        'Tres Vecinos', 'Patron 3x1', 'Patrón 23'
      ];
      const leftPanel = document.querySelector('.left-panel');
      patrones.forEach(nombre => {
        const patronDiv = document.createElement('div');
        patronDiv.className = 'patron';
        patronDiv.innerHTML = `
        <h3>${nombre}</h3>
        <div class="cuadros" id="${nombre.replace(/\s/g, '_')}">
          ${Array(24).fill().map((_, i) =>
          `<div class="cuadro" data-patron="${nombre}" data-index="${i}"></div>`
        ).join('')}
        </div>
      `;
        leftPanel.appendChild(patronDiv);
      });
    });
    cargarSignalConfiguracion();

    async function cargarSignalConfiguracion() {
      userId = "<%= user.id %>";
      try {
        const { data: config, error } = await clientesupabase
          .from('configuracion_senal_usuario')
          .select('*')
          .eq('user_id', userId)
          .maybeSingle();
        if (error) throw error;

        if (config) {
          signalConfig = config
        }
      } catch (error) {
        console.error("Error al cargar configuración:", error.message);
      }
    }
  </script>





</body>

</html>