<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cat√°logo de Patrones</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        .tooltip-wrapper {
            position: relative;
            display: inline-block;
        }

        .tooltip-box {
            visibility: hidden;
            opacity: 0;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border: 1px solid #ccc;
            width: auto;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            border-radius: 8px;
            transition: opacity 0.3s;
            z-index: 9999;
            width: 500px;
        }

        .tooltip-wrapper:hover .tooltip-box {
            visibility: visible;
            opacity: 1;
        }

        .tooltip-contenido img {
            max-width: 100%;
            display: block;
            margin: auto;
        }


        .cuadro {
            position: relative;
            cursor: pointer;
        }

        .cuadro[title]:hover {
            transform: scale(1.1);
            z-index: 10;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        /* Tooltip personalizado m√°s elaborado (opcional) */
        .cuadro-tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 5px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 1000;
            pointer-events: none;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-bottom: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .cuadro-tooltip:before {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 5px solid transparent;
            border-top-color: rgba(0, 0, 0, 0.9);
        }

        .cuadro:hover .cuadro-tooltip {
            opacity: 1;
        }


        .tooltip-contenido p {
            margin: 5px 0 0;
            font-size: 14px;
            color: #333;
            text-align: center;
        }

        .candle-strip {
            display: flex;
            justify-content: center;
            padding: 15px;
            background: #f4f4f4;
            gap: 13px;
            flex-wrap: wrap;
        }

        .candle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, rgba(255, 255, 255, 0.6), rgba(0, 0, 0, 0.2));
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            border: 2px solid #000;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: bold;
            color: #fff;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .candle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
        }

        .dropdown-wrapper {
            margin-right: 20px;
        }

        .main-container {
            display: flex;
            flex: 1;
        }

        .left-panel {
            width: 75%;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            align-items: start;
            padding: 10px;
            box-sizing: border-box;
            overflow-y: auto;
            border-right: 2px solid #ccc;
        }

        .right-panel {
            width: 25%;
            padding: 10px;
            box-sizing: border-box;
            background-color: #f8f9fa;
            border-left: 1px solid #dee2e6;
        }

        .patron {
            width: 100%;
            margin: 0;
        }


        .patron h3 {
            margin: 5px 0;
            text-align: left;
            font-size: 17px;
            font-weight: bold;
        }

        .cuadros {
            display: grid;
            grid-template-columns: repeat(9, 35px);
            gap: 3px;
        }

        #tablaPatrones td:first-child {
            text-align: left;
        }

        #tablaPatrones td:first-child label {
            display: flex;
            align-items: center;
            gap: 6px;
            /* separaci√≥n entre check y texto */
        }

        .cuadro {
            display: flex;
            /* Habilita flexbox para centrado f√°cil */
            align-items: center;
            width: 35px;
            height: 25px;
            border: 2px solid black;
            background-color: white;
            justify-content: center;
            font-weight: bold;
            color: white;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: #fdfdfd;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        table th,
        table td {
            padding: 5px 3px !important;
            text-align: center;
            vertical-align: middle;
            border: 1px solid #dee2e6;
            font-size: 14px;
        }

        table th {
            background-color: #e9ecef;
            font-weight: 600;
        }


        #popup-se√±al {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #222;
            color: #fff;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
            z-index: 9999;
            min-width: 300px;
            max-width: 90%;
            display: none;
        }

        .popup-content {
            position: relative;
        }

        .cerrar-popup {
            position: absolute;
            top: 5px;
            right: 8px;
            background: transparent;
            color: #fff;
            border: none;
            font-size: 18px;
            cursor: pointer;
        }

        #popup-texto {
            font-size: 18px;
            text-align: center;
            padding-top: 10px;
        }

        #popup-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .popup-alert {
            background: #222;
            color: #fff;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            min-width: 250px;
            max-width: 300px;
            position: relative;
            animation: slideIn 0.3s ease-out;
        }

        .popup-texto {
            font-size: 14px;
            text-align: left;
        }

        .cinta-informativa {
            position: fixed;
            bottom: 0;
            /* Cambia a bottom: 0; si la quieres abajo */
            left: 0;
            width: 100%;
            background: #333;
            color: #fff;
            overflow: hidden;
            white-space: nowrap;
            z-index: 9999;
            height: 30px;
            display: flex;
            align-items: center;
        }

        .contenido-cinta {
            display: inline-block;
            padding-left: 100%;
            animation: scrollCinta 30s linear infinite;
            font-size: 14px;
        }

        @keyframes scrollCinta {
            0% {
                transform: translateX(0%);
            }

            100% {
                transform: translateX(-100%);
            }
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Media queries para ajustar el tama√±o m√≠nimo seg√∫n el tama√±o de pantalla */
        @media (max-width: 1200px) {
            .left-panel {
                grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            }
        }

        @media (max-width: 900px) {
            .left-panel {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            .cinta-informativa {
                position: fixed;
                top: 0;
            }


            .main-container {
                position: relative;
            }

            .left-panel {
                width: 100%;
                border-right: none;
                grid-template-columns: 1fr;
                padding: 10px 5px;
            }

            .right-panel {
                position: fixed;
                top: 0;
                right: -100%;
                width: 100%;
                height: 100vh;
                background: #f8f9fa;
                z-index: 1000;
                border-left: none;
                transition: right 0.3s ease;
                padding-top: 60px;
                overflow-y: auto;
            }

            .right-panel.show {
                right: 0;
            }

            .close-panel {
                position: absolute;
                top: 10px;
                right: 10px;
                background: #dc3545;
                color: white;
                border: none;
                width: 40px;
                height: 40px;
                border-radius: 50%;
                font-size: 18px;
                cursor: pointer;
                display: none;
                align-items: center;
                justify-content: center;
                z-index: 1001;
            }

            .right-panel.show .close-panel {
                display: flex;
            }

            /* Overlay para cerrar paneles tocando fuera */
            .panel-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.5);
                z-index: 999;
                display: none;
            }

            .panel-overlay.show {
                display: block;
            }

        }

        @media (max-width: 480px) {
            .left-panel {
                padding: 5px;
                gap: 15px;
            }

            .patron h3 {
                font-size: 14px;
            }

            .cuadros {
                grid-template-columns: repeat(9, 30px);
            }

            .cuadro {
                width: 30px;
                height: 20px;
            }

            .mobile-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>

<body>

    <div class="candle-strip">
        <!-- Selector de se√±ales con checkboxes dentro del dropdown -->
        <div class="mb-3">
            <select class="form-select form-select-sm" id="selectSenales">
                <option value="mg2">2 Martin Galas</option>
                <option value="mg1">1 Martin Gala</option>
                <option value="sinMG">Sin Martin Gala</option>
            </select>
        </div>


        <div class="candle-strip" id="candle-strip">
            <!-- Se insertar√°n din√°micamente -->
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
            <div class="candle"></div>
        </div>


        <div class="mobile-controls">
            <button id="toggle-sidebar" class="mobile-btn">
                <span>‚öôÔ∏è</span>
            </button>
            <button id="toggle-right-panel" class="mobile-btn">
                <span>‚ò∑</span>
            </button>
        </div>

        <div class="main-container">
            <!-- PANEL IZQUIERDO: PATRONES -->
            <div class="left-panel">
                <!-- Agregar m√°s patrones din√°micamente -->
            </div>

            <!-- PANEL DERECHO: GU√çA DE INTERPRETACI√ìN -->
            <div class="right-panel">
                <table id="tablaPatrones" class="table table-hover table-striped table-bordered">
                    <thead>
                        <tr>
                            <th>Si vela form√°ndose cierra: </th>
                            <th colspan="3">Alcista</th>
                            <th colspan="3">Bajista</th>
                        </tr>
                        <tr>
                            <th></th>
                            <th>Dir</th>
                            <th>G1</th>
                            <th>G2</th>
                            <th>Dir</th>
                            <th>G1</th>
                            <th>G2</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="MHI Minor√≠a" checked> MHI
                                    Minor√≠a</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="MHI 2 Minor√≠a" checked> MHI 2
                                    Minor√≠a</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="MHI 3 Minor√≠a" checked> MHI 3
                                    Minor√≠a</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="Mill√≥n Minor√≠a" checked>
                                    Mill√≥n Minor√≠a</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="MHI Mayor√≠a" checked> MHI
                                    Mayor√≠a</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="MHI 2 Mayor√≠a" checked> MHI 2
                                    Mayor√≠a</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="MHI 3 Mayor√≠a" checked> MHI 3
                                    Mayor√≠a</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="Mill√≥n Mayor√≠a" checked>
                                    Mill√≥n Mayor√≠a</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="Torres Gemelas" checked>
                                    Torres Gemelas</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="Mejor de 3" checked> Mejor de
                                    3</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="Tres Mosqueteros" checked>
                                    Tres Mosqueteros</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="Patron Impar" checked> Patron
                                    Impar</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="Tres Vecinos" checked> Tres
                                    Vecinos</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="Patron 3x1" checked> Patron
                                    3x1</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                        <tr>
                            <td><label><input type="checkbox" class="patron-check" value="Patron 23" checked> Patron
                                    23</label></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                            <td></td>
                        </tr>
                    </tbody>
                </table>
                <div id="estadisticas-globales"
                    style="padding: 10px; background-color: #f0f0f0; border-top: 2px solid #ccc; font-size: 14px; line-height: 1.6;">
                    <!-- Las estad√≠sticas aparecer√°n aqu√≠ -->
                </div>


            </div>

        </div>


        <div class="cinta-informativa">
            <div class="contenido-cinta" id="contenido-cinta">
                .
            </div>
        </div>

        <!-- Contenedor de todas las alertas -->
        <div id="popup-container"></div>

        <script>

            let historicoMHI = [], historicoMHI2 = [], historicoMHI3 = [], historicoMILLONMIN = [];
            let historicoMHIMAY = [], historicoMHI2MAY = [], historicoMHI3MAY = [], historicoMILLONMAY = [];
            let historicoTORRESGEMELAS = [], historicoMEJOR3 = [], historicoMOSQUETEROS = [], historicoPATRONIMPAR = [];
            let historicoTRESVECINOS = [], historicoPATRON3X1 = [], historicoPADRON23 = [];

            let mgConfigGlobal = null;
            let valorSelect = "mg2"; // valor por defecto

            //let tablaPar = "audcad_otc";
            //let analisisPar = "AUD/CAD OTC";

            let tablaPar = "<%= tablaPar %>";
            let analisisPar = "<%= analisisPar %>";


            let lastStartTime = null;


            let minutoCuadrante;

            let ultimoMinutoProcesado = null; // Variable global para rastrear el √∫ltimo minuto procesado
            let ultimaVelaProcesada = null; // Almacenar√° el ID o timestamp de la √∫ltima vela procesada
            let ultimaVela = null;


            let signalConfig = null;
            let userId = null;


            let confluenciaActiva = false;
            let condicionConfluencia = null;
            let direccionObjetivoConfluencia = null;
            let firstLoss = 0;



            let condicionCoincidencia = null;
            let velaBuscadaCoincidencia = null;
            let estadisticasTotales = null;
            let estadisticasPorcentual = null;
            let estadoAnteriorPatrones = {};
            let twoLoss = {};
            let threeloss = {};
            let alcanza100 = {};
            let pierde100 = {};
            let perdidaCuadrante = {};
            let dosPerdidasSeguidas = {};
            let tresPerdidasSeguidas = {};
            let cuadranteConDoji = {};
            let historicoPatrones = {};

        </script>

        <script>
            function obtenerTimestampActual() {
                const ahora = new Date();
                return ahora.getHours().toString().padStart(2, '0') + ':' +
                    ahora.getMinutes().toString().padStart(2, '0');
            }

            function agregarResultadoConTiempo(historicoArray, resultado, patronId) {
                const timestamp = obtenerTimestampActual();
                const objetoResultado = {
                    resultado: resultado,
                    tiempo: minutoCuadrante,
                    timestamp_completo: new Date().toISOString() // Para ordenamiento si es necesario
                };

                // Agregar nuevo resultado
                historicoArray.push(objetoResultado);

                // Mantener m√°ximo 24 elementos
                if (historicoArray.length > 24) {
                    historicoArray.shift();
                }

                // Actualizar historial visual
                actualizarHistoricoConTooltips(patronId, historicoArray);
            }

            function actualizarHistoricoConTooltips(patronId, historicoPatron) {
                const cuadrosContainer = document.getElementById(patronId);
                if (!cuadrosContainer) {
                    console.error(`No se encontr√≥ el patr√≥n con ID: ${patronId}`);
                    return;
                }

                if (historicoPatron.length === 0) {
                    console.warn('No hay datos en historicoPatron para aplicar al patr√≥n');
                    return;
                }

                // Aplicar cada valor del hist√≥rico a su cuadro correspondiente
                historicoPatron.forEach((objetoResultado, index) => {
                    const cuadroEspecifico = cuadrosContainer.querySelector(`.cuadro[data-index="${index}"]`);
                    if (cuadroEspecifico) {
                        const valor = objetoResultado.resultado;
                        const tiempo = objetoResultado.tiempo;

                        // Aplicar estilo seg√∫n el valor
                        switch (valor) {
                            case 'D':
                                cuadroEspecifico.style.backgroundColor = "green";
                                cuadroEspecifico.textContent = "";
                                break;
                            case 'G1':
                                cuadroEspecifico.style.backgroundColor = "green";
                                cuadroEspecifico.textContent = "G1";
                                break;
                            case 'G2':
                                cuadroEspecifico.style.backgroundColor = "green";
                                cuadroEspecifico.textContent = "G2";
                                break;
                            case 'L':
                                cuadroEspecifico.style.backgroundColor = "red";
                                cuadroEspecifico.textContent = "";
                                break;
                            case 'E':
                                cuadroEspecifico.style.backgroundColor = "gray";
                                cuadroEspecifico.textContent = "";
                                break;
                            default:
                                console.warn(`Valor desconocido en historicoPatron: ${valor}`);
                        }

                        // Agregar tooltip con el tiempo
                        cuadroEspecifico.setAttribute('title', `Hora: ${tiempo}\nResultado: ${valor}`);
                        cuadroEspecifico.setAttribute('data-tiempo', tiempo);
                    }
                });
            }
        </script>


        <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.5/dist/umd/supabase.min.js"></script>

        <script>
            const supabaseUrl = "<%= supabaseUrl %>";
            const supabaseKey = "<%= supabaseKey %>";
            const clientesupabase = supabase.createClient(supabaseUrl, supabaseKey);
            const coloresDigitos = new Array(10).fill(null); // Inicialmente vac√≠o












            document.addEventListener('DOMContentLoaded', () => {

                const patrones = [
                    'MHI Minor√≠a', 'MHI 2 Minor√≠a', 'MHI 3 Minor√≠a',
                    'MHI Mayor√≠a', 'MHI 2 Mayor√≠a', 'MHI 3 Mayor√≠a',
                    'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a', 'Torres Gemelas',
                    'Mejor de 3', 'Tres Mosqueteros', 'Patron Impar',
                    'Tres Vecinos', 'Patron 3x1', 'Patron 23'
                ];
                const leftPanel = document.querySelector('.left-panel');

                const infoPatrones = {
                    'MHI Minor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi-minoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'MHI 2 Minor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi2-minoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'MHI 3 Minor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi3-minoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'MHI Mayor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi-mayoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'MHI 2 Mayor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi2-mayoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'MHI 3 Mayor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/mhi3-mayoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'Mill√≥n Minor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/millon-minoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'Mill√≥n Mayor√≠a': `
        <div class="tooltip-contenido">
            <img src="imagenes/millon-mayoria.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'Torres Gemelas': `
        <div class="tooltip-contenido">
            <img src="imagenes/torres_gemelas.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'Mejor de 3': `
        <div class="tooltip-contenido">
            <img src="imagenes/mejor_tres.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'Tres Mosqueteros': `
        <div class="tooltip-contenido">
            <img src="imagenes/tres_mosqueteros.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'Patron Impar': `
        <div class="tooltip-contenido">
            <img src="imagenes/patron_impar.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'Tres Vecinos': `
        <div class="tooltip-contenido">
            <img src="imagenes/tres_vecinos.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'Patron 3x1': `
        <div class="tooltip-contenido">
            <img src="imagenes/patron_3x1.png" alt="MHI Minor√≠a ">
        </div>
    `,
                    'Patron 23': `
        <div class="tooltip-contenido">
            <img src="imagenes/patron_23.png" alt="MHI Minor√≠a ">
        </div>
    `,

                    // ... resto de patrones
                };






                patrones.forEach(nombre => {
                    const patronDiv = document.createElement('div');
                    patronDiv.className = 'patron';
                    patronDiv.innerHTML = `
            <div class="tooltip-wrapper">
            <h3>${nombre}</h3>
            <div class="tooltip-box">
                ${infoPatrones[nombre] || ''}
            </div>
        </div>
            <div class="cuadros" id="${nombre.replace(/\s/g, '_')}">
                ${Array(24).fill().map((_, i) =>
                        `<div class="cuadro" data-patron="${nombre}" data-index="${i}"></div>`
                    ).join('')}
            </div>
        `;
                    leftPanel.appendChild(patronDiv);
                });
            });






            async function cargarVelas() {
                const { data, error } = await clientesupabase
                    .from(tablaPar)
                    .select('*')
                    .order('id', { ascending: false })  // ‚úÖ Ordenamos por ID descendente
                    .limit(15);

                if (!data || data.length === 0) {
                    return;
                }

                const container = document.getElementById('candle-strip');
                container.innerHTML = '';
                // Mostramos las velas en orden cronol√≥gico (de m√°s vieja a m√°s nueva)
                for (let i = data.length - 1; i >= 0; i--) {
                    const vela = data[i];
                    // Crear div de la vela
                    const div = document.createElement('div');
                    div.classList.add('candle');

                    const color = vela.candle_color?.toLowerCase().trim() || 'gray';
                    div.style.backgroundColor = color === 'green' ? 'green' : color === 'red' ? 'red' : 'gray';

                    const horaStr = vela.start_time.toString();
                    const minuto = horaStr.split(':')[1] || '00';
                    const digito = minuto % 10;
                    coloresDigitos[digito] = color;

                    div.innerText = minuto;
                    container.appendChild(div);
                }

            }

            async function esperarNuevaVela() {
                while (true) {
                    try {
                        const { data, error } = await clientesupabase
                            .from(tablaPar)
                            .select('id, start_time, candle_color')
                            .order('id', { ascending: false })
                            .limit(1);
                        if (!error && data.length > 0) {
                            const velaActual = data[0];
                            if (!ultimaVelaProcesada || ultimaVelaProcesada.id !== velaActual.id) {
                                ultimaVelaProcesada = velaActual;
                                await cargarVelas();
                                analizarVelaPorDigito(velaActual);
                                calcularPorcentaje();
                                calcularPorcentajeNoPerdidasPorPatron();
                                verificaAlertas();
                                const sleep_time = (calculateSecondsToNextMinute() - 2) * 1000;
                                await new Promise(resolve => setTimeout(resolve, sleep_time));
                            }
                        }
                    } catch (e) {
                        console.error("‚ö†Ô∏è Error leyendo velas:", e);
                    }

                }
            }

            function calculateSecondsToNextMinute() {
                const now = new Date();
                const secondsCurrentMinute = now.getSeconds();
                const milliseconds = now.getMilliseconds() / 1000;
                let secondsToNextMinute = 60 - secondsCurrentMinute - milliseconds;
                secondsToNextMinute += 0.1
                return Math.max(0.1, secondsToNextMinute); // M√≠nimo 0.1 segundos
            }

            window.addEventListener('DOMContentLoaded', async () => {
                cargarSignalConfiguracion();
                await cargarVelas();
                const cantidadDeVelas = calcularCantidadDeVelas();
                const colores = await obtenerColoresDeVelas(cantidadDeVelas);
                const velas = await obtenerVelas(cantidadDeVelas);


                for (let i = 0; i < velas.length; i++) {
                    velaActual = velas[i];
                    const color = velaActual.candle_color?.toLowerCase().trim() || 'gray';
                    const horaStr = velaActual.start_time.toString();
                    const minuto = horaStr.split(':')[1] || '00';
                    const digito = minuto % 10;
                    coloresDigitos[digito] = color;
                    analizarVelaPorDigito(velaActual);
                }
                esperarNuevaVela();
            });





            function agregarResultadoAlHistorico(patronId, resultado) {
                if (!historicoPatrones[patronId]) {
                    historicoPatrones[patronId] = [];
                }
                // Agregar nuevo resultado
                historicoPatrones[patronId].push(resultado);
                // Mantener m√°ximo 24 elementos
                if (historicoPatrones[patronId].length > 24) {
                    historicoPatrones[patronId].shift();
                }
                // Repintar usando tu funci√≥n existente
                actualizarHistorico(patronId, historicoPatrones[patronId]);
            }


            function analizarVelaPorDigito(vela) {
                console.log(patronMarcado("Torres Gemelas"));
                const horaStr = vela.start_time.toString();
                if (vela.start_time.toString() === lastStartTime) {
                    return;
                }
                lastStartTime = horaStr;
                minutoCuadrante = lastStartTime.split(":").slice(0, 2).join(":");
                const minuto = parseInt(horaStr.split(':')[1] || '0');
                const digito = minuto % 10;
                const funciones = [
                    digito0, digito1, digito2, digito3, digito4,
                    digito5, digito6, digito7, digito8, digito9
                ];
                const funcion = funciones[digito];
                if (funcion) funcion(vela);
            }

            function getCelda(patron, columnaIndex) {
                const tabla = document.getElementById('tablaPatrones');
                for (let i = 1; i < tabla.rows.length; i++) { // saltamos encabezado
                    const fila = tabla.rows[i];
                    const checkbox = fila.cells[0].querySelector("input[type='checkbox']");
                    if (checkbox && checkbox.value.trim() === patron.trim()) {
                        return fila.cells[columnaIndex];
                    }
                }
                return null; // No encontrada
            }


            function colorMenosRepetido(indices) {
                let contador = { green: 0, red: 0 };
                for (let i of indices) {
                    const color = coloresDigitos[i];
                    if (color === 'green') contador.green++;
                    else if (color === 'red') contador.red++;
                }
                const total = contador.green + contador.red;
                if (total === 0) return null;
                if (contador.green === indices.length) return 'red';
                if (contador.red === indices.length) return 'green';
                if (contador.green === contador.red) return 'empate';
                return contador.green < contador.red ? 'green' : 'red';
            }

            function colorMasRepetido(indices) {
                let contador = { green: 0, red: 0 };

                for (let i of indices) {
                    const color = coloresDigitos[i];
                    if (color === 'green') contador.green++;
                    else if (color === 'red') contador.red++;
                }

                const total = contador.green + contador.red;
                if (total === 0) return null;

                if (contador.green === contador.red) return 'empate';

                // Devolver el m√°s repetido
                return contador.green > contador.red ? 'green' : 'red';
            }

            async function obtenerColoresDeVelas(cantidad) {

                const { data, error } = await clientesupabase
                    .from(tablaPar)
                    .select('candle_color, start_time, id')  // üëà incluimos id tambi√©n para depurar mejor
                    .order('id', { ascending: false })       // ‚úÖ ordenar por ID descendente
                    .limit(cantidad + 10);

                if (error) {
                    console.error("Error al leer de Supabase:", error);
                    return [];
                }

                const dataOrdenada = data.reverse();  // ‚úÖ ahora est√°n en orden cronol√≥gico
                dataOrdenada.forEach((v, i) => {
                    const hora = new Date(`1970-01-01T${v.start_time}`).toLocaleTimeString();
                });


                const colores = dataOrdenada.map(v => v.candle_color?.toLowerCase().trim() || 'gray');
                return colores;
            }

            async function obtenerVelas(cantidad) {

                const { data, error } = await clientesupabase
                    .from(tablaPar)
                    .select('candle_color, start_time, id')  // üëà incluimos id tambi√©n para depurar mejor
                    .order('id', { ascending: false })       // ‚úÖ ordenar por ID descendente
                    .limit(cantidad + 10);

                if (error) {
                    console.error("Error al leer de Supabase:", error);
                    return [];
                }

                const dataOrdenada = data.reverse();  // ‚úÖ ahora est√°n en orden cronol√≥gico
                dataOrdenada.forEach((v, i) => {
                    const hora = new Date(`1970-01-01T${v.start_time}`).toLocaleTimeString();
                });


                const colores = dataOrdenada.map(v => v.candle_color?.toLowerCase().trim() || 'gray');
                return dataOrdenada;
            }









            async function actualizarHistorico(patronId, historicoPatron) {

                const cuadrosContainer = document.getElementById(patronId);
                if (!cuadrosContainer) {
                    console.error(`No se encontr√≥ el patr√≥n con ID: ${patronId}`);
                    return;
                }
                if (historicoPatron.length === 0) {
                    console.warn('No hay datos en historicoPatron para aplicar al patr√≥n');
                    return;
                }
                // Aplicar cada valor del hist√≥rico a su cuadro correspondiente
                historicoPatron.forEach((valor, index) => {
                    const cuadroEspecifico = cuadrosContainer.querySelector(`.cuadro[data-index="${index}"]`);
                    if (cuadroEspecifico) {
                        // Aplicar estilo seg√∫n el valor
                        switch (valor) {
                            case 'D':
                                cuadroEspecifico.style.backgroundColor = "green";
                                cuadroEspecifico.textContent = "";
                                break;
                            case 'G1':
                                cuadroEspecifico.style.backgroundColor = "green";
                                cuadroEspecifico.textContent = "G1";
                                break;
                            case 'G2':
                                cuadroEspecifico.style.backgroundColor = "green";
                                cuadroEspecifico.textContent = "G2";
                                break;
                            case 'L':
                                cuadroEspecifico.style.backgroundColor = "red";
                                cuadroEspecifico.textContent = "";
                                break;
                            case 'E':
                                cuadroEspecifico.style.backgroundColor = "gray";
                                cuadroEspecifico.textContent = "";
                                break;
                            default:
                                console.warn(`Valor desconocido en historicoPatron: ${valor}`);
                        }
                    } else {
                        console.warn(`No se encontr√≥ cuadro con data-index="${index}" en el patr√≥n ${patronId}`);
                    }
                });
            }

            function limpiarTablaPatrones() {
                const tabla = document.getElementById("tablaPatrones");
                if (!tabla) return;

                const celdas = tabla.querySelectorAll("td");
                celdas.forEach(celda => {
                    celda.style.backgroundColor = ""; // Borra el fondo de cada celda
                });
            }

        </script>


        <script>
            async function verificaAlertas() {
                const ahora = new Date();
                const hora_final = ahora.getHours().toString().padStart(2, '0') + ':' +
                    ahora.getMinutes().toString().padStart(2, '0');


                //Primero Confirmo si el usuario tiene las notificaciones activadas
                if (signalConfig.notificacion !== "none") {
                    //Leer configuracion martingala
                    let gale = "No usar Martin Gala";
                    let condicion = "";
                    let operacion = "";
                    let cantGale = 0;
                    if (signalConfig.martin_gala === "gale2") {
                        gale = "Usar 2 Martin Gala";
                        cantGale = 2
                    } else if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale1trasperdida") {
                        gale = "Usar 1 Martin Gala";
                        cantGale = 1
                    }


                    if (signalConfig.confluencia) {  //Notificacion para la confluencia de patrones
                        if (condicionConfluencia === ultimaVela) {
                            confluenciaActiva = true;
                        } else if (condicionConfluencia !== ultimaVela) {     //else if (condicionConfluencia !== null && condicionConfluencia !== ultimaVela) {
                            confluenciaActiva = false;
                            condicionConfluencia = null;
                            direccionObjetivoConfluencia = null;
                            firstLoss = 0;
                        }

                        if (confluenciaActiva) {

                            if (signalConfig.martin_gala === "gale1trasperdida") {
                                if (direccionObjetivoConfluencia === 'green') {
                                    guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Bajista", "CALL", cantGale)
                                    if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                        mostrarPopup("Confluencia de Patrones", "Bajista", "CALL", gale);
                                    }
                                    if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                        envioTelegram("Confluencia de Patrones", "Bajista", "CALL", gale)
                                    }
                                }
                                if (direccionObjetivoConfluencia === 'red') {
                                    guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Alcista", "PUT", cantGale)
                                    if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                        mostrarPopup("Confluencia de Patrones", "Alcista", "PUT", gale);
                                    }
                                    if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                        envioTelegram("Confluencia de Patrones", "Alcista", "PUT", gale)
                                    }
                                }
                                confluenciaActiva = false;
                                condicionConfluencia = null;
                                direccionObjetivoConfluencia = null;
                                firstLoss = 0;
                            }

                            if (signalConfig.martin_gala === "nogale") {
                                if (firstLoss === 0) {
                                }
                                if (firstLoss === 1) {
                                    if (direccionObjetivoConfluencia === 'green') {
                                        guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Bajista", "CALL", cantGale)
                                        if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                            mostrarPopup("Confluencia de Patrones", "Bajista", "CALL", gale);
                                        }
                                        if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                            envioTelegram("Confluencia de Patrones", "Bajista", "CALL", gale)
                                        }
                                    }
                                    if (direccionObjetivoConfluencia === 'red') {
                                        guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Alcista", "PUT", cantGale)
                                        if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                            mostrarPopup("Confluencia de Patrones", "Alcista", "PUT", gale);
                                        }
                                        if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                            envioTelegram("Confluencia de Patrones", "Alcista", "PUT", gale)
                                        }
                                    }
                                    confluenciaActiva = false;
                                    condicionConfluencia = null;
                                    direccionObjetivoConfluencia = null;
                                    firstLoss = 0;
                                }
                                if (firstLoss === 0 && direccionObjetivoConfluencia !== ultimaVela) {
                                    firstLoss++;
                                }
                            }
                        }

                        const conteo = contarCeldasColoreadas();
                        if (conteo.verde.verde === 6) {
                            if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
                                guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Alcista", "CALL", cantGale)
                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                    mostrarPopup("Confluencia de Patrones", "Alcista", "CALL", gale);
                                }
                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                    envioTelegram("Confluencia de Patrones", "Alcista", "CALL", gale)
                                }
                            } else {
                                condicionConfluencia = 'green'
                                direccionObjetivoConfluencia = 'green'
                            }
                        }
                        if (conteo.verde.rojo === 6) {
                            if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
                                guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Alcista", "PUT", cantGale)
                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                    mostrarPopup("Confluencia de Patrones", "Alcista", "PUT", gale);
                                }
                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                    envioTelegram("Confluencia de Patrones", "Alcista", "PUT", gale)
                                }
                            } else {
                                condicionConfluencia = 'green'
                                direccionObjetivoConfluencia = 'red'
                            }
                        }
                        if (conteo.rojo.verde === 6) {
                            if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
                                guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Bajista", "CALL", cantGale)
                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                    mostrarPopup("Confluencia de Patrones", "Bajista", "CALL", gale);
                                }
                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                    envioTelegram("Confluencia de Patrones", "Bajista", "CALL", gale)
                                }
                            } else {
                                condicionConfluencia = 'red'
                                direccionObjetivoConfluencia = 'green'
                            }
                        }
                        if (conteo.rojo.rojo === 6) {
                            if (signalConfig.martin_gala === "gale1directo" || signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "nogaledirecto") {
                                guardarAlertaEnSupabase("Confluencia de Patrones", hora_final, "Bajista", "PUT", cantGale)
                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                    mostrarPopup("Confluencia de Patrones", "Bajista", "PUT", gale);
                                }
                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                    envioTelegram("Confluencia de Patrones", "Bajista", "PUT", gale)
                                }
                            } else {
                                condicionConfluencia = 'red'
                                direccionObjetivoConfluencia = 'red'
                            }
                        }
                    }

                    if (signalConfig.alcanza_100) { // Notificaci√≥n para cuando alcanza el 100%
                        for (let patron in alcanza100) {
                            console.log(patron);
                            if (alcanza100[patron]) {
                                const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                                    fila => fila.cells[0]?.textContent.trim() === patron.trim()
                                );
                                if (filaTabla) {
                                    let columnas = [];
                                    if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                                        columnas = [1, 4];
                                    } else if (signalConfig.martin_gala === "gale1trasperdida") {
                                        columnas = [2, 5];
                                    } else if (signalConfig.martin_gala === "nogale") {
                                        columnas = [3, 6];
                                    }
                                    let infoColores = [];
                                    for (let col of columnas) {
                                        const cell = filaTabla.cells[col];
                                        const bg = cell?.style.backgroundColor.toLowerCase();
                                        if (bg === "green" || bg === "red") {
                                            const condicion = (col <= 3) ? "Alcista" : "Bajista";
                                            const operacion = (bg === "green") ? "CALL" : "PUT";
                                            infoColores.push({ condicion, operacion });
                                        }
                                    }
                                    if (infoColores.length > 0) {
                                        // Evitamos duplicadas si las dos columnas tienen mismo color y condici√≥n
                                        const operaciones = infoColores.map(i => i.operacion);
                                        const operacionesUnicas = [...new Set(operaciones)];
                                        if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                                            // Las dos son iguales ‚Üí una sola alerta
                                            const operacion = operacionesUnicas[0];
                                            const condicion = infoColores[0].condicion; // Tomamos cualquiera
                                            guardarAlertaEnSupabase(`${patron} alcanza 100%`, hora_final, "Alc/Baj", operacion, cantGale)

                                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                mostrarPopup(`${patron} alcanza 100%`, "Alc/Baj", operacion, gale);
                                            }
                                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                envioTelegram(`${patron} alcanza 100%`, "Alc/Baj", operacion, gale)
                                            }
                                        } else {
                                            // Hay dos diferentes ‚Üí mostramos ambas
                                            for (let info of infoColores) {
                                                guardarAlertaEnSupabase(`${patron} alcanza 100%`, hora_final, info.condicion, info.operacion, cantGale)
                                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                    mostrarPopup(`${patron} alcanza 100%`, info.condicion, info.operacion, gale);
                                                }
                                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                    envioTelegram(`${patron} alcanza 100%`, info.condicion, info.operacion, gale)
                                                }
                                            }
                                        }
                                        alcanza100[patron] = false;
                                    }
                                }
                            }
                        }
                    }

                    if (signalConfig.pierde_100) { //Notificacion para cuando pierde el 100%
                        for (let patron in pierde100) {
                            if (pierde100[patron]) {
                                const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                                    fila => fila.cells[0]?.textContent.trim() === patron.trim()
                                );
                                if (filaTabla) {
                                    let columnas = [];
                                    if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                                        columnas = [1, 4];
                                    } else if (signalConfig.martin_gala === "gale1trasperdida") {
                                        columnas = [2, 5];
                                    } else if (signalConfig.martin_gala === "nogale") {
                                        columnas = [3, 6];
                                    }
                                    let infoColores = [];
                                    for (let col of columnas) {
                                        const cell = filaTabla.cells[col];
                                        const bg = cell?.style.backgroundColor.toLowerCase();
                                        if (bg === "green" || bg === "red") {
                                            const condicion = (col <= 3) ? "Alcista" : "Bajista";
                                            const operacion = (bg === "green") ? "CALL" : "PUT";
                                            infoColores.push({ condicion, operacion });
                                        }
                                    }
                                    if (infoColores.length > 0) {
                                        // Evitamos duplicadas si las dos columnas tienen mismo color y condici√≥n
                                        const operaciones = infoColores.map(i => i.operacion);
                                        const operacionesUnicas = [...new Set(operaciones)];

                                        if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                                            // Las dos son iguales ‚Üí una sola alerta
                                            const operacion = operacionesUnicas[0];
                                            const condicion = infoColores[0].condicion; // Tomamos cualquiera
                                            guardarAlertaEnSupabase(`${patron} pierde 100%`, hora_final, "Alc/Baj", operacion, cantGale)
                                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                mostrarPopup(`${patron} pierde 100%`, "Alc/Baj", operacion, gale);

                                            }
                                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                envioTelegram(`${patron} pierde 100%`, "Alc/Baj", operacion, gale)
                                            }
                                        } else {
                                            // Hay dos diferentes ‚Üí mostramos ambas
                                            for (let info of infoColores) {
                                                guardarAlertaEnSupabase(`${patron} pierde 100%`, hora_final, info.condicion, info.operacion, cantGale)
                                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                    mostrarPopup(`${patron} pierde 100%`, info.condicion, info.operacion, gale);
                                                }
                                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                    envioTelegram(`${patron} pierde 100%`, info.condicion, info.operacion, gale)
                                                }
                                            }
                                        }
                                        pierde100[patron] = false;
                                    }
                                }
                            }
                        }
                    }

                    if (signalConfig.perdidas_1) { // Notificaci√≥n para dos p√©rdidas consecutivas
                        detectarPerdida();
                        for (let patron in perdidaCuadrante) {
                            if (perdidaCuadrante[patron]) {
                                const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                                    fila => fila.cells[0]?.textContent.trim() === patron.trim()
                                );
                                if (filaTabla) {
                                    let columnas = [];
                                    if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                                        columnas = [1, 4];
                                    } else if (signalConfig.martin_gala === "gale1trasperdida") {
                                        columnas = [2, 5];
                                    } else if (signalConfig.martin_gala === "nogale") {
                                        columnas = [3, 6];
                                    }

                                    let infoColores = [];
                                    for (let col of columnas) {
                                        const cell = filaTabla.cells[col];
                                        const bg = cell?.style.backgroundColor.toLowerCase();
                                        if (bg === "green" || bg === "red") {
                                            const condicion = (col <= 3) ? "Alcista" : "Bajista";
                                            const operacion = (bg === "green") ? "CALL" : "PUT";
                                            infoColores.push({ condicion, operacion });
                                        }
                                    }

                                    if (infoColores.length > 0) {
                                        const operaciones = infoColores.map(i => i.operacion);
                                        const operacionesUnicas = [...new Set(operaciones)];

                                        if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                                            const operacion = operacionesUnicas[0];
                                            const condicion = infoColores[0].condicion;

                                            guardarAlertaEnSupabase(`${patron} perdi√≥ un cuadrante`, hora_final, "Alc/Baj", operacion, cantGale);
                                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                mostrarPopup(`${patron} perdi√≥ un cuadrante`, "Alc/Baj", operacion, gale);
                                            }
                                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                envioTelegram(`${patron} perdi√≥ un cuadrante`, "Alc/Baj", operacion, gale);
                                            }

                                        } else {
                                            for (let info of infoColores) {
                                                guardarAlertaEnSupabase(`${patron} perdi√≥ un cuadrante`, hora_final, info.condicion, info.operacion, cantGale);
                                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                    mostrarPopup(`${patron} perdi√≥ un cuadrante`, info.condicion, info.operacion, gale);
                                                }
                                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                    envioTelegram(`${patron} perdi√≥ un cuadrante`, info.condicion, info.operacion, gale);
                                                }
                                            }
                                        }
                                        perdidaCuadrante[patron] = false; // Reseteamos
                                    }
                                }
                            }
                        }
                    }

                    if (signalConfig.perdidas_2) { // Notificaci√≥n para dos p√©rdidas consecutivas
                        detectarDosPerdidasSeguidas();
                        for (let patron in dosPerdidasSeguidas) {
                            if (dosPerdidasSeguidas[patron]) {
                                const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                                    fila => fila.cells[0]?.textContent.trim() === patron.trim()
                                );
                                if (filaTabla) {
                                    let columnas = [];
                                    if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                                        columnas = [1, 4];
                                    } else if (signalConfig.martin_gala === "gale1trasperdida") {
                                        columnas = [2, 5];
                                    } else if (signalConfig.martin_gala === "nogale") {
                                        columnas = [3, 6];
                                    }

                                    let infoColores = [];
                                    for (let col of columnas) {
                                        const cell = filaTabla.cells[col];
                                        const bg = cell?.style.backgroundColor.toLowerCase();
                                        if (bg === "green" || bg === "red") {
                                            const condicion = (col <= 3) ? "Alcista" : "Bajista";
                                            const operacion = (bg === "green") ? "CALL" : "PUT";
                                            infoColores.push({ condicion, operacion });
                                        }
                                    }

                                    if (infoColores.length > 0) {
                                        const operaciones = infoColores.map(i => i.operacion);
                                        const operacionesUnicas = [...new Set(operaciones)];

                                        if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                                            const operacion = operacionesUnicas[0];
                                            const condicion = infoColores[0].condicion;

                                            guardarAlertaEnSupabase(`${patron} con 2 p√©rdidas seguidas`, hora_final, "Alc/Baj", operacion, cantGale);
                                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                mostrarPopup(`${patron} con 2 p√©rdidas seguidas`, "Alc/Baj", operacion, gale);
                                            }
                                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                envioTelegram(`${patron} con 2 p√©rdidas seguidas`, "Alc/Baj", operacion, gale);
                                            }

                                        } else {
                                            for (let info of infoColores) {
                                                guardarAlertaEnSupabase(`${patron} con 2 p√©rdidas seguidas`, hora_final, info.condicion, info.operacion, cantGale);
                                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                    mostrarPopup(`${patron} con 2 p√©rdidas seguidas`, info.condicion, info.operacion, gale);
                                                }
                                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                    envioTelegram(`${patron} con 2 p√©rdidas seguidas`, info.condicion, info.operacion, gale);
                                                }
                                            }
                                        }

                                        dosPerdidasSeguidas[patron] = false; // Reseteamos
                                    }
                                }
                            }
                        }
                    }

                    if (signalConfig.perdidas_3) { // Notificaci√≥n para dos p√©rdidas consecutivas
                        detectarTresPerdidasSeguidas();
                        for (let patron in tresPerdidasSeguidas) {
                            if (tresPerdidasSeguidas[patron]) {
                                const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                                    fila => fila.cells[0]?.textContent.trim() === patron.trim()
                                );
                                if (filaTabla) {
                                    let columnas = [];
                                    if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                                        columnas = [1, 4];
                                    } else if (signalConfig.martin_gala === "gale1trasperdida") {
                                        columnas = [2, 5];
                                    } else if (signalConfig.martin_gala === "nogale") {
                                        columnas = [3, 6];
                                    }

                                    let infoColores = [];
                                    for (let col of columnas) {
                                        const cell = filaTabla.cells[col];
                                        const bg = cell?.style.backgroundColor.toLowerCase();
                                        if (bg === "green" || bg === "red") {
                                            const condicion = (col <= 3) ? "Alcista" : "Bajista";
                                            const operacion = (bg === "green") ? "CALL" : "PUT";
                                            infoColores.push({ condicion, operacion });
                                        }
                                    }

                                    if (infoColores.length > 0) {
                                        const operaciones = infoColores.map(i => i.operacion);
                                        const operacionesUnicas = [...new Set(operaciones)];

                                        if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                                            const operacion = operacionesUnicas[0];
                                            const condicion = infoColores[0].condicion;

                                            guardarAlertaEnSupabase(`${patron} con 3 p√©rdidas seguidas`, hora_final, "Alc/Baj", operacion, cantGale);
                                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                mostrarPopup(`${patron} con 3 p√©rdidas seguidas`, "Alc/Baj", operacion, gale);
                                            }
                                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                envioTelegram(`${patron} con 3 p√©rdidas seguidas`, "Alc/Baj", operacion, gale);
                                            }

                                        } else {
                                            for (let info of infoColores) {
                                                guardarAlertaEnSupabase(`${patron} con 3 p√©rdidas seguidas`, hora_final, info.condicion, info.operacion, cantGale);
                                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                    mostrarPopup(`${patron} con 3 p√©rdidas seguidas`, info.condicion, info.operacion, gale);
                                                }
                                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                    envioTelegram(`${patron} con 3 p√©rdidas seguidas`, info.condicion, info.operacion, gale);
                                                }
                                            }
                                        }

                                        tresPerdidasSeguidas[patron] = false; // Reseteamos
                                    }
                                }
                            }
                        }
                    }

                    if (signalConfig.cuadrante_doji) {
                        detectarCaudranteConDoji();
                        for (let patron in cuadranteConDoji) {
                            if (cuadranteConDoji[patron]) {
                                const filaTabla = [...document.querySelectorAll('#tablaPatrones tbody tr')].find(
                                    fila => fila.cells[0]?.textContent.trim() === patron.trim()
                                );
                                if (filaTabla) {
                                    let columnas = [];
                                    if (signalConfig.martin_gala === "gale2" || signalConfig.martin_gala === "gale1directo") {
                                        columnas = [1, 4];
                                    } else if (signalConfig.martin_gala === "gale1trasperdida") {
                                        columnas = [2, 5];
                                    } else if (signalConfig.martin_gala === "nogale") {
                                        columnas = [3, 6];
                                    }

                                    let infoColores = [];
                                    for (let col of columnas) {
                                        const cell = filaTabla.cells[col];
                                        const bg = cell?.style.backgroundColor.toLowerCase();
                                        if (bg === "green" || bg === "red") {
                                            const condicion = (col <= 3) ? "Alcista" : "Bajista";
                                            const operacion = (bg === "green") ? "CALL" : "PUT";
                                            infoColores.push({ condicion, operacion });
                                        }
                                    }

                                    if (infoColores.length > 0) {
                                        const operaciones = infoColores.map(i => i.operacion);
                                        const operacionesUnicas = [...new Set(operaciones)];

                                        if (operacionesUnicas.length === 1 && infoColores.length === 2) {
                                            const operacion = operacionesUnicas[0];
                                            const condicion = infoColores[0].condicion;

                                            guardarAlertaEnSupabase(`${patron} con un cuadrante con Doji`, hora_final, "Alc/Baj", operacion, cantGale);
                                            if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                mostrarPopup(`${patron} con con un cuadrante con Doji`, "Alc/Baj", operacion, gale);
                                            }
                                            if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                envioTelegram(`${patron} con con un cuadrante con Doji`, "Alc/Baj", operacion, gale);
                                            }

                                        } else {
                                            for (let info of infoColores) {
                                                guardarAlertaEnSupabase(`${patron} con con un cuadrante con Doji`, hora_final, info.condicion, info.operacion, cantGale);
                                                if (signalConfig.notificacion === "navegador" || signalConfig.notificacion === "ambos") {
                                                    mostrarPopup(`${patron} con con un cuadrante con Doji`, info.condicion, info.operacion, gale);
                                                }
                                                if (signalConfig.notificacion === "telegram" || signalConfig.notificacion === "ambos") {
                                                    envioTelegram(`${patron} con con un cuadrante con Doji`, info.condicion, info.operacion, gale);
                                                }
                                            }
                                        }
                                        cuadranteConDoji[patron] = false; // Reseteamos
                                    }
                                }
                            }
                        }

                    }





                }

            }

            async function guardarAlertaEnSupabase(signal, vela, condicion, operacion, numeroDeGale) {
                let colorOperacion = "green";
                if (operacion === "CALL") {
                    colorOperacion = "green";
                } else {
                    colorOperacion = "red";
                }
                const porciento = await calcularPorcentajeSignal(colorOperacion);
                const textoFinal = `${operacion} (${porciento} %)`;
                const alerta = {
                    user_id: userId,
                    se√±al: signal,
                    par: analisisPar,
                    vela_condicional: vela || null,
                    condicion: condicion,
                    operacion: textoFinal,
                    loss: estadisticasPorcentual.rojo,
                    martingala: numeroDeGale,
                    resultado: null
                };
                const { data, error } = await clientesupabase
                    .from("registro_alertas")
                    .insert([alerta]);

                if (error) {
                    console.error("Error guardando alerta en Supabase:", error.message);
                }
            }

            async function cargarSignalConfiguracion() {
                userId = "<%= user.id %>";
                try {
                    const { data: config, error } = await clientesupabase
                        .from('configuracion_senal_usuario')
                        .select('*')
                        .eq('user_id', userId)
                        .maybeSingle();
                    if (error) throw error;

                    if (config) {
                        signalConfig = config
                    }
                } catch (error) {
                    console.error("Error al cargar configuraci√≥n:", error.message);
                }
            }

            async function mostrarPopup(signal, condicion, operacion, mg) {
                let colorOperacion = "green";
                if (operacion === "CALL") {
                    colorOperacion = "green";
                } else {
                    colorOperacion = "red";
                }
                const porciento = await calcularPorcentajeSignal(colorOperacion);
                const ahora = new Date();
                const hora_final = ahora.getHours().toString().padStart(2, '0') + ':' +
                    ahora.getMinutes().toString().padStart(2, '0');
                const texto = `
                ${analisisPar} (%Loss ${estadisticasPorcentual.rojo})<br>
                ${signal}<br>
                Condici√≥n: Vela ${hora_final} ${condicion}<br>
                Pr√≥xima Vela: ${operacion} (${porciento} %)<br>
                ${mg}
                `;
                const container = document.getElementById("popup-container");

                const popup = document.createElement("div");
                popup.className = "popup-alert";
                popup.innerHTML = `
                <div class="popup-content">
                    <button class="cerrar-popup" onclick="this.parentElement.parentElement.remove()">‚úñ</button>
                    <div class="popup-texto">${texto}</div>
                </div>
            `;
                container.appendChild(popup);
            }

            async function envioTelegram(signal, condicion, operacion, mg) {
                let colorOperacion = "green";
                if (operacion === "CALL") {
                    colorOperacion = "green";
                } else {
                    colorOperacion = "red";
                }
                const porciento = await calcularPorcentajeSignal(colorOperacion);
                // Obtener la hora actual formateada
                const ahora = new Date();
                const hora_final = ahora.getHours().toString().padStart(2, '0') + ':' +
                    ahora.getMinutes().toString().padStart(2, '0');

                // Construir el mensaje
                const texto = `${analisisPar} (%Loss ${estadisticasPorcentual.rojo})\n` +
                    `${signal}\n` +
                    `Condici√≥n: Vela ${hora_final} ${condicion}\n` +
                    `Pr√≥xima Vela: ${operacion} (${porciento} %)\n` +
                    `${mg}\n`;


                const token = '7971141664:AAFNFXWpHePHVkaedf1F75GKUk4bHwcJ_HE';

                try {
                    // Obtener el chat_id del usuario desde Supabase
                    const { data: telegramData, error: telegramError } = await clientesupabase
                        .from('user_config')
                        .select('chat_id')
                        .eq('user_id', userId)
                        .single();

                    if (telegramError || !telegramData || !telegramData.chat_id) {
                        console.error('Error al obtener chat_id de Telegram:', telegramError?.message || 'No se encontr√≥ chat_id');
                        return false;
                    }

                    const chatId = telegramData.chat_id;
                    await fetch("/sendMessage", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({
                            message: texto,
                            chatId: chatId // din√°mico
                        })
                    });
                    return true;
                } catch (error) {
                    console.error('Error completo al enviar a Telegram:', {
                        error: error.message,
                        condicion,
                        operacion
                    });
                    return false;
                }

            }

            function calcularCantidadDeVelas() {
                const ahora = new Date();
                const ahoraTimestamp = ahora.getTime();// Hora actual
                const haceDosHoras = new Date(ahora);// Restar 2 horas
                haceDosHoras.setHours(haceDosHoras.getHours() - 2);
                const minutos = haceDosHoras.getMinutes();// Redondear los minutos hacia atr√°s al m√∫ltiplo de 10
                const minutosRedondeados = Math.floor(minutos / 10) * 10;
                haceDosHoras.setMinutes(minutosRedondeados, 0, 0); // tambi√©n pone segundos y ms en 0

                const inicioTimestamp = haceDosHoras.getTime();
                // ‚úÖ Mostrar hora legible


                const diferenciaMinutos = Math.floor((ahoraTimestamp - inicioTimestamp) / 60000);// Calcular diferencia en minutos
                return diferenciaMinutos;
            }

            function contarCeldasColoreadas() {
                const tabla = document.getElementById('tablaPatrones');
                const resultados = {
                    verde: { verde: 0, rojo: 0 }, // Para las columnas de vela verde (1-3)
                    rojo: { verde: 0, rojo: 0 }   // Para las columnas de vela roja (4-6)
                };

                // Recorrer todas las filas excepto los encabezados
                for (let i = 2; i < tabla.rows.length; i++) {
                    const fila = tabla.rows[i];

                    // Contar para columnas de vela verde (columnas 1-3)
                    for (let j = 1; j <= 3; j++) {
                        const celda = fila.cells[j];
                        const bgColor = celda.style.backgroundColor.toLowerCase();

                        if (bgColor === 'green') {
                            resultados.verde.verde++;
                        } else if (bgColor === 'red') {
                            resultados.verde.rojo++;
                        }
                    }

                    // Contar para columnas de vela roja (columnas 4-6)
                    for (let j = 4; j <= 6; j++) {
                        const celda = fila.cells[j];
                        const bgColor = celda.style.backgroundColor.toLowerCase();

                        if (bgColor === 'green') {
                            resultados.rojo.verde++;
                        } else if (bgColor === 'red') {
                            resultados.rojo.rojo++;
                        }
                    }
                }
                return resultados;
            }

            function cerrarPopup() {
                document.getElementById("popup-se√±al").style.display = "none";
            }

            async function calcularPorcentaje() {
                const cuadros = document.querySelectorAll('.cuadro');
                estadisticasTotales = {
                    rojo: 0,
                    gris: 0,
                    verde: 0,
                    verde_G1: 0,
                    verde_G2: 0
                };

                cuadros.forEach(cuadro => {
                    const bg = cuadro.style.backgroundColor.toLowerCase();
                    const txt = cuadro.textContent.trim().toUpperCase();

                    if (bg === 'red' && txt === '') {
                        estadisticasTotales.rojo++;
                    } else if (bg === 'gray' && txt === '') {
                        estadisticasTotales.gris++;
                    } else if (bg === 'green' && txt === '') {
                        estadisticasTotales.verde++;
                    } else if (bg === 'green' && txt === 'G1') {
                        estadisticasTotales.verde_G1++;
                    } else if (bg === 'green' && txt === 'G2') {
                        estadisticasTotales.verde_G2++;
                    }
                });

                const total = Object.values(estadisticasTotales).reduce((a, b) => a + b, 0);

                estadisticasPorcentual = {};
                for (let tipo in estadisticasTotales) {
                    const cantidad = estadisticasTotales[tipo];
                    const porcentaje = total > 0 ? ((cantidad / total) * 100).toFixed(2) : 0;
                    estadisticasPorcentual[tipo] = porcentaje;
                }

                const divEstadisticas = document.getElementById("estadisticas-globales");
                if (divEstadisticas) {
                    const total = Object.values(estadisticasTotales).reduce((a, b) => a + b, 0);
                    const texto = `
                    <strong>Efectividad General de todos los patrones:</strong><br>
                    Cantidad de Win Directos: ${estadisticasTotales.verde} (${estadisticasPorcentual.verde}%)<br>
                    Cantidad en Gale 1: ${estadisticasTotales.verde_G1} (${estadisticasPorcentual.verde_G1}%)<br>
                    Cantidad en Gale 2: ${estadisticasTotales.verde_G2} (${estadisticasPorcentual.verde_G2}%)<br>
                    Cantidad de Pass: ${estadisticasTotales.gris} (${estadisticasPorcentual.gris}%)<br>
                    Cantidad de P√©rdidas: ${estadisticasTotales.rojo} (${estadisticasPorcentual.rojo}%)<br>
                `;
                    divEstadisticas.innerHTML = texto;
                }



                return { estadisticasTotales, estadisticasPorcentual };
            }

            async function calcularPorcentajeNoPerdidasPorPatron() {
                const patrones = document.querySelectorAll('.patron');

                patrones.forEach(patron => {
                    const h3 = patron.querySelector('h3');
                    const nombreOriginal = h3.innerText.split(' (')[0]; // Quita porcentaje anterior
                    const cuadros = patron.querySelectorAll('.cuadro');
                    let perdidas = 0;
                    let empate = 0;
                    cuadros.forEach(cuadro => {
                        if (cuadro.style.backgroundColor.toLowerCase() === 'red') {
                            perdidas++;
                        }
                        if (cuadro.style.backgroundColor.toLowerCase() === 'gray') {
                            empate++;
                        }
                    });
                    const total = 24 - empate;
                    const noPerdidas = total - perdidas;
                    const porcentaje = ((noPerdidas / total) * 100).toFixed(0);
                    h3.innerText = `${nombreOriginal} (${porcentaje}%)`;
                    h3.style.color = porcentaje === "100" ? "green" : "";
                    // Verificar cambio de estado
                    const estabaEn100 = estadoAnteriorPatrones[nombreOriginal] === true;
                    const estaEn100 = porcentaje === "100";
                    // Guardar nuevo estado
                    estadoAnteriorPatrones[nombreOriginal] = estaEn100;
                    if (!estabaEn100 && estaEn100) {
                        alcanza100[nombreOriginal] = true;
                    } else if (estabaEn100 && !estaEn100) {
                        pierde100[nombreOriginal] = true;
                    }
                });

            }

            function detectarPerdida() {
                const patrones = document.querySelectorAll('.patron');
                patrones.forEach(patron => {
                    const h3 = patron.querySelector('h3');
                    const nombre = h3.innerText.split(' (')[0].trim();
                    const cuadros = Array.from(patron.querySelectorAll('.cuadro'));
                    const total = cuadros.length;

                    // Si hay al menos 3 cuadros (por seguridad)
                    if (total >= 24) {
                        const penultimo = cuadros[total - 2];
                        const ultimo = cuadros[total - 1];

                        const colorPenultimo = penultimo.style.backgroundColor.toLowerCase();
                        const colorUltimo = ultimo.style.backgroundColor.toLowerCase();

                        // Condici√≥n: dos rojos seguidos y el tercero NO rojo
                        if (colorPenultimo !== 'red' && colorUltimo === 'red') {
                            perdidaCuadrante[nombre] = true;
                        } else {
                            perdidaCuadrante[nombre] = false;
                        }
                    } else {
                        perdidaCuadrante[nombre] = false;
                    }
                });
            }

            function detectarDosPerdidasSeguidas() {
                const patrones = document.querySelectorAll('.patron');
                patrones.forEach(patron => {
                    const h3 = patron.querySelector('h3');
                    const nombre = h3.innerText.split(' (')[0].trim();
                    const cuadros = Array.from(patron.querySelectorAll('.cuadro'));
                    const total = cuadros.length;

                    // Si hay al menos 3 cuadros (por seguridad)
                    if (total >= 24) {
                        const antepenultimo = cuadros[total - 3];
                        const penultimo = cuadros[total - 2];
                        const ultimo = cuadros[total - 1];

                        const colorPenultimo = penultimo.style.backgroundColor.toLowerCase();
                        const colorUltimo = ultimo.style.backgroundColor.toLowerCase();
                        const colorAntepenultimo = antepenultimo.style.backgroundColor.toLowerCase();

                        // Condici√≥n: dos rojos seguidos y el tercero NO rojo
                        if (colorPenultimo === 'red' && colorUltimo === 'red' && colorAntepenultimo !== 'red') {
                            dosPerdidasSeguidas[nombre] = true;
                        } else {
                            dosPerdidasSeguidas[nombre] = false;
                        }
                    } else {
                        dosPerdidasSeguidas[nombre] = false;
                    }
                });
            }

            function detectarTresPerdidasSeguidas() {
                const patrones = document.querySelectorAll('.patron');
                patrones.forEach(patron => {
                    const h3 = patron.querySelector('h3');
                    const nombre = h3.innerText.split(' (')[0].trim();
                    const cuadros = Array.from(patron.querySelectorAll('.cuadro'));
                    const total = cuadros.length;
                    // Si hay al menos 3 cuadros (por seguridad)
                    if (total >= 24) {
                        const anteantepenultimo = cuadros[total - 4];
                        const antepenultimo = cuadros[total - 3];
                        const penultimo = cuadros[total - 2];
                        const ultimo = cuadros[total - 1];

                        const colorPenultimo = penultimo.style.backgroundColor.toLowerCase();
                        const colorUltimo = ultimo.style.backgroundColor.toLowerCase();
                        const colorAntepenultimo = antepenultimo.style.backgroundColor.toLowerCase();
                        const colorAnteAntepenultimo = anteantepenultimo.style.backgroundColor.toLowerCase();

                        // Condici√≥n: dos rojos seguidos y el tercero NO rojo
                        if (colorPenultimo === 'red' && colorUltimo === 'red' && colorAntepenultimo === 'red' && colorAnteAntepenultimo !== 'red') {
                            tresPerdidasSeguidas[nombre] = true;
                        } else {
                            tresPerdidasSeguidas[nombre] = false;
                        }
                    } else {
                        tresPerdidasSeguidas[nombre] = false;
                    }
                });
            }

            function detectarCaudranteConDoji() {
                const patrones = document.querySelectorAll('.patron');
                patrones.forEach(patron => {
                    const h3 = patron.querySelector('h3');
                    const nombre = h3.innerText.split(' (')[0].trim();
                    const cuadros = Array.from(patron.querySelectorAll('.cuadro'));
                    const total = cuadros.length;
                    // Si hay al menos 3 cuadros (por seguridad)
                    if (total >= 24) {
                        const penultimo = cuadros[total - 2];
                        const ultimo = cuadros[total - 1];
                        const colorPenultimo = penultimo.style.backgroundColor.toLowerCase();
                        const colorUltimo = ultimo.style.backgroundColor.toLowerCase();

                        // Condici√≥n: dos rojos seguidos y el tercero NO rojo
                        if (colorPenultimo !== 'gray' && colorUltimo === 'gray') {
                            cuadranteConDoji[nombre] = true;
                        } else {
                            cuadranteConDoji[nombre] = false;
                        }
                    } else {
                        cuadranteConDoji[nombre] = false;
                    }
                });
            }

            async function calcularPorcentajeSignal(colorBuscado) {
                try {
                    const { data, error } = await clientesupabase
                        .from(tablaPar)
                        .select('candle_color')
                        .order('id', { ascending: false }) // trae las √∫ltimas primero
                        .limit(120);                       // √∫ltimas 120 velas
                    if (error) {
                        console.error("‚ö†Ô∏è Error leyendo velas:", error);
                        return null;
                    }
                    if (!data || data.length === 0) {
                        console.warn("‚ö†Ô∏è No se encontraron velas en la base de datos.");
                        return null;
                    }
                    // Normalizamos el color buscado
                    const colorObjetivo = colorBuscado.toLowerCase().trim();
                    // Contar cu√°ntas velas son del color buscado
                    let conteo = 0;
                    data.forEach(vela => {
                        const color = vela.candle_color?.toLowerCase().trim();
                        if (color === colorObjetivo) conteo++;
                    });
                    const total = data.length;
                    const porcentaje = ((conteo / total) * 100).toFixed(2);
                    return porcentaje;
                } catch (e) {
                    console.error("‚ö†Ô∏è Error en calcularPorcentaje:", e);
                    return null;
                }
            }
        </script>


        <script>
            function patronMarcado(patron) {
                const tabla = document.getElementById('tablaPatrones');
                for (let i = 1; i < tabla.rows.length; i++) {
                    const fila = tabla.rows[i];
                    const checkbox = fila.cells[0].querySelector("input[type='checkbox']");
                    if (checkbox && checkbox.value.trim() === patron.trim()) {
                        return checkbox.checked; // true si est√° marcado, false si no
                    }
                }
                return false; // si no lo encuentra
            }

            function patronesActivos() {
                return Array.from(document.querySelectorAll("#tablaPatrones .patron-check:checked"))
                    .map(cb => cb.value);
            }

            document.querySelectorAll("#tablaPatrones .patron-check").forEach(checkbox => {
                checkbox.addEventListener("change", function () {
                    // Encontramos la fila del checkbox
                    const fila = this.closest("tr");

                    if (!this.checked) {
                        // Si se desmarca ‚Üí limpiar todas las celdas excepto la primera
                        for (let i = 1; i < fila.cells.length; i++) {
                            fila.cells[i].innerHTML = "";          // borra contenido
                            fila.cells[i].style.backgroundColor = ""; // borra colores
                        }
                    } else {
                        console.log("Patr√≥n activado:", this.value);
                        // Aqu√≠ puedes poner l√≥gica extra si al volver a activarlo quieres algo
                    }
                });
            });

            // Ejemplo:




            function digito0(vela) {
                ultimaVela = coloresDigitos[0];
                ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                    getCelda(patron, 2).style.backgroundColor = '';
                    getCelda(patron, 5).style.backgroundColor = '';
                });
                if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                    const minoritario = colorMenosRepetido([7, 8, 9]);
                    if (minoritario === coloresDigitos[0]) {
                        // Gana MHI Minor√≠a, pierde MHI Mayor√≠a
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 3).style.backgroundColor = 'red'; }
                        } else if (minoritario === 'red') {
                            if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                    } else {
                        // Gana MHI Mayor√≠a, pierde MHI Minor√≠a
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 6).style.backgroundColor = 'green'; }
                        } else if (minoritario === 'red') {
                            if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analisis Millon Minoria y Millon Minoria
                if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {    //Para si hay un doji no hacer nada
                    const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
                    if (minoritario === coloresDigitos[0]) {   //Se gana mill minoria y se pierde mill mayoria
                        if (minoritario === 'green') {
                            if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                        if (minoritario === 'red') {
                            if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                    } else {
                        if (minoritario === 'green') {
                            if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                        if (minoritario === 'red') {
                            if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
                getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = '';
                getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = '';
                if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                    const minoritario = colorMenosRepetido([7, 8, 9]);
                    if (minoritario === 'green') {
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 5).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 2).style.backgroundColor = 'red'; }
                    } else {
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 2).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 5).style.backgroundColor = 'green'; }

                    }
                }
                //Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
                if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                    const minoritario = colorMenosRepetido([7, 8, 9]);
                    if (minoritario === 'red') {
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = 'green'; }
                    } else if (minoritario === 'green') {
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = 'red'; }

                    }
                }
                //Analasis para Torres Gemelas
                getCelda('Torres Gemelas', 3).style.backgroundColor = '';
                getCelda('Torres Gemelas', 6).style.backgroundColor = '';
                //Analisis correspondiente a TRES VECINOS
                getCelda('Tres Vecinos', 3).style.backgroundColor = '';
                getCelda('Tres Vecinos', 6).style.backgroundColor = '';
                //Analisis correspondiente a PATRON 23
                getCelda('Patron 23', 1).style.backgroundColor = '';
                getCelda('Patron 23', 4).style.backgroundColor = '';
                if (coloresDigitos[0] !== 'doji') {
                    if (coloresDigitos[0] === 'green') {
                        if (patronMarcado("Patron 23")) { getCelda('Patron 23', 5).style.backgroundColor = 'green'; }
                    } else {
                        if (patronMarcado("Patron 23")) { getCelda('Patron 23', 2).style.backgroundColor = 'red'; }
                    }
                }
                //Analasis para MEJOR DE TRES
                if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                    const minoritario = colorMenosRepetido([6, 7, 8]);
                    if (minoritario === 'green') {
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 4).style.backgroundColor = 'red'; }
                    } else {
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 4).style.backgroundColor = 'green'; }
                    }
                }
                //Analisis Patron 3x1
                getCelda('Patron 3x1', 3).style.backgroundColor = '';
                getCelda('Patron 3x1', 6).style.backgroundColor = '';
                // Analisis Patron Impar
                if (coloresDigitos[7] !== 'doji') {
                    if (coloresDigitos[7] !== coloresDigitos[0]) {
                        if (coloresDigitos[7] === 'green') {
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 2).style.backgroundColor = 'green'; }
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 5).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 2).style.backgroundColor = 'red'; }
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 5).style.backgroundColor = 'red'; }
                        }
                    }
                }

                //Analisis de las que pueden ganar en este digito:
                //MHI mayoria y minoria
                if (coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {
                    agregarResultadoConTiempo(historicoMHI, "E", "MHI_Minor√≠a");
                    agregarResultadoConTiempo(historicoMHIMAY, "E", "MHI_Mayor√≠a");
                } else {
                    const minoritario = colorMenosRepetido([7, 8, 9]);
                    if (minoritario === coloresDigitos[0]) {
                        agregarResultadoConTiempo(historicoMHI, "D", "MHI_Minor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minor√≠a");
                        }
                    }

                    const mayoritario = colorMasRepetido([7, 8, 9]);
                    if (mayoritario === coloresDigitos[0]) {
                        agregarResultadoConTiempo(historicoMHIMAY, "D", "MHI_Mayor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayor√≠a");
                        }
                    }

                }

                //MILLON mayoria y minoria
                if (coloresDigitos[5] === 'doji' || coloresDigitos[6] === 'doji' || coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {
                    agregarResultadoConTiempo(historicoMILLONMIN, "E", "Mill√≥n_Minor√≠a");
                    agregarResultadoConTiempo(historicoMILLONMAY, "E", "Mill√≥n_Mayor√≠a");
                } else {
                    const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
                    if (minoritario === coloresDigitos[0]) {
                        agregarResultadoConTiempo(historicoMILLONMIN, "D", "Mill√≥n_Minor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMILLONMIN, "L", "Mill√≥n_Minor√≠a");
                        }
                    }

                    const mayoritario = colorMasRepetido([5, 6, 7, 8, 9]);

                    if (mayoritario === coloresDigitos[0]) {
                        agregarResultadoConTiempo(historicoMILLONMAY, "D", "Mill√≥n_Mayor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMILLONMAY, "L", "Mill√≥n_Mayor√≠a");
                        }
                    }

                }

                //Torres Gemelas
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[5] !== 'doji') {
                        if (coloresDigitos[5] !== coloresDigitos[9] && coloresDigitos[5] === coloresDigitos[0]) {
                            agregarResultadoConTiempo(historicoTORRESGEMELAS, "G1", "Torres_Gemelas");
                        }
                        if (valorSelect === "mg1") {
                            if (coloresDigitos[5] !== coloresDigitos[9] && coloresDigitos[5] !== coloresDigitos[0]) {
                                agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
                            }
                        }
                    }
                }


                //Tres Mosqueteros
                if (valorSelect === "mg2") {
                    if (coloresDigitos[7] !== 'doji') {
                        if (coloresDigitos[7] !== coloresDigitos[8] && coloresDigitos[7] !== coloresDigitos[9] && coloresDigitos[7] === coloresDigitos[0]) {
                            agregarResultadoConTiempo(historicoMOSQUETEROS, "G2", "Tres_Mosqueteros");
                        } else if (coloresDigitos[7] !== coloresDigitos[8] && coloresDigitos[7] !== coloresDigitos[9] && coloresDigitos[7] !== coloresDigitos[0]) {
                            agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
                        }
                    }
                }
                //Patron Impar
                if (coloresDigitos[7] === 'doji') {
                    agregarResultadoConTiempo(historicoPATRONIMPAR, "E", "Patron_Impar");
                } else {
                    if (coloresDigitos[7] === coloresDigitos[0]) {
                        agregarResultadoConTiempo(historicoPATRONIMPAR, "D", "Patron_Impar");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patron_Impar");
                        }
                    }

                }



                //Tres Vecinos
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[8] !== 'doji') {
                        if (coloresDigitos[8] !== coloresDigitos[9] && coloresDigitos[8] === coloresDigitos[0]) {
                            agregarResultadoConTiempo(historicoTRESVECINOS, "G1", "Tres_Vecinos");
                        }
                        if (valorSelect === "mg1") {
                            if (coloresDigitos[8] !== coloresDigitos[9] && coloresDigitos[8] !== coloresDigitos[0]) {
                                agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
                            }
                        }
                    }
                }
                //Patron 3x1
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {
                        const minoritario = colorMenosRepetido([5, 6, 7]);
                        if (minoritario !== coloresDigitos[9] && minoritario === coloresDigitos[0]) {
                            agregarResultadoConTiempo(historicoPATRON3X1, "G1", "Patron_3x1");
                        }
                        if (valorSelect === "mg1") {
                            if (minoritario !== coloresDigitos[9] && minoritario !== coloresDigitos[0]) {
                                agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
                            }
                        }
                    }
                }
            }

            function digito1(vela) {
                ultimaVela = coloresDigitos[1];
                ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                    getCelda(patron, 3).style.backgroundColor = '';
                    getCelda(patron, 6).style.backgroundColor = '';
                });
                //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
                getCelda('MHI 2 Minor√≠a', 2).style.backgroundColor = '';
                getCelda('MHI 2 Minor√≠a', 5).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 2).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 5).style.backgroundColor = '';
                if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                    const minoritario = colorMenosRepetido([7, 8, 9]);
                    if (minoritario === coloresDigitos[1]) {
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                        else {
                            if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                    } else {
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                        else {
                            if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }//Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
                getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = '';
                getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = '';
                if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                    const minoritario = colorMenosRepetido([7, 8, 9]);
                    if (minoritario === 'green') {
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 5).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 2).style.backgroundColor = 'red'; }
                    } else {
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 2).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 5).style.backgroundColor = 'green'; }
                    }
                }
                //Analisis correspondiente a TRES MOSQUETEROS
                if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 1).style.backgroundColor = 'green'; }
                if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 4).style.backgroundColor = 'red'; }
                //Analisis correspondiente a PATRON 23
                getCelda('Patron 23', 2).style.backgroundColor = '';
                getCelda('Patron 23', 5).style.backgroundColor = '';
                if (coloresDigitos[0] !== 'doji') {
                    if (coloresDigitos[0] !== coloresDigitos[1]) {
                        if (coloresDigitos[0] === 'green') {
                            if (patronMarcado("Patron 23")) { getCelda('Patron 23', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("Patron 23")) { getCelda('Patron 23', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analasis para MEJOR DE TRES
                getCelda('Mejor de 3', 1).style.backgroundColor = '';
                getCelda('Mejor de 3', 4).style.backgroundColor = '';
                if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                    const minoritario = colorMenosRepetido([6, 7, 8]);
                    if (minoritario === "green") {
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 2).style.backgroundColor = 'red'; }
                    } else {
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 5).style.backgroundColor = 'green'; }
                    }
                }
                // Analisis Patron Impar
                getCelda('Patron Impar', 2).style.backgroundColor = '';
                getCelda('Patron Impar', 5).style.backgroundColor = '';

                //Analisis de las que pueden ganar en este digito:
                //MHI mayoria y minoria
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                        const minoritario = colorMenosRepetido([7, 8, 9]);
                        const mayoritario = colorMasRepetido([7, 8, 9]);
                        if (minoritario !== coloresDigitos[0] && minoritario === coloresDigitos[1]) {
                            agregarResultadoConTiempo(historicoMHI, "G1", "MHI_Minor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1]) {
                                agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minor√≠a");
                            }
                        }
                        if (mayoritario !== coloresDigitos[0] && mayoritario === coloresDigitos[1]) {
                            agregarResultadoConTiempo(historicoMHIMAY, "G1", "MHI_Mayor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1]) {
                                agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayor√≠a");
                            }
                        }
                    }
                }





                //MHI2 mayoria y minoria2
                if (coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {
                    agregarResultadoConTiempo(historicoMHI2, "E", "MHI_2_Minor√≠a");
                    agregarResultadoConTiempo(historicoMHI2MAY, "E", "MHI_2_Mayor√≠a");
                } else {
                    const minoritario = colorMenosRepetido([7, 8, 9]);
                    if (minoritario === coloresDigitos[1]) {
                        agregarResultadoConTiempo(historicoMHI2, "D", "MHI_2_Minor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minor√≠a");
                        }
                    }

                    const mayoritario = colorMasRepetido([7, 8, 9]);
                    if (mayoritario === coloresDigitos[1]) {
                        agregarResultadoConTiempo(historicoMHI2MAY, "D", "MHI_2_Mayor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayor√≠a");
                        }
                    }

                }
                //MHI mayoria y minoria
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                        const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
                        const mayoritario = colorMasRepetido([5, 6, 7, 8, 9]);

                        if (minoritario !== coloresDigitos[0] && minoritario === coloresDigitos[1]) {
                            agregarResultadoConTiempo(historicoMILLONMIN, "G1", "Mill√≥n_Minor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1]) {
                                agregarResultadoConTiempo(historicoMILLONMIN, "L", "Mill√≥n_Minor√≠a");
                            }
                        }

                        if (mayoritario !== coloresDigitos[0] && mayoritario === coloresDigitos[1]) {
                            agregarResultadoConTiempo(historicoMILLONMAY, "G1", "Mill√≥n_Mayor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1]) {
                                agregarResultadoConTiempo(historicoMILLONMAY, "L", "Mill√≥n_Mayor√≠a");
                            }
                        }

                    }
                }
                //Torres Gemelas
                if (valorSelect === "mg2") {
                    if (coloresDigitos[5] !== 'doji') {
                        if (coloresDigitos[5] !== coloresDigitos[9] && coloresDigitos[5] !== coloresDigitos[0] && coloresDigitos[5] === coloresDigitos[1]) {
                            agregarResultadoConTiempo(historicoTORRESGEMELAS, "G2", "Torres_Gemelas");
                        } else if (coloresDigitos[5] !== coloresDigitos[9] && coloresDigitos[5] !== coloresDigitos[0] && coloresDigitos[5] !== coloresDigitos[1]) {
                            agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
                        }
                    }
                }
                //Tres Vecinos
                if (valorSelect === "mg2") {
                    if (coloresDigitos[8] !== 'doji') {
                        if (coloresDigitos[8] !== coloresDigitos[9] && coloresDigitos[8] !== coloresDigitos[0] && coloresDigitos[8] === coloresDigitos[1]) {
                            agregarResultadoConTiempo(historicoTRESVECINOS, "G2", "Tres_Vecinos");
                        } else if (coloresDigitos[8] !== coloresDigitos[9] && coloresDigitos[8] !== coloresDigitos[0] && coloresDigitos[8] !== coloresDigitos[1]) {

                            agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
                        }
                    }
                }
                //Patron 3x1
                if (valorSelect === "mg2") {
                    if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {
                        const minoritario = colorMenosRepetido([5, 6, 7]);
                        if (minoritario !== coloresDigitos[9] && minoritario !== coloresDigitos[0] && minoritario === coloresDigitos[1]) {
                            agregarResultadoConTiempo(historicoPATRON3X1, "G2", "Patron_3x1");
                        } else if (minoritario !== coloresDigitos[9] && minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1]) {

                            agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
                        }
                    }
                }
                //Patron 23
                if (coloresDigitos[0] === 'doji') {
                    agregarResultadoConTiempo(historicoPADRON23, "E", "Patron_23");

                } else {
                    if (coloresDigitos[0] === coloresDigitos[1]) {
                        agregarResultadoConTiempo(historicoPADRON23, "D", "Patron_23");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoPADRON23, "L", "Patron_23");
                        }
                    }

                }
            }

            function digito2(vela) {
                ultimaVela = coloresDigitos[2];
                //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
                getCelda('MHI 2 Minor√≠a', 3).style.backgroundColor = '';
                getCelda('MHI 2 Minor√≠a', 6).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 3).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 6).style.backgroundColor = '';
                getCelda('MHI 3 Minor√≠a', 2).style.backgroundColor = '';
                getCelda('MHI 3 Minor√≠a', 5).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 2).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 5).style.backgroundColor = '';
                if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                    const minoritario = colorMenosRepetido([7, 8, 9]);
                    if (minoritario === coloresDigitos[2]) {
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 3).style.backgroundColor = 'red'; }
                        } else {
                            if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                    } else {
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analasis para Torres Gemelas
                if (coloresDigitos[0] !== 'doji') {
                    if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 1).style.backgroundColor = coloresDigitos[0]; }
                    if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 4).style.backgroundColor = coloresDigitos[0]; }
                }
                //Analisis correspondiente a TRES MOSQUETEROS
                getCelda('Tres Mosqueteros', 1).style.backgroundColor = '';
                getCelda('Tres Mosqueteros', 4).style.backgroundColor = '';
                if (coloresDigitos[2] !== 'doji') {
                    if (coloresDigitos[2] === 'green') {
                        if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 5).style.backgroundColor = 'green'; }
                    } else {
                        if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 2).style.backgroundColor = 'red'; }
                    }
                }
                //Analisis correspondiente a TRES VECINOS
                if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 1).style.backgroundColor = 'green'; }
                if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 4).style.backgroundColor = 'red'; }
                //Analisis correspondiente a PATRON 23
                getCelda('Patron 23', 3).style.backgroundColor = '';
                getCelda('Patron 23', 6).style.backgroundColor = '';
                //Analasis para MEJOR DE TRES
                getCelda('Mejor de 3', 2).style.backgroundColor = '';
                getCelda('Mejor de 3', 5).style.backgroundColor = '';
                if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                    const minoritario = colorMenosRepetido([5, 7, 8]);
                    if (minoritario === coloresDigitos[2]) {
                        if (minoritario === "green") {
                            if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 3).style.backgroundColor = 'red'; }
                        } else {
                            if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 6).style.backgroundColor = 'green'; }
                        }
                    }
                }
                //Analisis Patron 3x1
                if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {    //Para si hay un doji no hacer nada
                    const minoritario = colorMenosRepetido([0, 1, 2]);
                    if (patronMarcado("")) { getCelda('Patron 3x1', 1).style.backgroundColor = minoritario; }
                    if (patronMarcado("")) { getCelda('Patron 3x1', 4).style.backgroundColor = minoritario; }

                }
                // Analisis Patron Impar
                if (coloresDigitos[7] !== 'doji') {
                    if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] !== coloresDigitos[2]) {
                        if (coloresDigitos[7] === 'green') {
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 3).style.backgroundColor = 'green'; }
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 3).style.backgroundColor = 'red'; }
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 6).style.backgroundColor = 'red'; }
                        }
                    }
                }

                //Analisis de las que pueden ganar en este digito:
                //MHI mayoria y minoria
                if (valorSelect === "mg2") {
                    if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                        const minoritario = colorMenosRepetido([7, 8, 9]);
                        if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario === coloresDigitos[2]) {
                            agregarResultadoConTiempo(historicoMHI, "G2", "MHI_Minor√≠a");
                        } else if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2]) {

                            agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minor√≠a");
                        }
                    }
                    const mayoritario = colorMasRepetido([7, 8, 9]);
                    if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario === coloresDigitos[2]) {
                        agregarResultadoConTiempo(historicoMHIMAY, "G2", "MHI_Mayor√≠a");
                    } else if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2]) {

                        agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayor√≠a");

                    }
                }
                //MHI mayoria2 y minoria2
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                        const minoritario = colorMenosRepetido([7, 8, 9]);
                        const mayoritario = colorMasRepetido([7, 8, 9]);
                        if (minoritario !== coloresDigitos[1] && minoritario === coloresDigitos[2]) {
                            agregarResultadoConTiempo(historicoMHI2, "G1", "MHI_2_Minor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2]) {
                                agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minor√≠a");
                            }
                        }
                        if (mayoritario !== coloresDigitos[1] && mayoritario === coloresDigitos[2]) {
                            agregarResultadoConTiempo(historicoMHI2MAY, "G1", "MHI_2_Mayor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2]) {
                                agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayor√≠a");
                            }
                        }
                    }
                }
                //MHI3 mayoria y minoria3
                if (coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji' || coloresDigitos[9] === 'doji') {
                    agregarResultadoConTiempo(historicoMHI3, "E", "MHI_3_Minor√≠a");
                    agregarResultadoConTiempo(historicoMHI3MAY, "E", "MHI_3_Mayor√≠a");

                } else {
                    const minoritario = colorMenosRepetido([7, 8, 9]);
                    if (minoritario === coloresDigitos[2]) {
                        agregarResultadoConTiempo(historicoMHI3, "D", "MHI_3_Minor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minor√≠a");
                        }
                    }

                    const mayoritario = colorMasRepetido([7, 8, 9]);
                    if (mayoritario === coloresDigitos[2]) {
                        agregarResultadoConTiempo(historicoMHI3MAY, "D", "MHI_3_Mayor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayor√≠a");
                        }
                    }

                }
                if (valorSelect === "mg2") {
                    if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                        const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
                        const mayoritario = colorMasRepetido([5, 6, 7, 8, 9]);
                        if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario === coloresDigitos[2]) {
                            agregarResultadoConTiempo(historicoMILLONMIN, "G2", "Mill√≥n_Minor√≠a");
                        } else if (minoritario !== coloresDigitos[0] && minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2]) {
                            agregarResultadoConTiempo(historicoMILLONMIN, "L", "Mill√≥n_Minor√≠a");
                        }
                        if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario === coloresDigitos[2]) {
                            agregarResultadoConTiempo(historicoMILLONMAY, "G2", "Mill√≥n_Mayor√≠a");
                        } else if (mayoritario !== coloresDigitos[0] && mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2]) {
                            agregarResultadoConTiempo(historicoMILLONMAY, "L", "Mill√≥n_Mayor√≠a");
                        }

                    }



                }
                //Mejor de 3
                if (coloresDigitos[6] === 'doji' || coloresDigitos[7] === 'doji' || coloresDigitos[8] === 'doji') {
                    agregarResultadoConTiempo(historicoMEJOR3, "E", "Mejor_de_3");
                } else {
                    const mayoritario = colorMasRepetido([6, 7, 8]);
                    if (mayoritario === coloresDigitos[2]) {
                        agregarResultadoConTiempo(historicoMEJOR3, "D", "Mejor_de_3");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");
                        }
                    }

                }
                //Patron Impar
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[7] !== 'doji') {
                        if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] === coloresDigitos[2]) {
                            agregarResultadoConTiempo(historicoPATRONIMPAR, "G1", "Patron_Impar");
                        }
                        if (valorSelect === "mg1") {
                            if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] !== coloresDigitos[2]) {
                                agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patron_Impar");
                            }
                        }
                    }
                }
                //Patron 23
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[0] !== 'doji') {
                        if (coloresDigitos[0] !== coloresDigitos[1] && coloresDigitos[0] === coloresDigitos[2]) {
                            agregarResultadoConTiempo(historicoPADRON23, "G1", "Patron_23");
                        }
                        if (valorSelect === "mg1") {
                            if (coloresDigitos[0] !== coloresDigitos[1] && coloresDigitos[0] !== coloresDigitos[2]) {
                                agregarResultadoConTiempo(historicoPADRON23, "L", "Patron_23");
                            }
                        }
                    }
                }
            }

            function digito3(vela) {
                ultimaVela = coloresDigitos[3];
                //MHI Minoria y MHI Mayoria
                if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                    if (coloresDigitos[2] === coloresDigitos[3]) {
                        const opuesto = coloresDigitos[2] === 'red' ? 'green' : 'red';
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 1).style.backgroundColor = opuesto; }
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 4).style.backgroundColor = opuesto; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 1).style.backgroundColor = coloresDigitos[2]; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 4).style.backgroundColor = coloresDigitos[2]; }
                    } else {
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 4).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 4).style.backgroundColor = 'red'; }
                    }
                }
                //Millon Minoria y Millon Mayoria
                if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                    const minoritario = colorMenosRepetido([0, 1, 2, 3]);
                    if (minoritario === 'empate') {
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'red'; }
                    }
                    else if (minoritario === 'red') {
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'green'; }
                    }
                    else {
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'red'; }
                    }
                }
                getCelda('MHI 3 Minor√≠a', 3).style.backgroundColor = '';
                getCelda('MHI 3 Minor√≠a', 6).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 3).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 6).style.backgroundColor = '';
                //Analasis para Torres Gemelas
                getCelda('Torres Gemelas', 1).style.backgroundColor = '';
                getCelda('Torres Gemelas', 4).style.backgroundColor = '';
                if (coloresDigitos[0] !== 'doji') {
                    if (coloresDigitos[0] === 'green') {
                        if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 5).style.backgroundColor = coloresDigitos[0]; }
                    } else {
                        if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 2).style.backgroundColor = coloresDigitos[0]; }
                    }
                }
                //Analisis correspondiente a TRES MOSQUETEROS
                getCelda('Tres Mosqueteros', 2).style.backgroundColor = '';
                getCelda('Tres Mosqueteros', 5).style.backgroundColor = '';
                if (coloresDigitos[2] !== 'doji') {
                    if (coloresDigitos[2] !== coloresDigitos[3]) {
                        if (coloresDigitos[2] === 'green') {
                            if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analisis correspondiente a TRES VECINOS
                getCelda('Tres Vecinos', 1).style.backgroundColor = '';
                getCelda('Tres Vecinos', 4).style.backgroundColor = '';
                if (coloresDigitos[3] !== 'doji') {
                    if (coloresDigitos[3] === 'green') {
                        if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 5).style.backgroundColor = 'green'; }
                    } else {
                        if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 2).style.backgroundColor = 'red'; }
                    }
                }
                //Analasis para MEJOR DE TRES
                getCelda('Mejor de 3', 3).style.backgroundColor = '';
                getCelda('Mejor de 3', 6).style.backgroundColor = '';
                //Analisis Patron 3x1
                getCelda('Patron 3x1', 1).style.backgroundColor = '';
                getCelda('Patron 3x1', 4).style.backgroundColor = '';
                if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {    //Para si hay un doji no hacer nada
                    const minoritario = colorMenosRepetido([0, 1, 2]);
                    if (minoritario === 'green') {
                        if (patronMarcado("")) { getCelda('Patron 3x1', 5).style.backgroundColor = 'green'; }
                    } else {
                        if (patronMarcado("")) { getCelda('Patron 3x1', 2).style.backgroundColor = 'red'; }
                    }
                }
                // Analisis Patron Impar
                getCelda('Patron Impar', 3).style.backgroundColor = '';
                getCelda('Patron Impar', 6).style.backgroundColor = '';
                if (coloresDigitos[2] !== 'doji') {
                    if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 1).style.backgroundColor = coloresDigitos[2]; }
                    if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 4).style.backgroundColor = coloresDigitos[2]; }
                }

                //Analisis de las que pueden ganar en este digito:
                //MHI mayoria2 y minoria2
                if (valorSelect === "mg2") {
                    if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                        const minoritario = colorMenosRepetido([7, 8, 9]);
                        if (minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2] && minoritario === coloresDigitos[3]) {
                            agregarResultadoConTiempo(historicoMHI2, "G2", "MHI_2_Minor√≠a");
                        } else if (minoritario !== coloresDigitos[1] && minoritario !== coloresDigitos[2] && minoritario !== coloresDigitos[3]) {
                            agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minor√≠a");
                        }
                        const mayoritario = colorMasRepetido([7, 8, 9]);

                        if (mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2] && mayoritario === coloresDigitos[3]) {
                            agregarResultadoConTiempo(historicoMHI2MAY, "G2", "MHI_2_Mayor√≠a");
                        } else if (mayoritario !== coloresDigitos[1] && mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3]) {
                            agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayor√≠a");
                        }
                    }

                }
                //MHI mayoria3 y minoria3
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                        const minoritario = colorMenosRepetido([7, 8, 9]);
                        const mayoritario = colorMasRepetido([7, 8, 9]);

                        if (minoritario !== coloresDigitos[2] && minoritario === coloresDigitos[3]) {
                            agregarResultadoConTiempo(historicoMHI3, "G1", "MHI_3_Minor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (minoritario !== coloresDigitos[2] && minoritario !== coloresDigitos[3]) {
                                agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minor√≠a");
                            }
                        }

                        if (mayoritario !== coloresDigitos[2] && mayoritario === coloresDigitos[3]) {
                            agregarResultadoConTiempo(historicoMHI3MAY, "G1", "MHI_3_Mayor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3]) {
                                agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayor√≠a");
                            }
                        }
                    }
                }







                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                        const mayoritario = colorMasRepetido([6, 7, 8]);
                        if (mayoritario !== coloresDigitos[2] && mayoritario === coloresDigitos[3]) {
                            agregarResultadoConTiempo(historicoMEJOR3, "G1", "Mejor_de_3");
                        }
                        if (valorSelect === "mg1") {
                            if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3]) {
                                agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");
                            }
                        }
                    }
                }


                //Tres Mosqueteros
                if (coloresDigitos[2] === 'doji') {
                    agregarResultadoConTiempo(historicoMOSQUETEROS, "E", "Tres_Mosqueteros");
                } else {
                    if (coloresDigitos[2] === coloresDigitos[3]) {
                        agregarResultadoConTiempo(historicoMOSQUETEROS, "D", "Tres_Mosqueteros");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
                        }
                    }

                }
                //Patron 23
                if (valorSelect === "mg2") {
                    if (coloresDigitos[0] !== 'doji') {
                        if (coloresDigitos[0] !== coloresDigitos[1] && coloresDigitos[0] !== coloresDigitos[2] && coloresDigitos[0] === coloresDigitos[3]) {
                            agregarResultadoConTiempo(historicoPADRON23, "G2", "Patron_23");
                        } else if (coloresDigitos[0] !== coloresDigitos[1] && coloresDigitos[0] !== coloresDigitos[2] && coloresDigitos[0] !== coloresDigitos[3]) {

                            agregarResultadoConTiempo(historicoPADRON23, "L", "Patron_23");
                        }
                    }
                }
            }

            function digito4(vela) {
                ultimaVela = coloresDigitos[4];
                //Analisis Correspondiente a MHMI Minoria MHI Mayoria
                ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                    getCelda(patron, 1).style.backgroundColor = '';
                    getCelda(patron, 4).style.backgroundColor = '';
                });
                if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                    const minoritario = colorMenosRepetido([2, 3, 4]);
                    if (minoritario === 'red') {
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 2).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 5).style.backgroundColor = 'green'; }
                    } else if (minoritario === 'green') {
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 5).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 2).style.backgroundColor = 'red'; }
                    }
                }
                //Analisis Correspondiente a Mill√≥n Minoria Mill√≥n Mayoria
                if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {    //Para si hay un doji no hacer nada
                    const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
                    if (minoritario === 'red') {
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 2).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 5).style.backgroundColor = 'green'; }
                    } else {
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 5).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 2).style.backgroundColor = 'red'; }
                    }
                }

                //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
                if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                    const minoritario = colorMenosRepetido([2, 3, 4]);
                    if (minoritario === 'red') {
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = 'green'; }
                    } else if (minoritario === 'green') {
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = 'red'; }

                    }
                }
                //Analasis para Torres Gemelas
                getCelda('Torres Gemelas', 2).style.backgroundColor = '';
                getCelda('Torres Gemelas', 5).style.backgroundColor = '';
                if (coloresDigitos[0] !== 'doji') {
                    if (coloresDigitos[0] !== coloresDigitos[4]) {
                        if (coloresDigitos[0] === 'green') {
                            if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 6).style.backgroundColor = coloresDigitos[0]; }
                        } else {
                            if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 3).style.backgroundColor = coloresDigitos[0]; }
                        }
                    }
                }
                //Analisis correspondiente a TRES MOSQUETEROS
                getCelda('Tres Mosqueteros', 3).style.backgroundColor = '';
                getCelda('Tres Mosqueteros', 6).style.backgroundColor = '';
                //Analisis correspondiente a TRES VECINOS
                getCelda('Tres Vecinos', 2).style.backgroundColor = '';
                getCelda('Tres Vecinos', 5).style.backgroundColor = '';
                if (coloresDigitos[3] !== 'doji') {
                    if (coloresDigitos[3] !== coloresDigitos[4]) {
                        if (coloresDigitos[3] === 'green') {
                            if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analisis correspondiente a PATRON 23
                if (patronMarcado("Patron 23")) { getCelda('Patron 23', 1).style.backgroundColor = 'green'; }
                if (patronMarcado("Patron 23")) { getCelda('Patron 23', 4).style.backgroundColor = 'red'; }
                //Analisis Patron 3x1
                getCelda('Patron 3x1', 2).style.backgroundColor = '';
                getCelda('Patron 3x1', 5).style.backgroundColor = '';
                if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {    //Para si hay un doji no hacer nada
                    const minoritario = colorMenosRepetido([0, 1, 2]);
                    if (minoritario !== coloresDigitos[4]) {
                        if (minoritario === 'green') {
                            if (patronMarcado("")) { getCelda('Patron 3x1', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("")) { getCelda('Patron 3x1', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                // Analisis Patron Impar
                getCelda('Patron Impar', 1).style.backgroundColor = '';
                getCelda('Patron Impar', 4).style.backgroundColor = '';

                //MHI mayoria3 y minoria3
                if (valorSelect === "mg2") {
                    if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                        const minoritario = colorMenosRepetido([7, 8, 9]);
                        const mayoritario = colorMasRepetido([7, 8, 9]);
                        if (minoritario !== coloresDigitos[2] && minoritario !== coloresDigitos[3] && minoritario === coloresDigitos[4]) {
                            agregarResultadoConTiempo(historicoMHI3, "G2", "MHI_3_Minor√≠a");
                        } else if (minoritario !== coloresDigitos[2] && minoritario !== coloresDigitos[3] && minoritario !== coloresDigitos[4]) {
                            agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minor√≠a");
                        }
                        if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario === coloresDigitos[4]) {
                            agregarResultadoConTiempo(historicoMHI3MAY, "G2", "MHI_3_Mayor√≠a");
                        } else if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario !== coloresDigitos[4]) {
                            agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayor√≠a");
                        }
                    }

                }
                //Torres Gemelas
                if (coloresDigitos[0] === 'doji') {
                    agregarResultadoConTiempo(historicoTORRESGEMELAS, "E", "Torres_Gemelas");
                } else {
                    if (coloresDigitos[0] === coloresDigitos[4]) {
                        agregarResultadoConTiempo(historicoTORRESGEMELAS, "D", "Torres_Gemelas");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
                        }
                    }

                }

                if (valorSelect === "mg2") {
                    if (coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                        const mayoritario = colorMasRepetido([6, 7, 8]);
                        if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario === coloresDigitos[4]) {
                            agregarResultadoConTiempo(historicoMEJOR3, "G2", "Mejor_de_3");
                        } else if (mayoritario !== coloresDigitos[2] && mayoritario !== coloresDigitos[3] && mayoritario !== coloresDigitos[4]) {

                            agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");

                        }
                    }
                }

                //Tres mosqueteros
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[2] !== 'doji') {
                        if (coloresDigitos[2] !== coloresDigitos[3] && coloresDigitos[2] === coloresDigitos[4]) {
                            agregarResultadoConTiempo(historicoMOSQUETEROS, "G1", "Tres_Mosqueteros");
                        }
                        if (valorSelect === "mg1") {
                            if (coloresDigitos[2] !== coloresDigitos[3] && coloresDigitos[2] !== coloresDigitos[4]) {
                                agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
                            }
                        }
                    }
                }
                //Patron Impar
                if (valorSelect === "mg2") {
                    if (coloresDigitos[7] !== 'doji') {
                        if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] !== coloresDigitos[2] && coloresDigitos[7] === coloresDigitos[4]) {
                            agregarResultadoConTiempo(historicoPATRONIMPAR, "G2", "Patron_Impar");
                        } else if (coloresDigitos[7] !== coloresDigitos[0] && coloresDigitos[7] !== coloresDigitos[2] && coloresDigitos[7] !== coloresDigitos[4]) {

                            agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patron_Impar");
                        }
                    }
                }
                //Tres Vecinos
                if (coloresDigitos[3] === 'doji') {
                    agregarResultadoConTiempo(historicoTRESVECINOS, "E", "Tres_Vecinos");
                } else {
                    if (coloresDigitos[3] === coloresDigitos[4]) {
                        agregarResultadoConTiempo(historicoTRESVECINOS, "D", "Tres_Vecinos");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
                        }
                    }

                }
                //Patron 3x1
                if (coloresDigitos[0] === 'doji' || coloresDigitos[1] === 'doji' || coloresDigitos[2] === 'doji') {
                    agregarResultadoConTiempo(historicoPATRON3X1, "E", "Patron_3x1");
                } else {
                    const minoritario = colorMenosRepetido([0, 1, 2]);
                    if (minoritario === coloresDigitos[4]) {
                        agregarResultadoConTiempo(historicoPATRON3X1, "D", "Patron_3x1");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
                        }
                    }

                }
            }

            function digito5(vela) {
                ultimaVela = coloresDigitos[5];
                ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                    getCelda(patron, 2).style.backgroundColor = '';
                    getCelda(patron, 5).style.backgroundColor = '';
                });
                //Analisis Correspondiente a NHI Minoria MHI Mayoria
                if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                    const minoritario = colorMenosRepetido([2, 3, 4]);
                    if (minoritario === coloresDigitos[5]) {
                        // Gana MHI Minor√≠a, pierde MHI Mayor√≠a
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 3).style.backgroundColor = 'red'; }
                        } else if (minoritario === 'red') {
                            if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                    } else {
                        // Gana MHI Mayor√≠a, pierde MHI Minor√≠a
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 6).style.backgroundColor = 'green'; }
                        } else if (minoritario === 'red') {
                            if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analisis Correspondiente a Mill√≥n Minoria Mill√≥n Mayoria
                if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {    //Para si hay un doji no hacer nada
                    const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
                    if (minoritario === coloresDigitos[5]) {   //Se gana mill minoria y se pierde mill mayoria
                        if (minoritario === 'green') {
                            if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                        if (minoritario === 'red') {
                            if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                    } else {
                        if (minoritario === 'green') {
                            if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                        if (minoritario === 'red') {
                            if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
                getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = '';
                getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = '';
                if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                    const minoritario = colorMenosRepetido([2, 3, 4]);
                    if (minoritario === 'green') {
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 5).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 2).style.backgroundColor = 'red'; }
                    } else {
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 2).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 5).style.backgroundColor = 'green'; }
                    }
                }
                //Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
                if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                    const minoritario = colorMenosRepetido([2, 3, 4]);
                    if (minoritario === 'red') {
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = 'green'; }
                    } else if (minoritario === 'green') {
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = 'red'; }
                    }
                }
                //Analasis para Torres Gemelas
                getCelda('Torres Gemelas', 3).style.backgroundColor = '';
                getCelda('Torres Gemelas', 6).style.backgroundColor = '';
                //Analisis correspondiente a TRES VECINOS
                getCelda('Tres Vecinos', 3).style.backgroundColor = '';
                getCelda('Tres Vecinos', 6).style.backgroundColor = '';
                //Analisis correspondiente a PATRON 23
                getCelda('Patron 23', 1).style.backgroundColor = '';
                getCelda('Patron 23', 4).style.backgroundColor = '';
                if (coloresDigitos[5] !== 'doji') {
                    if (coloresDigitos[5] === 'green') {
                        if (patronMarcado("Patron 23")) { getCelda('Patron 23', 5).style.backgroundColor = 'green'; }
                    } else {
                        if (patronMarcado("Patron 23")) { getCelda('Patron 23', 2).style.backgroundColor = 'red'; }
                    }
                }
                //Analasis para MEJOR DE TRES
                if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                    const minoritario = colorMenosRepetido([1, 2, 3]);
                    if (minoritario === 'green') {
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 4).style.backgroundColor = 'red'; }
                    } else {
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 4).style.backgroundColor = 'green'; }
                    }
                }
                //Analisis Patron 3x1
                getCelda('Patron 3x1', 3).style.backgroundColor = '';
                getCelda('Patron 3x1', 6).style.backgroundColor = '';
                // Analisis Patron Impar
                if (coloresDigitos[2] !== 'doji') {
                    if (coloresDigitos[2] !== coloresDigitos[5]) {
                        if (coloresDigitos[2] === 'green') {
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 2).style.backgroundColor = 'green'; }
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 5).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 2).style.backgroundColor = 'red'; }
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 5).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analisis de las que pueden ganar en este digito:
                //MHI mayoria y minoria
                if (coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
                    agregarResultadoConTiempo(historicoMHI, "E", "MHI_Minor√≠a");
                    agregarResultadoConTiempo(historicoMHIMAY, "E", "MHI_Mayor√≠a");
                } else {
                    const minoritario = colorMenosRepetido([2, 3, 4]);
                    if (minoritario === coloresDigitos[5]) {
                        agregarResultadoConTiempo(historicoMHI, "D", "MHI_Minor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minor√≠a");
                        }
                    }

                    const mayoritario = colorMasRepetido([2, 3, 4]);
                    if (mayoritario === coloresDigitos[5]) {
                        agregarResultadoConTiempo(historicoMHIMAY, "D", "MHI_Mayor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayor√≠a");
                        }
                    }

                }
                //MHI mayoria y minoria
                if (coloresDigitos[0] === 'doji' || coloresDigitos[1] === 'doji' || coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
                    agregarResultadoConTiempo(historicoMILLONMIN, "E", "Mill√≥n_Minor√≠a");
                    agregarResultadoConTiempo(historicoMILLONMAY, "E", "Mill√≥n_Mayor√≠a");
                } else {
                    const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
                    if (minoritario === coloresDigitos[5]) {
                        agregarResultadoConTiempo(historicoMILLONMIN, "D", "Mill√≥n_Minor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMILLONMIN, "L", "Mill√≥n_Minor√≠a");
                        }
                    }

                    const mayoritario = colorMasRepetido([0, 1, 2, 3, 4]);
                    if (mayoritario === coloresDigitos[5]) {
                        agregarResultadoConTiempo(historicoMILLONMAY, "D", "Mill√≥n_Mayor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMILLONMAY, "L", "Mill√≥n_Mayor√≠a");
                        }
                    }

                }
                //Torres Gemelas
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[0] !== 'doji') {
                        if (coloresDigitos[0] !== coloresDigitos[4] && coloresDigitos[0] === coloresDigitos[5]) {
                            agregarResultadoConTiempo(historicoTORRESGEMELAS, "G1", "Torres_Gemelas");
                        }
                        if (valorSelect === "mg1") {
                            if (coloresDigitos[0] !== coloresDigitos[4] && coloresDigitos[0] !== coloresDigitos[5]) {
                                agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
                            }
                        }
                    }
                }
                //Tres Mosqueteros
                if (valorSelect === "mg2") {
                    if (coloresDigitos[2] !== 'doji') {
                        if (coloresDigitos[2] !== coloresDigitos[3] && coloresDigitos[2] !== coloresDigitos[4] && coloresDigitos[2] === coloresDigitos[5]) {
                            agregarResultadoConTiempo(historicoMOSQUETEROS, "G2", "Tres_Mosqueteros");
                        } else if (coloresDigitos[2] !== coloresDigitos[3] && coloresDigitos[2] !== coloresDigitos[4] && coloresDigitos[2] !== coloresDigitos[5]) {

                            agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
                        }
                    }
                }
                //Patron Impar
                if (coloresDigitos[2] === 'doji') {
                    agregarResultadoConTiempo(historicoPATRONIMPAR, "E", "Patron_Impar");
                } else {
                    if (coloresDigitos[2] === coloresDigitos[5]) {
                        agregarResultadoConTiempo(historicoPATRONIMPAR, "D", "Patron_Impar");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patron_Impar");
                        }
                    }

                }
                //Tres Vecinos
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[3] !== 'doji') {
                        if (coloresDigitos[3] !== coloresDigitos[4] && coloresDigitos[3] === coloresDigitos[5]) {
                            agregarResultadoConTiempo(historicoTRESVECINOS, "G1", "Tres_Vecinos");
                        }
                        if (valorSelect === "mg1") {
                            if (coloresDigitos[3] !== coloresDigitos[4] && coloresDigitos[3] !== coloresDigitos[5]) {
                                agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
                            }
                        }
                    }
                }
                //Patron 3x1
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {
                        const minoritario = colorMenosRepetido([0, 1, 2]);
                        if (minoritario !== coloresDigitos[4] && minoritario === coloresDigitos[5]) {
                            agregarResultadoConTiempo(historicoPATRON3X1, "G1", "Patron_3x1");
                        }
                        if (valorSelect === "mg1") {
                            if (minoritario !== coloresDigitos[4] && minoritario !== coloresDigitos[5]) {
                                agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
                            }
                        }
                    }
                }



            }

            function digito6(vela) {
                ultimaVela = coloresDigitos[6];
                ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                    getCelda(patron, 3).style.backgroundColor = '';
                    getCelda(patron, 6).style.backgroundColor = '';
                });
                //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
                getCelda('MHI 2 Minor√≠a', 2).style.backgroundColor = '';
                getCelda('MHI 2 Minor√≠a', 5).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 2).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 5).style.backgroundColor = '';
                if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                    const minoritario = colorMenosRepetido([2, 3, 4]);
                    if (minoritario === coloresDigitos[6]) {
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                        else {
                            if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                    } else {
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                        else {
                            if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analisis Correspondiente a MMHI3 Minoria MHI3 Mayoria
                getCelda('MHI 3 Minor√≠a', 1).style.backgroundColor = '';
                getCelda('MHI 3 Minor√≠a', 4).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 1).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 4).style.backgroundColor = '';
                if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                    const minoritario = colorMenosRepetido([2, 3, 4]);
                    if (minoritario === 'green') {
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 5).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 2).style.backgroundColor = 'red'; }
                    } else {
                        if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 2).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 5).style.backgroundColor = 'green'; }
                    }
                }
                //Analisis correspondiente a TRES MOSQUETEROS
                if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 1).style.backgroundColor = 'green'; }
                if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 4).style.backgroundColor = 'red'; }
                //Analisis correspondiente a PATRON 23
                getCelda('Patron 23', 2).style.backgroundColor = '';
                getCelda('Patron 23', 5).style.backgroundColor = '';
                if (coloresDigitos[5] !== 'doji') {
                    if (coloresDigitos[5] !== coloresDigitos[6]) {
                        if (coloresDigitos[5] === 'green') {
                            if (patronMarcado("Patron 23")) { getCelda('Patron 23', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("Patron 23")) { getCelda('Patron 23', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analasis para MEJOR DE TRES
                getCelda('Mejor de 3', 1).style.backgroundColor = '';
                getCelda('Mejor de 3', 4).style.backgroundColor = '';
                if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                    const minoritario = colorMenosRepetido([1, 2, 3]);
                    if (minoritario === "green") {
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 2).style.backgroundColor = 'red'; }
                    } else {
                        if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 5).style.backgroundColor = 'green'; }
                    }
                }
                // Analisis Patron Impar
                getCelda('Patron Impar', 2).style.backgroundColor = '';
                getCelda('Patron Impar', 5).style.backgroundColor = '';

                //Analisis de las que pueden ganar en este digito:
                //MHI mayoria y minoria
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                        const minoritario = colorMenosRepetido([2, 3, 4]);
                        const mayoritario = colorMasRepetido([2, 3, 4]);

                        if (minoritario !== coloresDigitos[5] && minoritario === coloresDigitos[6]) {
                            agregarResultadoConTiempo(historicoMHI, "G1", "MHI_Minor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6]) {
                                agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minor√≠a");
                            }
                        }
                        if (mayoritario !== coloresDigitos[5] && mayoritario === coloresDigitos[6]) {
                            agregarResultadoConTiempo(historicoMHIMAY, "G1", "MHI_Mayor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6]) {
                                agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayor√≠a");
                            }
                        }
                    }
                }




                //MHI mayoria2 y minoria2
                if (coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
                    agregarResultadoConTiempo(historicoMHI2, "E", "MHI_2_Minor√≠a");
                    agregarResultadoConTiempo(historicoMHI2MAY, "E", "MHI_2_Mayor√≠a");
                } else {
                    const minoritario = colorMenosRepetido([2, 3, 4]);
                    if (minoritario === coloresDigitos[6]) {
                        agregarResultadoConTiempo(historicoMHI2, "D", "MHI_2_Minor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minor√≠a");
                        }
                    }

                    const mayoritario = colorMasRepetido([2, 3, 4]);
                    if (mayoritario === coloresDigitos[6]) {
                        agregarResultadoConTiempo(historicoMHI2MAY, "D", "MHI_2_Mayor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayor√≠a");
                        }
                    }

                }

                //MHI mayoria y minoria
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                        const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
                        const mayoritario = colorMasRepetido([0, 1, 2, 3, 4]);

                        if (minoritario !== coloresDigitos[5] && minoritario === coloresDigitos[6]) {
                            agregarResultadoConTiempo(historicoMILLONMIN, "G1", "Mill√≥n_Minor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6]) {
                                agregarResultadoConTiempo(historicoMILLONMIN, "L", "Mill√≥n_Minor√≠a");
                            }
                        }

                        if (mayoritario !== coloresDigitos[5] && mayoritario === coloresDigitos[6]) {
                            agregarResultadoConTiempo(historicoMILLONMAY, "G1", "Mill√≥n_Mayor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6]) {
                                agregarResultadoConTiempo(historicoMILLONMAY, "L", "Mill√≥n_Mayor√≠a");
                            }
                        }

                    }
                }





                //Torres Gemelas
                if (valorSelect === "mg2") {
                    if (coloresDigitos[0] !== 'doji') {
                        if (coloresDigitos[0] !== coloresDigitos[4] && coloresDigitos[0] !== coloresDigitos[5] && coloresDigitos[0] === coloresDigitos[6]) {
                            agregarResultadoConTiempo(historicoTORRESGEMELAS, "G2", "Torres_Gemelas");
                        } else if (coloresDigitos[0] !== coloresDigitos[4] && coloresDigitos[0] !== coloresDigitos[5] && coloresDigitos[0] !== coloresDigitos[6]) {

                            agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
                        }
                    }
                }
                //Tres Vecinos
                if (valorSelect === "mg2") {
                    if (coloresDigitos[3] !== 'doji') {
                        if (coloresDigitos[3] !== coloresDigitos[4] && coloresDigitos[3] !== coloresDigitos[5] && coloresDigitos[3] === coloresDigitos[6]) {
                            agregarResultadoConTiempo(historicoTRESVECINOS, "G2", "Tres_Vecinos");
                        } else if (coloresDigitos[3] !== coloresDigitos[4] && coloresDigitos[3] !== coloresDigitos[5] && coloresDigitos[3] !== coloresDigitos[6]) {

                            agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
                        }
                    }
                }
                //Patron 3x1
                if (valorSelect === "mg2") {
                    if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji') {
                        const minoritario = colorMenosRepetido([0, 1, 2]);
                        if (minoritario !== coloresDigitos[4] && minoritario !== coloresDigitos[5] && minoritario === coloresDigitos[6]) {
                            agregarResultadoConTiempo(historicoPATRON3X1, "G2", "Patron_3x1");
                        } else if (minoritario !== coloresDigitos[4] && minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6]) {

                            agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
                        }
                    }
                }
                //Patron 23
                if (coloresDigitos[5] === 'doji') {
                    agregarResultadoConTiempo(historicoPADRON23, "E", "Patron_23");
                } else {
                    if (coloresDigitos[5] === coloresDigitos[6]) {
                        agregarResultadoConTiempo(historicoPADRON23, "D", "Patron_23");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoPADRON23, "L", "Patron_23");
                        }
                    }

                }

            }

            function digito7(vela) {
                ultimaVela = coloresDigitos[7];
                //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
                getCelda('MHI 2 Minor√≠a', 3).style.backgroundColor = '';
                getCelda('MHI 2 Minor√≠a', 6).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 3).style.backgroundColor = '';
                getCelda('MHI 2 Mayor√≠a', 6).style.backgroundColor = '';
                getCelda('MHI 3 Minor√≠a', 2).style.backgroundColor = '';
                getCelda('MHI 3 Minor√≠a', 5).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 2).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 5).style.backgroundColor = '';
                if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                    const minoritario = colorMenosRepetido([2, 3, 4]);
                    if (minoritario === coloresDigitos[7]) {
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 3).style.backgroundColor = 'red'; }
                        } else {
                            if (patronMarcado("MHI 3 Mayor√≠a")) { getCelda('MHI 3 Mayor√≠a', 6).style.backgroundColor = 'green'; }
                        }
                    } else {
                        if (minoritario === 'green') {
                            if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("MHI 3 Minor√≠a")) { getCelda('MHI 3 Minor√≠a', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analasis para Torres Gemelas
                if (coloresDigitos[5] !== 'doji') {
                    if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 1).style.backgroundColor = coloresDigitos[5]; }
                    if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 4).style.backgroundColor = coloresDigitos[5]; }
                }
                //Analisis correspondiente a TRES MOSQUETEROS
                getCelda('Tres Mosqueteros', 1).style.backgroundColor = '';
                getCelda('Tres Mosqueteros', 4).style.backgroundColor = '';
                if (coloresDigitos[7] !== 'doji') {
                    if (coloresDigitos[7] === 'green') {
                        if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 5).style.backgroundColor = 'green'; }
                    } else {
                        if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 2).style.backgroundColor = 'red'; }
                    }
                }
                //Analisis correspondiente a TRES VECINOS
                if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 1).style.backgroundColor = 'green'; }
                if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 4).style.backgroundColor = 'red'; }
                //Analisis correspondiente a PATRON 23
                getCelda('Patron 23', 3).style.backgroundColor = '';
                getCelda('Patron 23', 6).style.backgroundColor = '';
                //Analasis para MEJOR DE TRES
                getCelda('Mejor de 3', 2).style.backgroundColor = '';
                getCelda('Mejor de 3', 5).style.backgroundColor = '';
                if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                    const minoritario = colorMenosRepetido([1, 2, 3]);
                    if (minoritario === coloresDigitos[7]) {
                        if (minoritario === "green") {
                            if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 3).style.backgroundColor = 'red'; }
                        } else {
                            if (patronMarcado("Mejor de 3")) { getCelda('Mejor de 3', 6).style.backgroundColor = 'green'; }
                        }
                    }
                }
                //Analasis para MEJOR DE TRES
                getCelda('Mejor de 3', 3).style.backgroundColor = '';
                getCelda('Mejor de 3', 6).style.backgroundColor = '';
                //Analisis Patron 3x1
                if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {    //Para si hay un doji no hacer nada
                    const minoritario = colorMenosRepetido([5, 6, 7]);
                    if (patronMarcado("")) { getCelda('Patron 3x1', 1).style.backgroundColor = minoritario; }
                    if (patronMarcado("")) { getCelda('Patron 3x1', 4).style.backgroundColor = minoritario; }

                }
                // Analisis Patron Impar
                if (coloresDigitos[2] !== 'doji') {
                    if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] !== coloresDigitos[2]) {
                        if (coloresDigitos[2] === 'green') {
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 3).style.backgroundColor = 'green'; }
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 3).style.backgroundColor = 'red'; }
                            if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 6).style.backgroundColor = 'red'; }
                        }
                    }
                }

                //Analisis de las que pueden ganar en este digito:
                //MHI mayoria y minoria
                if (valorSelect === "mg2") {
                    if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                        const minoritario = colorMenosRepetido([2, 3, 4]);
                        if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario === coloresDigitos[7]) {
                            agregarResultadoConTiempo(historicoMHI, "G2", "MHI_Minor√≠a");
                        } else if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7]) {

                            agregarResultadoConTiempo(historicoMHI, "L", "MHI_Minor√≠a");
                        }
                    }
                    const mayoritario = colorMasRepetido([2, 3, 4]);
                    if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario === coloresDigitos[7]) {
                        agregarResultadoConTiempo(historicoMHIMAY, "G2", "MHI_Mayor√≠a");
                    } else if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7]) {

                        agregarResultadoConTiempo(historicoMHIMAY, "L", "MHI_Mayor√≠a");

                    }
                }
                //MHI mayoria2 y minoria2
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                        const minoritario = colorMenosRepetido([2, 3, 4]);
                        const mayoritario = colorMasRepetido([2, 3, 4]);
                        if (minoritario !== coloresDigitos[6] && minoritario === coloresDigitos[7]) {
                            agregarResultadoConTiempo(historicoMHI2, "G1", "MHI_2_Minor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7]) {
                                agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minor√≠a");
                            }
                        }
                        if (mayoritario !== coloresDigitos[6] && mayoritario === coloresDigitos[7]) {
                            agregarResultadoConTiempo(historicoMHI2MAY, "G1", "MHI_2_Mayor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7]) {
                                agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayor√≠a");
                            }
                        }
                    }
                }
                //MHI mayoria3 y minoria3
                if (coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji' || coloresDigitos[4] === 'doji') {
                    agregarResultadoConTiempo(historicoMHI3, "E", "MHI_3_Minor√≠a");
                    agregarResultadoConTiempo(historicoMHI3MAY, "E", "MHI_3_Mayor√≠a");
                } else {
                    const minoritario = colorMenosRepetido([2, 3, 4]);
                    if (minoritario === coloresDigitos[7]) {
                        agregarResultadoConTiempo(historicoMHI3, "D", "MHI_3_Minor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minor√≠a");
                        }
                    }

                    const mayoritario = colorMasRepetido([2, 3, 4]);
                    if (mayoritario === coloresDigitos[7]) {
                        agregarResultadoConTiempo(historicoMHI3MAY, "D", "MHI_3_Mayor√≠a");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayor√≠a");
                        }
                    }

                }
                //MHI mayoria y minoria
                if (valorSelect === "mg2") {
                    if (coloresDigitos[0] !== 'doji' && coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                        const minoritario = colorMenosRepetido([0, 1, 2, 3, 4]);
                        const mayoritario = colorMasRepetido([0, 1, 2, 3, 4]);
                        if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario === coloresDigitos[7]) {
                            agregarResultadoConTiempo(historicoMILLONMIN, "G2", "Mill√≥n_Minor√≠a");
                        } else if (minoritario !== coloresDigitos[5] && minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7]) {

                            agregarResultadoConTiempo(historicoMILLONMIN, "L", "Mill√≥n_Minor√≠a");
                        }
                        if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario === coloresDigitos[7]) {
                            agregarResultadoConTiempo(historicoMILLONMAY, "G2", "Mill√≥n_Mayor√≠a");
                        } else if (mayoritario !== coloresDigitos[5] && mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7]) {
                            agregarResultadoConTiempo(historicoMILLONMAY, "L", "Mill√≥n_Mayor√≠a");
                        }


                    }

                }
                //Mejor de 3
                if (coloresDigitos[1] === 'doji' || coloresDigitos[2] === 'doji' || coloresDigitos[3] === 'doji') {
                    agregarResultadoConTiempo(historicoMEJOR3, "E", "Mejor_de_3");
                } else {
                    const mayoritario = colorMasRepetido([1, 2, 3]);
                    if (mayoritario === coloresDigitos[7]) {
                        agregarResultadoConTiempo(historicoMEJOR3, "D", "Mejor_de_3");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");
                        }
                    }

                }
                // Analisis Patron Impar
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[2] !== 'doji') {
                        if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] === coloresDigitos[7]) {
                            agregarResultadoConTiempo(historicoPATRONIMPAR, "G1", "Patron_Impar");
                        }
                        if (valorSelect === "mg1") {
                            if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] !== coloresDigitos[7]) {
                                agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patron_Impar");
                            }
                        }
                    }
                }
                //Patron 23
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[5] !== 'doji') {
                        if (coloresDigitos[5] !== coloresDigitos[6] && coloresDigitos[5] === coloresDigitos[7]) {
                            agregarResultadoConTiempo(historicoPADRON23, "G1", "Patron_23");
                        }
                        if (valorSelect === "mg1") {
                            if (coloresDigitos[5] !== coloresDigitos[6] && coloresDigitos[5] !== coloresDigitos[7]) {
                                agregarResultadoConTiempo(historicoPADRON23, "L", "Patron_23");
                            }
                        }
                    }
                }

            }

            function digito8(vela) {
                ultimaVela = coloresDigitos[8];
                //MHI Minoria y MHI Mayoria
                if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                    if (coloresDigitos[7] === coloresDigitos[8]) {
                        const opuesto = coloresDigitos[7] === 'red' ? 'green' : 'red';
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 1).style.backgroundColor = opuesto; }
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 4).style.backgroundColor = opuesto; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 1).style.backgroundColor = coloresDigitos[7]; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 4).style.backgroundColor = coloresDigitos[7]; }
                    } else {
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 4).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 4).style.backgroundColor = 'red'; }
                    }
                }
                //Millon Minoria y Millon Mayoria
                if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji') {
                    const minoritario = colorMenosRepetido([5, 6, 7, 8]);
                    if (minoritario === 'empate') {
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'red'; }
                    }
                    else if (minoritario === 'red') {
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'green'; }
                    }
                    else {
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 4).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 4).style.backgroundColor = 'red'; }
                    }
                }
                getCelda('MHI 3 Minor√≠a', 3).style.backgroundColor = '';
                getCelda('MHI 3 Minor√≠a', 6).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 3).style.backgroundColor = '';
                getCelda('MHI 3 Mayor√≠a', 6).style.backgroundColor = '';
                //Analasis para Torres Gemelas
                getCelda('Torres Gemelas', 1).style.backgroundColor = '';
                getCelda('Torres Gemelas', 4).style.backgroundColor = '';
                if (coloresDigitos[5] !== 'doji') {
                    if (coloresDigitos[5] === 'green') {
                        if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 5).style.backgroundColor = coloresDigitos[5]; }
                    } else {
                        if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 2).style.backgroundColor = coloresDigitos[5]; }
                    }
                }
                //Analisis correspondiente a TRES MOSQUETEROS
                getCelda('Tres Mosqueteros', 2).style.backgroundColor = '';
                getCelda('Tres Mosqueteros', 5).style.backgroundColor = '';
                if (coloresDigitos[7] !== 'doji') {
                    if (coloresDigitos[7] !== coloresDigitos[8]) {
                        if (coloresDigitos[7] === 'green') {
                            if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("Tres Mosqueteros")) { getCelda('Tres Mosqueteros', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analisis correspondiente a TRES VECINOS
                getCelda('Tres Vecinos', 1).style.backgroundColor = '';
                getCelda('Tres Vecinos', 4).style.backgroundColor = '';
                if (coloresDigitos[8] !== 'doji') {
                    if (coloresDigitos[8] === 'green') {
                        if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 5).style.backgroundColor = 'green'; }
                    } else {
                        if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 2).style.backgroundColor = 'red'; }
                    }
                }
                //Analisis Patron 3x1
                getCelda('Patron 3x1', 1).style.backgroundColor = '';
                getCelda('Patron 3x1', 4).style.backgroundColor = '';
                if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {    //Para si hay un doji no hacer nada
                    const minoritario = colorMenosRepetido([5, 6, 7]);
                    if (minoritario === 'green') {
                        if (patronMarcado("")) { getCelda('Patron 3x1', 5).style.backgroundColor = 'green'; }
                    } else {
                        if (patronMarcado("")) { getCelda('Patron 3x1', 2).style.backgroundColor = 'red'; }
                    }
                }
                // Analisis Patron Impar
                getCelda('Patron Impar', 3).style.backgroundColor = '';
                getCelda('Patron Impar', 6).style.backgroundColor = '';
                if (coloresDigitos[7] !== 'doji') {
                    if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 1).style.backgroundColor = coloresDigitos[7]; }
                    if (patronMarcado("Patron Impar")) { getCelda('Patron Impar', 4).style.backgroundColor = coloresDigitos[7]; }
                }
                //Analisis de las que pueden ganar en este digito:
                //MHI2 mayoria y minoria2
                if (valorSelect === "mg2") {
                    if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                        const minoritario = colorMenosRepetido([2, 3, 4]);
                        if (minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7] && minoritario === coloresDigitos[8]) {
                            agregarResultadoConTiempo(historicoMHI2, "G2", "MHI_2_Minor√≠a");
                        } else if (minoritario !== coloresDigitos[6] && minoritario !== coloresDigitos[7] && minoritario !== coloresDigitos[8]) {

                            agregarResultadoConTiempo(historicoMHI2, "L", "MHI_2_Minor√≠a");
                        }
                        const mayoritario = colorMasRepetido([2, 3, 4]);

                        if (mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7] && mayoritario === coloresDigitos[8]) {
                            agregarResultadoConTiempo(historicoMHI2MAY, "G2", "MHI_2_Mayor√≠a");
                        } else if (mayoritario !== coloresDigitos[6] && mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8]) {
                            agregarResultadoConTiempo(historicoMHI2MAY, "L", "MHI_2_Mayor√≠a");
                        }
                    }

                }
                //MHI mayoria3 y minoria3
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                        const minoritario = colorMenosRepetido([2, 3, 4]);
                        const mayoritario = colorMasRepetido([2, 3, 4]);
                        if (minoritario !== coloresDigitos[7] && minoritario === coloresDigitos[8]) {
                            agregarResultadoConTiempo(historicoMHI3, "G1", "MHI_3_Minor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (minoritario !== coloresDigitos[7] && minoritario !== coloresDigitos[8]) {
                                agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minor√≠a");
                            }
                        }

                        if (mayoritario !== coloresDigitos[7] && mayoritario === coloresDigitos[8]) {
                            agregarResultadoConTiempo(historicoMHI3MAY, "G1", "MHI_3_Mayor√≠a");
                        }
                        if (valorSelect === "mg1") {
                            if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8]) {
                                agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayor√≠a");
                            }
                        }
                    }
                }


                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                        const mayoritario = colorMasRepetido([1, 2, 3]);
                        if (mayoritario !== coloresDigitos[7] && mayoritario === coloresDigitos[8]) {
                            agregarResultadoConTiempo(historicoMEJOR3, "G1", "Mejor_de_3");
                        }
                        if (valorSelect === "mg1") {
                            if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8]) {
                                agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");
                            }
                        }
                    }
                }

                //Tres Mosqueteros
                if (coloresDigitos[7] === 'doji') {
                    agregarResultadoConTiempo(historicoMOSQUETEROS, "E", "Tres_Mosqueteros");
                } else {
                    if (coloresDigitos[7] === coloresDigitos[8]) {
                        agregarResultadoConTiempo(historicoMOSQUETEROS, "D", "Tres_Mosqueteros");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
                        }
                    }

                }
                //Patron 23
                if (valorSelect === "mg2") {
                    if (coloresDigitos[5] !== 'doji') {
                        if (coloresDigitos[5] !== coloresDigitos[6] && coloresDigitos[5] !== coloresDigitos[7] && coloresDigitos[5] === coloresDigitos[8]) {
                            agregarResultadoConTiempo(historicoPADRON23, "G2", "Patron_23");
                        } else if (coloresDigitos[5] !== coloresDigitos[6] && coloresDigitos[5] !== coloresDigitos[7] && coloresDigitos[5] !== coloresDigitos[8]) {

                            agregarResultadoConTiempo(historicoPADRON23, "L", "Patron_23");
                        }
                    }
                }

            }

            function digito9(vela) {
                ultimaVela = coloresDigitos[9];
                //Analisis Correspondiente a MHMI Minoria MHI Mayoria
                ['MHI Minor√≠a', 'MHI Mayor√≠a', 'Mill√≥n Minor√≠a', 'Mill√≥n Mayor√≠a'].forEach(patron => {
                    getCelda(patron, 1).style.backgroundColor = '';
                    getCelda(patron, 4).style.backgroundColor = '';
                });
                if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                    const minoritario = colorMenosRepetido([7, 8, 9]);
                    if (minoritario === 'red') {
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 2).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 5).style.backgroundColor = 'green'; }
                    } else if (minoritario === 'green') {
                        if (patronMarcado("MHI Minor√≠a")) { getCelda('MHI Minor√≠a', 5).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI Mayor√≠a")) { getCelda('MHI Mayor√≠a', 2).style.backgroundColor = 'red'; }
                    }
                }
                //Analisis Correspondiente a MHMill√≥nMI Minoria
                if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {    //Para si hay un doji no hacer nada
                    const minoritario = colorMenosRepetido([5, 6, 7, 8, 9]);
                    if (minoritario === 'red') {
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 2).style.backgroundColor = 'red'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 5).style.backgroundColor = 'green'; }
                    } else {
                        if (patronMarcado("Mill√≥n Minor√≠a")) { getCelda('Mill√≥n Minor√≠a', 5).style.backgroundColor = 'green'; }
                        if (patronMarcado("Mill√≥n Mayor√≠a")) { getCelda('Mill√≥n Mayor√≠a', 2).style.backgroundColor = 'red'; }
                    }
                }
                //Analisis Correspondiente a MMHI2 Minoria MHI2 Mayoria
                if (coloresDigitos[7] !== 'doji' && coloresDigitos[8] !== 'doji' && coloresDigitos[9] !== 'doji') {
                    const minoritario = colorMenosRepetido([7, 8, 9]);
                    if (minoritario === 'red') {
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = 'green'; }
                    } else if (minoritario === 'green') {
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 1).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 2 Minor√≠a")) { getCelda('MHI 2 Minor√≠a', 4).style.backgroundColor = 'green'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 1).style.backgroundColor = 'red'; }
                        if (patronMarcado("MHI 2 Mayor√≠a")) { getCelda('MHI 2 Mayor√≠a', 4).style.backgroundColor = 'red'; }
                    }
                }
                //Analasis para Torres Gemelas
                getCelda('Torres Gemelas', 2).style.backgroundColor = '';
                getCelda('Torres Gemelas', 5).style.backgroundColor = '';
                if (coloresDigitos[5] !== 'doji') {
                    if (coloresDigitos[5] !== coloresDigitos[9]) {
                        if (coloresDigitos[5] === 'green') {
                            if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 6).style.backgroundColor = coloresDigitos[0]; }
                        } else {
                            if (patronMarcado("Torres Gemelas")) { getCelda('Torres Gemelas', 3).style.backgroundColor = coloresDigitos[0]; }
                        }
                    }
                }
                //Analisis correspondiente a TRES MOSQUETEROS
                getCelda('Tres Mosqueteros', 3).style.backgroundColor = '';
                getCelda('Tres Mosqueteros', 6).style.backgroundColor = '';
                //Analisis correspondiente a TRES VECINOS
                getCelda('Tres Vecinos', 2).style.backgroundColor = '';
                getCelda('Tres Vecinos', 5).style.backgroundColor = '';
                if (coloresDigitos[8] !== 'doji') {
                    if (coloresDigitos[8] !== coloresDigitos[9]) {
                        if (coloresDigitos[8] === 'green') {
                            if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("Tres Vecinos")) { getCelda('Tres Vecinos', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                //Analisis correspondiente a PATRON 23
                if (patronMarcado("Patron 23")) { getCelda('Patron 23', 1).style.backgroundColor = 'green'; }
                if (patronMarcado("Patron 23")) { getCelda('Patron 23', 4).style.backgroundColor = 'red'; }
                //Analisis Patron 3x1
                getCelda('Patron 3x1', 2).style.backgroundColor = '';
                getCelda('Patron 3x1', 5).style.backgroundColor = '';
                if (coloresDigitos[5] !== 'doji' && coloresDigitos[6] !== 'doji' && coloresDigitos[7] !== 'doji') {    //Para si hay un doji no hacer nada
                    const minoritario = colorMenosRepetido([5, 6, 7]);
                    if (minoritario !== coloresDigitos[4]) {
                        if (minoritario === 'green') {
                            if (patronMarcado("")) { getCelda('Patron 3x1', 6).style.backgroundColor = 'green'; }
                        } else {
                            if (patronMarcado("")) { getCelda('Patron 3x1', 3).style.backgroundColor = 'red'; }
                        }
                    }
                }
                // Analisis Patron Impar
                getCelda('Patron Impar', 1).style.backgroundColor = '';
                getCelda('Patron Impar', 4).style.backgroundColor = '';

                //MHI2 mayoria y minoria2
                if (valorSelect === "mg2") {
                    if (coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji' && coloresDigitos[4] !== 'doji') {
                        const minoritario = colorMenosRepetido([2, 3, 4]);
                        const mayoritario = colorMasRepetido([2, 3, 4]);
                        if (minoritario !== coloresDigitos[7] && minoritario !== coloresDigitos[8] && minoritario === coloresDigitos[9]) {
                            agregarResultadoConTiempo(historicoMHI3, "G2", "MHI_3_Minor√≠a");
                        } else if (minoritario !== coloresDigitos[7] && minoritario !== coloresDigitos[8] && minoritario !== coloresDigitos[9]) {
                            agregarResultadoConTiempo(historicoMHI3, "L", "MHI_3_Minor√≠a");
                        }
                        if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario === coloresDigitos[9]) {
                            agregarResultadoConTiempo(historicoMHI3MAY, "G2", "MHI_3_Mayor√≠a");
                        } else if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario !== coloresDigitos[9]) {
                            agregarResultadoConTiempo(historicoMHI3MAY, "L", "MHI_3_Mayor√≠a");
                        }
                    }

                }
                //Torres Gemelas
                if (coloresDigitos[5] === 'doji') {
                    agregarResultadoConTiempo(historicoTORRESGEMELAS, "E", "Torres_Gemelas");
                } else {
                    if (coloresDigitos[5] === coloresDigitos[9]) {
                        agregarResultadoConTiempo(historicoTORRESGEMELAS, "D", "Torres_Gemelas");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoTORRESGEMELAS, "L", "Torres_Gemelas");
                        }
                    }

                }
                //Mejor de 3
                if (valorSelect === "mg2") {
                    if (coloresDigitos[1] !== 'doji' && coloresDigitos[2] !== 'doji' && coloresDigitos[3] !== 'doji') {
                        const mayoritario = colorMasRepetido([1, 2, 3]);
                        if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario === coloresDigitos[9]) {
                            agregarResultadoConTiempo(historicoMEJOR3, "G2", "Mejor_de_3");
                        } else if (mayoritario !== coloresDigitos[7] && mayoritario !== coloresDigitos[8] && mayoritario !== coloresDigitos[9]) {

                            agregarResultadoConTiempo(historicoMEJOR3, "L", "Mejor_de_3");
                        }
                    }
                }
                //Tres mosqueteros
                if (valorSelect === "mg1" || valorSelect === "mg2") {
                    if (coloresDigitos[7] !== 'doji') {
                        if (coloresDigitos[7] !== coloresDigitos[8] && coloresDigitos[7] === coloresDigitos[9]) {
                            agregarResultadoConTiempo(historicoMOSQUETEROS, "G1", "Tres_Mosqueteros");
                        }
                        if (valorSelect === "mg1") {
                            if (coloresDigitos[7] !== coloresDigitos[8] && coloresDigitos[7] !== coloresDigitos[9]) {
                                agregarResultadoConTiempo(historicoMOSQUETEROS, "L", "Tres_Mosqueteros");
                            }
                        }
                    }
                }
                //Patron Impar
                if (valorSelect === "mg2") {
                    if (coloresDigitos[2] !== 'doji') {
                        if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] !== coloresDigitos[7] && coloresDigitos[2] === coloresDigitos[9]) {
                            agregarResultadoConTiempo(historicoPATRONIMPAR, "G2", "Patron_Impar");
                        } else if (coloresDigitos[2] !== coloresDigitos[5] && coloresDigitos[2] !== coloresDigitos[7] && coloresDigitos[2] !== coloresDigitos[9]) {

                            agregarResultadoConTiempo(historicoPATRONIMPAR, "L", "Patron_Impar");
                        }
                    }
                }
                //Tres Vecinos
                if (coloresDigitos[8] === 'doji') {
                    agregarResultadoConTiempo(historicoTRESVECINOS, "E", "Tres_Vecinos");
                } else {
                    if (coloresDigitos[8] === coloresDigitos[9]) {
                        agregarResultadoConTiempo(historicoTRESVECINOS, "D", "Tres_Vecinos");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoTRESVECINOS, "L", "Tres_Vecinos");
                        }
                    }

                }
                //Patron 3x1
                if (coloresDigitos[5] === 'doji' || coloresDigitos[6] === 'doji' || coloresDigitos[7] === 'doji') {
                    agregarResultadoConTiempo(historicoPATRON3X1, "E", "Patron_3x1");
                } else {
                    const minoritario = colorMenosRepetido([5, 6, 7]);
                    if (minoritario === coloresDigitos[9]) {
                        agregarResultadoConTiempo(historicoPATRON3X1, "D", "Patron_3x1");
                    } else {
                        if (valorSelect === "sinMG") {
                            agregarResultadoConTiempo(historicoPATRON3X1, "L", "Patron_3x1");
                        }
                    }
                }
            }


        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const toggleSidebarBtn = document.getElementById('toggle-sidebar');
                const toggleRightBtn = document.getElementById('toggle-right-panel');
                const sidebar = document.querySelector('.sidebar');
                const rightPanel = document.querySelector('.right-panel');


                // Crear overlay
                const overlay = document.createElement('div');
                overlay.className = 'mobile-overlay';
                document.body.appendChild(overlay);

                // Crear bot√≥n de cerrar para sidebar
                const closeSidebarBtn = document.createElement('button');
                closeSidebarBtn.className = 'close-sidebar';
                closeSidebarBtn.innerHTML = '√ó';
                sidebar.appendChild(closeSidebarBtn);

                // Crear bot√≥n de cerrar para panel derecho
                const closeRightBtn = document.createElement('button');
                closeRightBtn.className = 'close-panel';
                closeRightBtn.innerHTML = '√ó';
                rightPanel.appendChild(closeRightBtn);

                // Funciones para sidebar
                function showSidebar() {
                    sidebar.classList.add('show');
                    overlay.classList.add('show');
                    toggleSidebarBtn.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }

                function hideSidebar() {
                    sidebar.classList.remove('show');
                    overlay.classList.remove('show');
                    toggleSidebarBtn.classList.remove('active');
                    document.body.style.overflow = '';
                }

                // Funciones para panel derecho
                function showRightPanel() {
                    rightPanel.classList.add('show');
                    overlay.classList.add('show');
                    toggleRightBtn.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }

                function hideRightPanel() {
                    rightPanel.classList.remove('show');
                    overlay.classList.remove('show');
                    toggleRightBtn.classList.remove('active');
                    document.body.style.overflow = '';
                }

                // Event listeners
                toggleSidebarBtn.addEventListener('click', function () {
                    if (sidebar.classList.contains('show')) {
                        hideSidebar();
                    } else {
                        hideRightPanel(); // Cerrar panel derecho si est√° abierto
                        showSidebar();
                    }
                });

                toggleRightBtn.addEventListener('click', function () {
                    if (rightPanel.classList.contains('show')) {
                        hideRightPanel();
                    } else {
                        hideSidebar(); // Cerrar sidebar si est√° abierto
                        showRightPanel();
                    }
                });

                // Cerrar con botones X
                closeSidebarBtn.addEventListener('click', hideSidebar);
                closeRightBtn.addEventListener('click', hideRightPanel);

                // Cerrar tocando overlay
                overlay.addEventListener('click', function () {
                    hideSidebar();
                    hideRightPanel();
                });

                // Cerrar con tecla Escape
                document.addEventListener('keydown', function (e) {
                    if (e.key === 'Escape') {
                        hideSidebar();
                        hideRightPanel();
                    }
                });
            });
        </script>


        <script>
            document.addEventListener("DOMContentLoaded", async () => {
                userId = "<%= user.id %>";
                try {
                    // Leer valor inicial de mg_config
                    const { data, error } = await clientesupabase
                        .from("user_config")
                        .select("mg_config")
                        .eq("user_id", userId)
                        .single();

                    const mapSelect = {
                        "2 gales": "mg2",
                        "1 gale": "mg1",
                        "nogale": "sinMG"
                    };

                    const mapReverse = {
                        "sinMG": "nogale",
                        "mg1": "1 gale",
                        "mg2": "2 gales"
                    };



                    if (data && data.mg_config && mapSelect[data.mg_config]) {
                        valorSelect = mapSelect[data.mg_config];
                    }

                    const select = document.getElementById("selectSenales");
                    if (select) {
                        select.value = valorSelect;

                        // Evento al cambiar el select
                        select.addEventListener("change", async () => {
                            const nuevoValor = mapReverse[select.value];
                            try {
                                const { error: updateError } = await clientesupabase
                                    .from("user_config")
                                    .update({ mg_config: nuevoValor })
                                    .eq("user_id", userId);

                                if (updateError) {
                                    console.error("Error actualizando mg_config:", updateError);
                                } else {
                                    location.reload();
                                }
                            } catch (err) {
                                console.error("Excepci√≥n al actualizar mg_config:", err);
                            }
                        });
                    }

                } catch (err) {
                    console.error("Excepci√≥n al cargar mg_config:", err);
                }
            });
        </script>























</body>

</html>





</body>

</html>